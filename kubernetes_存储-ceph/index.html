<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
    <meta name="robots" content="noodp" />
    <title>Kubernetes-_存储-ceph - DAY By DAY</title><meta name="author" content="LiuDongdong">
<meta name="author-link" content="https://liudongdong1.github.io/">
<meta name="description" content="一个 Ceph 存储集群至少需要一个 Ceph Monitor（监视器）、Ceph Manager（管理） 和 Ceph OSD（对象存储守护进程）。 Monitors：Cep" /><meta name="keywords" content='Storage' /><meta itemprop="name" content="Kubernetes-_存储-ceph">
<meta itemprop="description" content="一个 Ceph 存储集群至少需要一个 Ceph Monitor（监视器）、Ceph Manager（管理） 和 Ceph OSD（对象存储守护进程）。 Monitors：Cep"><meta itemprop="datePublished" content="2022-07-24T22:00:04+00:00" />
<meta itemprop="dateModified" content="2023-09-24T17:00:04+08:00" />
<meta itemprop="wordCount" content="5317"><meta itemprop="image" content="/logo.png"/>
<meta itemprop="keywords" content="Storage," /><meta property="og:title" content="Kubernetes-_存储-ceph" />
<meta property="og:description" content="一个 Ceph 存储集群至少需要一个 Ceph Monitor（监视器）、Ceph Manager（管理） 和 Ceph OSD（对象存储守护进程）。 Monitors：Cep" />
<meta property="og:type" content="article" />
<meta property="og:url" content="liudongdong1.github.io/kubernetes_%E5%AD%98%E5%82%A8-ceph/" /><meta property="og:image" content="/logo.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-24T22:00:04+00:00" />
<meta property="article:modified_time" content="2023-09-24T17:00:04+08:00" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="/logo.png"/>

<meta name="twitter:title" content="Kubernetes-_存储-ceph"/>
<meta name="twitter:description" content="一个 Ceph 存储集群至少需要一个 Ceph Monitor（监视器）、Ceph Manager（管理） 和 Ceph OSD（对象存储守护进程）。 Monitors：Cep"/>
<meta name="application-name" content="DAY By DAY">
<meta name="apple-mobile-web-app-title" content="DAY By DAY"><meta name="theme-color" data-light="#f8f8f8" data-dark="#252627" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="liudongdong1.github.io/kubernetes_%E5%AD%98%E5%82%A8-ceph/" /><link rel="prev" href="liudongdong1.github.io/argobots/" /><link rel="next" href="liudongdong1.github.io/rpc%E6%A1%86%E6%9E%B6_mercury/" /><link rel="stylesheet" href="/liudongdong1.github.io/css/style.min.css"><link rel="stylesheet" href="/liudongdong1.github.io/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/liudongdong1.github.io/lib/animate/animate.min.css"><script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "Kubernetes-_存储-ceph",
    "inLanguage": "zh-CN",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "liudongdong1.github.io\/kubernetes_%E5%AD%98%E5%82%A8-ceph\/"
    },"genre": "posts","keywords": "Storage","wordcount":  5317 ,
    "url": "liudongdong1.github.io\/kubernetes_%E5%AD%98%E5%82%A8-ceph\/","datePublished": "2022-07-24T22:00:04+00:00","dateModified": "2023-09-24T17:00:04+08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
      "@type": "Organization",
      "name": "LiuDongdong","logo": "\/images\/person.png"},"author": {
        "@type": "Person",
        "name": "liudongdong1"
      },"description": ""
  }
  </script></head>
  <body data-header-desktop="auto" data-header-mobile="auto"><script>(window.localStorage?.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('data-theme', 'dark');</script><div class="wrapper"><header class="desktop animate__faster" id="header-desktop">
  <div class="header-wrapper" data-github-corner="right">
    <div class="header-title">
      <a href="liudongdong1.github.io/" title="DAY By DAY"><img
    class="lazyload logo"
    src="/liudongdong1.github.io/svg/loading.min.svg"
    data-src="/fixit.min.svg"
    data-srcset="/fixit.min.svg, /fixit.min.svg 1.5x, /fixit.min.svg 2x"
    data-sizes="auto"
    alt="DAY By DAY"
    title="DAY By DAY"/><span class="header-title-text"></span></a><span id="typeit-header-subtitle-desktop" class="typeit header-subtitle"></span></div>
    <nav>
      <ul class="menu"><li class="menu-item">
              <a
                class="menu-link"
                href="/liudongdong1.github.io/posts/"
                
                
              ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> 所有文章</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/liudongdong1.github.io/categories/"
                
                
              ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> 分类</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/liudongdong1.github.io/tags/"
                
                
              ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> 标签</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/liudongdong1.github.io/friends/"
                title="友情链接"
                
              ><i class="fa-solid fa-users fa-fw fa-sm" aria-hidden="true"></i> 友链</a></li><li class="menu-item">
              <a
                class="menu-link"
                href="/liudongdong1.github.io/about/"
                
                
              ><i class="fa-solid fa-info-circle fa-fw fa-sm" aria-hidden="true"></i> 关于</a></li><li class="menu-item delimiter"></li><li class="menu-item language">
            <span role="button" aria-label="选择语言" title="选择语言">简体中文<i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden="true"></i>
            </span>
            <ul class="sub-menu"><li class="menu-item">没有更多翻译</li></ul>
          </li><li class="menu-item search" id="search-desktop">
            <input type="text" placeholder="搜索文章标题或内容 ..." id="search-input-desktop">
            <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
              <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
            </a>
            <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
              <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
            </a>
            <span class="search-button search-loading" id="search-loading-desktop">
              <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
            </span>
          </li><li class="menu-item theme-switch" title="切换主题">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li>
      </ul>
    </nav>
  </div>
</header><header class="mobile animate__faster" id="header-mobile">
  <div class="header-container">
    <div class="header-wrapper">
      <div class="header-title">
        <a href="liudongdong1.github.io/" title="DAY By DAY"><img
    class="lazyload logo"
    src="/liudongdong1.github.io/svg/loading.min.svg"
    data-src="/fixit.min.svg"
    data-srcset="/fixit.min.svg, /fixit.min.svg 1.5x, /fixit.min.svg 2x"
    data-sizes="auto"
    alt="/fixit.min.svg"
    title="/fixit.min.svg"/><span class="header-title-text"></span></a><span id="typeit-header-subtitle-mobile" class="typeit header-subtitle"></span></div>
      <div class="menu-toggle" id="menu-toggle-mobile">
        <span></span><span></span><span></span>
      </div>
    </div>
    <nav>
      <ul class="menu" id="menu-mobile"><li class="search-wrapper">
            <div class="search mobile" id="search-mobile">
              <input type="text" placeholder="搜索文章标题或内容 ..." id="search-input-mobile">
              <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                <i class="fa-solid fa-search fa-fw" aria-hidden="true"></i>
              </a>
              <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                <i class="fa-solid fa-times-circle fa-fw" aria-hidden="true"></i>
              </a>
              <span class="search-button search-loading" id="search-loading-mobile">
                <i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
              </span>
            </div>
            <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
              取消
            </a>
          </li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/liudongdong1.github.io/posts/"
                  
                  
                ><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden="true"></i> 所有文章</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/liudongdong1.github.io/categories/"
                  
                  
                ><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden="true"></i> 分类</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/liudongdong1.github.io/tags/"
                  
                  
                ><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden="true"></i> 标签</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/liudongdong1.github.io/friends/"
                  title="友情链接"
                  
                ><i class="fa-solid fa-users fa-fw fa-sm" aria-hidden="true"></i> 友链</a></li><li
              class="menu-item"
            ><a
                  class="menu-link"
                  href="/liudongdong1.github.io/about/"
                  
                  
                ><i class="fa-solid fa-info-circle fa-fw fa-sm" aria-hidden="true"></i> 关于</a></li><li
              class="menu-item text-center"
            ><a
                  class="menu-link"
                  href="https://liudongdong1.github.io/"
                  title="GitHub"
                  rel="noopener noreferrer" target="_blank"
                ><i class='fa-brands fa-github fa-fw' aria-hidden='true'></i> </a></li><li class="menu-item theme-switch" title="切换主题">
          <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
        </li><li class="menu-item language">
            <span role="button" aria-label="选择语言" title="选择语言">简体中文<i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden="true"></i>
            </span>
            <select class="language-select" onchange="location = this.value;"><option disabled>没有更多翻译</option></select>
          </li></ul>
    </nav>
  </div>
</header><div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
  </div>
  <div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
  </div><main class="container" data-page-style="normal"><aside class="toc" id="toc-auto"><h2 class="toc-title">目录 <i class="toc-icon fa-solid fa-angle-down fa-fw"></i></h2>
      <div class="toc-content" id="toc-content-auto"></div></aside>

  <aside class="aside-custom" id="aside-sakana">
    

<div class="sakana-widget">
  <div class="sakana-item" id="takina-widget"></div>
  <div class="sakana-item" id="chisato-widget"></div>
</div>
<script>
  function initSakanaWidget() {
    const takina = SakanaWidget.getCharacter('takina')
    SakanaWidget.registerCharacter('takina-slow', takina);
    new SakanaWidget({
      character: 'takina-slow',
      controls: false,
      autoFit: true,
      stroke: {
        color: "#b4b4b4",
        width: 2
      }
    }).mount('#takina-widget');

    const chisato = SakanaWidget.getCharacter('chisato')
    SakanaWidget.registerCharacter('chisato-slow', chisato);
    new SakanaWidget({
      character: 'chisato-slow',
      controls: false,
      autoFit: true,
      stroke: {
        color: "#b4b4b4",
        width: 2
      }
    }).mount('#chisato-widget');
  }
</script>
<script async onload="initSakanaWidget()" src="https://cdn.jsdelivr.net/npm/sakana-widget@2.3.0/lib/sakana.min.js">
</script></aside>

  <article class="page single">
    <div class="header"><h1 class="single-title animate__animated animate__flipInX">
        <span>Kubernetes-_存储-ceph</span>
      </h1></div><div class="post-meta">
      <div class="post-meta-line"><span class="post-author"><span class="author"><i class="fa-solid fa-user-circle" aria-hidden="true"></i>
      liudongdong1</span></span>
          <span class="post-category">收录于 <a href="liudongdong1.github.io/categories/"><i class="fa-regular fa-folder fa-fw"></i>&nbsp;Categories</a>&ensp;<a href="liudongdong1.github.io/categories/storage/"><i class="fa-regular fa-folder fa-fw"></i>&nbsp;Storage</a></span></div>
      <div class="post-meta-line"><span title=2022-07-24&#32;22:00:04>
            <i class="fa-regular fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2022-07-24" >2022-07-24</time>
          </span>&nbsp;<i class="fa-solid fa-pencil-alt fa-fw"></i>&nbsp;约 5317 字&nbsp;
        <i class="fa-regular fa-clock fa-fw"></i>&nbsp;预计阅读 11 分钟&nbsp;<span id="busuanzi_container_page_pv" class="busuanzi_visitors comment-visitors" data-flag-title="Kubernetes-_存储-ceph">
            <i class="fa-regular fa-eye fa-fw"></i>&nbsp;<span id="busuanzi_value_page_pv">-</span>&nbsp;次阅读
          </span>&nbsp;</div>
    </div><div class="details toc" id="toc-static" kept="true">
        <div class="details-summary toc-title">
          <span>目录</span>
          <span><i class="details-icon fa-solid fa-angle-right"></i></span>
        </div>
        <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#1基础配置">1、基础配置</a></li>
    <li><a href="#2创建ceph集群">2、创建ceph集群</a></li>
    <li><a href="#3部署mgr管理服务">3、部署mgr管理服务</a></li>
    <li><a href="#4部署osd">4、部署osd</a></li>
  </ul>

  <ul>
    <li><a href="#一cephfs文件系统">一、cephfs文件系统</a></li>
    <li><a href="#二块存储">二、块存储</a></li>
    <li><a href="#三对象存储">三、对象存储</a>
      <ul>
        <li><a href="#使用-s3-访问-rgw">使用 S3 访问 RGW</a></li>
        <li><a href="#使用命令行方式操作-rgw">使用命令行方式操作 rgw</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#cephrbd">CephRBD</a></li>
        <li><a href="#cephfs">CephFS</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
      </div><div
      class="content"
      id="content"
      
      
    ><blockquote>
<p>一个 Ceph 存储集群至少需要一个 Ceph Monitor（监视器）、Ceph Manager（管理） 和 Ceph OSD（对象存储守护进程）。</p>
<p><strong>Monitors</strong>：Ceph Monitor ( ceph-mon) 维护集群状态的映射，包括监视器映射、管理器映射、OSD 映射、MDS 映射和 CRUSH 映射。这些映射是 Ceph 守护进程相互协调所需的关键集群状态。监视器还负责管理守护进程和客户端之间的身份验证。冗余和高可用性通常需要至少三个监视器。
<strong>Managers</strong>：Ceph Manager守护进程 ( ceph-mgr) 负责跟踪运行时指标和 Ceph 集群的当前状态，包括存储利用率、当前性能指标和系统负载。高可用性通常需要至少两个管理器。
<strong>Ceph OSD</strong>：一个Ceph OSD（ceph-osd）存储数据、处理数据复制、恢复、重新平衡，并通过检查其他 Ceph OSD 守护进程的心跳来向 Ceph 监视器和管理器提供一些监视信息。冗余和高可用性通常需要至少三个 Ceph OSD。
<strong>MDS</strong>：Ceph 元数据服务器(MDS ceph-mds) 代表Ceph 文件系统存储元数据（即 Ceph 块设备和 Ceph 对象存储不使用 MDS）。Ceph 元数据服务器允许 POSIX 文件系统用户执行基本命令（如 ls、find等），而不会给 Ceph 存储集群带来巨大负担。</p>
</blockquote>
<h1 id="搭建ceph操作篇">搭建ceph（操作篇）</h1>
<table>
<thead>
<tr>
<th>主机名</th>
<th>IP</th>
<th>网卡模式</th>
<th>内存</th>
<th>系统盘</th>
<th>数据盘</th>
</tr>
</thead>
<tbody>
<tr>
<td>ceph-1</td>
<td>192.168.200.43</td>
<td>NAT</td>
<td>2G</td>
<td>100G</td>
<td>20G</td>
</tr>
<tr>
<td>ceph-2</td>
<td>192.168.200.44</td>
<td>NAT</td>
<td>2G</td>
<td>100G</td>
<td>20G</td>
</tr>
<tr>
<td>ceph-3</td>
<td>192.168.200.45</td>
<td>NAT</td>
<td>2G</td>
<td>100G</td>
<td>20G</td>
</tr>
<tr>
<td>ceph-client</td>
<td>192.168.200.45</td>
<td>NAT</td>
<td>2G</td>
<td>100G</td>
<td>20G</td>
</tr>
</tbody>
</table>
<h2 id="1基础配置">1、基础配置</h2>
<p>后面的操作步骤，请注意观察命令是在那台主机上执行的（<code>非常重要</code>）</p>
<p>1、修改主机名称（三节点操作）</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># hostnamectl set-hostname ceph-1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ~<span style="color:#f92672">]</span><span style="color:#75715e"># bash</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># hostnamectl set-hostname ceph-2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-2 ~<span style="color:#f92672">]</span><span style="color:#75715e"># bash</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># hostnamectl set-hostname ceph-3</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-3 ~<span style="color:#f92672">]</span><span style="color:#75715e"># bash</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@localhost ~<span style="color:#f92672">]</span><span style="color:#75715e"># hostnamectl set-hostname ceph-client</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-clinet ~<span style="color:#f92672">]</span><span style="color:#75715e"># bash</span>
</span></span></code></pre></div><p>2、配置hosts文件映射（三节点操作）</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ cat &gt;&gt; /etc/hosts <span style="color:#e6db74">&lt;&lt; EOF
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.200.43 ceph-1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.200.44 ceph-2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.200.45 ceph-3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">192.168.200.46 ceph-client
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span></code></pre></div><p>3、关闭防火墙（三节点操作）</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ systemctl stop firewalld <span style="color:#f92672">&amp;&amp;</span> systemctl disable firewalld
</span></span><span style="display:flex;"><span>$ setenforce <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;s/SELINUX=.*/SELINUX=permissive/g&#39;</span> /etc/selinux/config
</span></span></code></pre></div><p>4、配置ssh免密登录</p>
<blockquote>
<p>使用 ssh-keygen 命令生成公钥、私钥（一直按回车），再使用 ssh-copy-id 命令将公钥copy复制到目标主机，最后使用一个for循环测试是否可免密登录。</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ~<span style="color:#f92672">]</span><span style="color:#75715e"># ssh-keygen</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ~<span style="color:#f92672">]</span><span style="color:#75715e"># ssh-copy-id ceph-1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ~<span style="color:#f92672">]</span><span style="color:#75715e"># ssh-copy-id ceph-2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ~<span style="color:#f92672">]</span><span style="color:#75715e"># ssh-copy-id ceph-3</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ~<span style="color:#f92672">]</span><span style="color:#75715e"># ssh-copy-id ceph-client</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ~<span style="color:#f92672">]</span><span style="color:#75715e"># for i in 1 2 3 client; do ssh ceph-$i hostname ; done</span>
</span></span><span style="display:flex;"><span>ceph-1
</span></span><span style="display:flex;"><span>ceph-2
</span></span><span style="display:flex;"><span>ceph-3
</span></span><span style="display:flex;"><span>ceph-clinet
</span></span></code></pre></div><p>5、配置yum源（ceph-1节点执行）</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ yum install -y wget
</span></span><span style="display:flex;"><span>$ mv /etc/yum.repos.d/* /media/  <span style="color:#75715e"># 所有节点执行</span>
</span></span><span style="display:flex;"><span>$ wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo
</span></span><span style="display:flex;"><span>$ wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo
</span></span><span style="display:flex;"><span>$ vi /etc/yum.repos.d/ceph.rpeo
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>ceph<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>name<span style="color:#f92672">=</span>Ceph packages <span style="color:#66d9ef">for</span>
</span></span><span style="display:flex;"><span>baseurl<span style="color:#f92672">=</span>https://mirrors.aliyun.com/ceph/rpm-mimic/el7/$basearch
</span></span><span style="display:flex;"><span>enabled<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>gpgcheck<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>type<span style="color:#f92672">=</span>rpm-md
</span></span><span style="display:flex;"><span>gpgkey<span style="color:#f92672">=</span>https://mirrors.aliyun.com/ceph/keys/release.asc
</span></span><span style="display:flex;"><span>priority<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>ceph-noarch<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>name<span style="color:#f92672">=</span>Ceph noarch packages 
</span></span><span style="display:flex;"><span>baseurl<span style="color:#f92672">=</span>https://mirrors.aliyun.com/ceph/rpm-mimic/el7/noarch/
</span></span><span style="display:flex;"><span>enabled<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>gpgcheck<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>type<span style="color:#f92672">=</span>rpm-md
</span></span><span style="display:flex;"><span>gpgkey<span style="color:#f92672">=</span>https://mirrors.aliyun.com/ceph/keys/release.asc
</span></span><span style="display:flex;"><span>priority<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>ceph-source<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>name<span style="color:#f92672">=</span>Ceph source packages 
</span></span><span style="display:flex;"><span>baseurl<span style="color:#f92672">=</span>https://mirrors.aliyun.com/ceph/rpm-mimic/el7/SRPMS/
</span></span><span style="display:flex;"><span>enabled<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>gpgcheck<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>type<span style="color:#f92672">=</span>rpm-md
</span></span><span style="display:flex;"><span>gpgkey<span style="color:#f92672">=</span>https://mirrors.aliyun.com/ceph/keys/release.asc
</span></span><span style="display:flex;"><span>priority<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#将ceph-1节点yum，复制到ceph-2、ceph-3、ceph-client节点（需要提前移除默认repo文件）</span>
</span></span><span style="display:flex;"><span>$ <span style="color:#66d9ef">for</span> i in <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">3</span> client; <span style="color:#66d9ef">do</span> scp /etc/yum.repos.d/* ceph-$i:/etc/yum.repos.d/ ;<span style="color:#66d9ef">done</span>
</span></span></code></pre></div><p>6、chrony配置时间同步</p>
<ul>
<li>ceph-1节点执行</li>
</ul>
<blockquote>
<p>注意：chronyc sources命令查看时间同步是否成功，左下角 ^* 表示成功， ^? 表示不成功。
这一步很重要确保完成，否则安装ceph集群时会报一些奇奇怪怪的错误。</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ yum install chrony -y
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;3,6s/^/#/g&#39;</span> /etc/chrony.conf
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;7s/^/server ceph-1 iburst/g&#39;</span> /etc/chrony.conf
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;allow 192.168.200.0/24&#34;</span> &gt;&gt; /etc/chrony.conf
</span></span><span style="display:flex;"><span>$ echo <span style="color:#e6db74">&#34;local stratum 10&#34;</span> &gt;&gt; /etc/chrony.conf
</span></span><span style="display:flex;"><span>$ systemctl restart chronyd <span style="color:#f92672">&amp;&amp;</span> systemctl enable chronyd
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ chronyc sources
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">210</span> Number of sources <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>MS Name/IP address         Stratum Poll Reach LastRx Last sample
</span></span><span style="display:flex;"><span><span style="color:#f92672">===============================================================================</span>
</span></span><span style="display:flex;"><span>^* ceph-1                       <span style="color:#ae81ff">10</span>   <span style="color:#ae81ff">6</span>     <span style="color:#ae81ff">7</span>     <span style="color:#ae81ff">2</span>    -25ns<span style="color:#f92672">[</span>-6354ns<span style="color:#f92672">]</span> +/-   10us
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ~<span style="color:#f92672">]</span><span style="color:#75715e"># date</span>
</span></span><span style="display:flex;"><span>Fri Jun  <span style="color:#ae81ff">3</span> 17:45:29 CST <span style="color:#ae81ff">2022</span>
</span></span></code></pre></div><ul>
<li>ceph-2、ceph-3、ceph-client节点执行</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ yum install chrony -y
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;3,6s/^/#/g&#39;</span> /etc/chrony.conf
</span></span><span style="display:flex;"><span>$ sed -i <span style="color:#e6db74">&#39;7s/^/server ceph-1 iburst/g&#39;</span> /etc/chrony.conf
</span></span><span style="display:flex;"><span>$ systemctl restart chronyd <span style="color:#f92672">&amp;&amp;</span> systemctl enable chronyd
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ chronyc sources
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">210</span> Number of sources <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>MS Name/IP address         Stratum Poll Reach LastRx Last sample
</span></span><span style="display:flex;"><span><span style="color:#f92672">===============================================================================</span>
</span></span><span style="display:flex;"><span>^* ceph-1                       <span style="color:#ae81ff">11</span>   <span style="color:#ae81ff">6</span>     <span style="color:#ae81ff">7</span>     <span style="color:#ae81ff">1</span>  -2624ns<span style="color:#f92672">[</span> -411ms<span style="color:#f92672">]</span> +/- 1195us
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-2 ~<span style="color:#f92672">]</span><span style="color:#75715e"># date</span>
</span></span><span style="display:flex;"><span>Fri Jun  <span style="color:#ae81ff">3</span> 17:45:29 CST <span style="color:#ae81ff">2022</span>
</span></span></code></pre></div><h2 id="2创建ceph集群">2、创建ceph集群</h2>
<p>后面的操作步骤，请注意观察命令是在那台主机上执行的（<code>非常重要</code>），几乎所有操作在ceph-1节点。</p>
<p>1、 安装ceph-deploy（三节点操作）</p>
<blockquote>
<p>注意：检查ceph版本是否为 ceph-deploy-2.0.1 版本。如果使用ceph-deploy-1.5.x版本使用此文档会有小问题。
推荐使用ceph-deploy-2.0.1 版本</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ~<span style="color:#f92672">]</span><span style="color:#75715e"># yum install ceph-deploy ceph python-setuptools -y</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ~<span style="color:#f92672">]</span><span style="color:#75715e"># ceph-deploy --version</span>
</span></span><span style="display:flex;"><span>2.0.1
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-2 ~<span style="color:#f92672">]</span><span style="color:#75715e"># yum install ceph python-setuptools -y</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-3 ~<span style="color:#f92672">]</span><span style="color:#75715e"># yum install ceph python-setuptools -y</span>
</span></span></code></pre></div><p>2、部署集群</p>
<blockquote>
<p>ceph.conf：ceph配置文件
ceph-deploy-ceph.log：日志文件
ceph.mon.keyring：mon密钥文件（mon之间通信会用到）</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># cd /etc/ceph</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># ceph-deploy new ceph-1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># ll</span>
</span></span><span style="display:flex;"><span>total <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ae81ff">1</span> root root  <span style="color:#ae81ff">198</span> Jun  <span style="color:#ae81ff">2</span> 16:06 ceph.conf
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">2933</span> Jun  <span style="color:#ae81ff">2</span> 16:06 ceph-deploy-ceph.log
</span></span><span style="display:flex;"><span>-rw-------. <span style="color:#ae81ff">1</span> root root   <span style="color:#ae81ff">73</span> Jun  <span style="color:#ae81ff">2</span> 16:06 ceph.mon.keyring
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ae81ff">1</span> root root   <span style="color:#ae81ff">92</span> Apr <span style="color:#ae81ff">24</span>  <span style="color:#ae81ff">2020</span> rbdmap
</span></span></code></pre></div><p>修改副本数</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># cat ceph.conf</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>global<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>fsid <span style="color:#f92672">=</span> 1bd553c0-75e5-4f1e-aa51-88cb9aae7ba5
</span></span><span style="display:flex;"><span>mon_initial_members <span style="color:#f92672">=</span> ceph-1
</span></span><span style="display:flex;"><span>mon_host <span style="color:#f92672">=</span> 192.168.200.43
</span></span><span style="display:flex;"><span>auth_cluster_required <span style="color:#f92672">=</span> cephx
</span></span><span style="display:flex;"><span>auth_service_required <span style="color:#f92672">=</span> cephx
</span></span><span style="display:flex;"><span>auth_client_required <span style="color:#f92672">=</span> cephx
</span></span><span style="display:flex;"><span>osd_pool_default_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> 		 <span style="color:#75715e">#添加</span>
</span></span></code></pre></div><p>安装ceph相关程序包、依赖包</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># ceph-deploy install ceph-1 ceph-2 ceph-3</span>
</span></span></code></pre></div><p>安装ceph monitor监视器</p>
<blockquote>
<p>安装monitor后使用ceph -s查看集群状态报错（需要身份验证文件）</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># ceph-deploy mon create ceph-1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># ceph -s</span>
</span></span><span style="display:flex;"><span>2022-06-02 16:07:16.087 7fb927470700 -1 auth: unable to find a keyring on /etc/ceph/ceph.client.admin.keyring,/etc/ceph/ceph.keyring,/etc/ceph/keyring,/etc/ceph/keyring.bin,: <span style="color:#f92672">(</span>2<span style="color:#f92672">)</span> No such file or directory
</span></span><span style="display:flex;"><span>2022-06-02 16:07:16.087 7fb927470700 -1 monclient: ERROR: missing keyring, cannot use cephx <span style="color:#66d9ef">for</span> authentication
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>errno 2<span style="color:#f92672">]</span> error connecting to the cluster
</span></span></code></pre></div><p>使用gatherkeys子命令，收集配置新节点的身份验证密钥。</p>
<blockquote>
<p>这时你会发现/etc/ceph目录下多了5个密钥文件，再一次使用ceph -s发现可以使用并且集群状态是HEALTH_OK。</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># ceph-deploy gatherkeys ceph-1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># ll</span>
</span></span><span style="display:flex;"><span>total <span style="color:#ae81ff">44</span>
</span></span><span style="display:flex;"><span>-rw-------. <span style="color:#ae81ff">1</span> root root   <span style="color:#ae81ff">113</span> May <span style="color:#ae81ff">31</span> 09:51 ceph.bootstrap-mds.keyring   <span style="color:#75715e">#mds密钥</span>
</span></span><span style="display:flex;"><span>-rw-------. <span style="color:#ae81ff">1</span> root root   <span style="color:#ae81ff">113</span> May <span style="color:#ae81ff">31</span> 09:51 ceph.bootstrap-mgr.keyring   <span style="color:#75715e">#mgr密钥</span>
</span></span><span style="display:flex;"><span>-rw-------. <span style="color:#ae81ff">1</span> root root   <span style="color:#ae81ff">113</span> May <span style="color:#ae81ff">31</span> 09:51 ceph.bootstrap-osd.keyring	<span style="color:#75715e">#osd密钥</span>
</span></span><span style="display:flex;"><span>-rw-------. <span style="color:#ae81ff">1</span> root root   <span style="color:#ae81ff">113</span> May <span style="color:#ae81ff">31</span> 09:51 ceph.bootstrap-rgw.keyring	<span style="color:#75715e">#rgw密钥</span>
</span></span><span style="display:flex;"><span>-rw-------. <span style="color:#ae81ff">1</span> root root   <span style="color:#ae81ff">151</span> May <span style="color:#ae81ff">31</span> 09:51 ceph.client.admin.keyring	<span style="color:#75715e">#admin管理用户密钥</span>
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ae81ff">1</span> root root   <span style="color:#ae81ff">223</span> May <span style="color:#ae81ff">31</span> 09:50 ceph.conf
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">14695</span> May <span style="color:#ae81ff">31</span> 09:51 ceph-deploy-ceph.log
</span></span><span style="display:flex;"><span>-rw-------. <span style="color:#ae81ff">1</span> root root    <span style="color:#ae81ff">73</span> May <span style="color:#ae81ff">31</span> 09:47 ceph.mon.keyring
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 连接ceph集群admin用户密码</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># cat ceph.client.admin.keyring</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>client.admin<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>        key <span style="color:#f92672">=</span> AQAWHZZiaX5eFBAAwkKizCr+cjbeQpqmjMZ5sQ<span style="color:#f92672">==</span>
</span></span><span style="display:flex;"><span>        caps mds <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;allow *&#34;</span>
</span></span><span style="display:flex;"><span>        caps mgr <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;allow *&#34;</span>
</span></span><span style="display:flex;"><span>        caps mon <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;allow *&#34;</span>
</span></span><span style="display:flex;"><span>        caps osd <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;allow *&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># ceph -s</span>
</span></span><span style="display:flex;"><span>  cluster:
</span></span><span style="display:flex;"><span>    id:     48a5d20d-b4b7-49cd-b50e-3876509024e2
</span></span><span style="display:flex;"><span>    health: HEALTH_OK
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  services:
</span></span><span style="display:flex;"><span>    mon: <span style="color:#ae81ff">1</span> daemons, quorum ceph-1
</span></span><span style="display:flex;"><span>    mgr: no daemons active
</span></span><span style="display:flex;"><span>    osd: <span style="color:#ae81ff">0</span> osds: <span style="color:#ae81ff">0</span> up, <span style="color:#ae81ff">0</span> in
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  data:
</span></span><span style="display:flex;"><span>    pools:   <span style="color:#ae81ff">0</span> pools, <span style="color:#ae81ff">0</span> pgs
</span></span><span style="display:flex;"><span>    objects: <span style="color:#ae81ff">0</span>  objects, <span style="color:#ae81ff">0</span> B
</span></span><span style="display:flex;"><span>    usage:   <span style="color:#ae81ff">0</span> B used, <span style="color:#ae81ff">0</span> B / <span style="color:#ae81ff">0</span> B avail
</span></span><span style="display:flex;"><span>    pgs:
</span></span></code></pre></div><h2 id="3部署mgr管理服务">3、部署mgr管理服务</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># ceph-deploy mgr create ceph-1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># ceph -s</span>
</span></span><span style="display:flex;"><span>  cluster:
</span></span><span style="display:flex;"><span>    id:     48a5d20d-b4b7-49cd-b50e-3876509024e2
</span></span><span style="display:flex;"><span>    health: HEALTH_OK
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  services:
</span></span><span style="display:flex;"><span>    mon: <span style="color:#ae81ff">1</span> daemons, quorum ceph-1
</span></span><span style="display:flex;"><span>    mgr: ceph-1<span style="color:#f92672">(</span>active<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    osd: <span style="color:#ae81ff">3</span> osds: <span style="color:#ae81ff">3</span> up, <span style="color:#ae81ff">3</span> in
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  data:
</span></span><span style="display:flex;"><span>    pools:   <span style="color:#ae81ff">0</span> pools, <span style="color:#ae81ff">0</span> pgs
</span></span><span style="display:flex;"><span>    objects: <span style="color:#ae81ff">0</span>  objects, <span style="color:#ae81ff">0</span> B
</span></span><span style="display:flex;"><span>    usage:   3.0 GiB used, <span style="color:#ae81ff">27</span> GiB / <span style="color:#ae81ff">30</span> GiB avail
</span></span><span style="display:flex;"><span>    pgs:
</span></span></code></pre></div><p>统一集群配置</p>
<blockquote>
<p>将admin密钥文件拷贝到指定节点，这样每次执行ceph命令时就无需指定monitor地址和ceph.client.admin.keyring了。</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ ceph-deploy admin ceph-1 ceph-2 ceph-3
</span></span><span style="display:flex;"><span> <span style="color:#75715e">#各节点添加r读权限</span>
</span></span><span style="display:flex;"><span>$ chmod +r /etc/ceph/ceph.client.admin.keyring
</span></span></code></pre></div><h2 id="4部署osd">4、部署osd</h2>
<blockquote>
<p>三节点磁盘都格式化为xfs格式</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># lsblk</span>
</span></span><span style="display:flex;"><span>NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>sdb               8:16   <span style="color:#ae81ff">0</span>   20G  <span style="color:#ae81ff">0</span> disk
</span></span><span style="display:flex;"><span>sr0              11:0    <span style="color:#ae81ff">1</span> 1024M  <span style="color:#ae81ff">0</span> rom
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># mkfs.xfs /dev/sdb  #所有集群节点执行</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># lsblk -f</span>
</span></span><span style="display:flex;"><span>NAME            FSTYPE      LABEL UUID                                   MOUNTPOINT
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>sdb             xfs               5dfa0891-e40f-48ee-9591-da7e353cf842
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># ceph-deploy osd create ceph-1 --data /dev/sdb</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># ceph-deploy osd create ceph-2 --data /dev/sdb</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># ceph-deploy osd create ceph-3 --data /dev/sdb</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#查看osd状态</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># ceph-deploy osd list ceph-1 ceph-2 ceph-3</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e">#  ceph -s</span>
</span></span><span style="display:flex;"><span>  cluster:
</span></span><span style="display:flex;"><span>    id:     e9ae008c-8567-4af5-a6be-22c75d430f2e
</span></span><span style="display:flex;"><span>    health: HEALTH_OK
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  services:
</span></span><span style="display:flex;"><span>    mon: <span style="color:#ae81ff">1</span> daemons, quorum ceph-1
</span></span><span style="display:flex;"><span>    mgr: ceph-1<span style="color:#f92672">(</span>active<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    osd: <span style="color:#ae81ff">3</span> osds: <span style="color:#ae81ff">3</span> up, <span style="color:#ae81ff">3</span> in
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  data:
</span></span><span style="display:flex;"><span>    pools:   <span style="color:#ae81ff">0</span> pools, <span style="color:#ae81ff">0</span> pgs
</span></span><span style="display:flex;"><span>    objects: <span style="color:#ae81ff">0</span>  objects, <span style="color:#ae81ff">0</span> B
</span></span><span style="display:flex;"><span>    usage:   3.0 GiB used, <span style="color:#ae81ff">57</span> GiB / <span style="color:#ae81ff">60</span> GiB avail
</span></span><span style="display:flex;"><span>    pgs:
</span></span></code></pre></div><h1 id="使用ceph">使用ceph</h1>
<h2 id="一cephfs文件系统">一、cephfs文件系统</h2>
<p>1、部署mds</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># ceph-deploy mds create ceph-1 ceph-2 ceph-3</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># ceph mds stat</span>
</span></span><span style="display:flex;"><span>, <span style="color:#ae81ff">3</span> up:standby
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># ceph -s</span>
</span></span><span style="display:flex;"><span>  cluster:
</span></span><span style="display:flex;"><span>    id:     e9ae008c-8567-4af5-a6be-22c75d430f2e
</span></span><span style="display:flex;"><span>    health: HEALTH_OK
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  services:
</span></span><span style="display:flex;"><span>    mon: <span style="color:#ae81ff">1</span> daemons, quorum ceph-1
</span></span><span style="display:flex;"><span>    mgr: ceph-1<span style="color:#f92672">(</span>active<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    osd: <span style="color:#ae81ff">3</span> osds: <span style="color:#ae81ff">3</span> up, <span style="color:#ae81ff">3</span> in
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  data:
</span></span><span style="display:flex;"><span>    pools:   <span style="color:#ae81ff">0</span> pools, <span style="color:#ae81ff">0</span> pgs
</span></span><span style="display:flex;"><span>    objects: <span style="color:#ae81ff">0</span>  objects, <span style="color:#ae81ff">0</span> B
</span></span><span style="display:flex;"><span>    usage:   3.0 GiB used, <span style="color:#ae81ff">57</span> GiB / <span style="color:#ae81ff">60</span> GiB avail
</span></span><span style="display:flex;"><span>    pgs:
</span></span></code></pre></div><p>2、创建存储池</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># ceph osd pool create cephfs_data 128</span>
</span></span><span style="display:flex;"><span>pool <span style="color:#e6db74">&#39;cephfs_data&#39;</span> created
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># ceph osd pool create cephfs_metadata 60</span>
</span></span><span style="display:flex;"><span>pool <span style="color:#e6db74">&#39;cephfs_metadata&#39;</span> created
</span></span></code></pre></div><p>3、创建文件系统</p>
<blockquote>
<p>语法：ceph fs new &lt;fs_name&gt; <!-- raw HTML omitted --> <!-- raw HTML omitted --></p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># ceph fs new cephfs cephfs_metadata cephfs_data</span>
</span></span><span style="display:flex;"><span>new fs with metadata pool <span style="color:#ae81ff">2</span> and data pool <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># ceph fs ls</span>
</span></span><span style="display:flex;"><span>name: cephfs, metadata pool: cephfs_metadata, data pools: <span style="color:#f92672">[</span>cephfs_data <span style="color:#f92672">]</span>
</span></span></code></pre></div><p>4、创建文件系统后，MDS 进入活动状态。</p>
<blockquote>
<p>创建了文件系统并且 MDS 处于活动状态（active），就可以挂载文件系统了。</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># ceph mds stat  #1个处于活跃、2个处于热备份</span>
</span></span><span style="display:flex;"><span>cephfs-1/1/1 up  <span style="color:#f92672">{</span>0<span style="color:#f92672">=</span>ceph-1<span style="color:#f92672">=</span>up:active<span style="color:#f92672">}</span>, <span style="color:#ae81ff">2</span> up:standby
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># ceph -s</span>
</span></span><span style="display:flex;"><span>  cluster:
</span></span><span style="display:flex;"><span>    id:     e9ae008c-8567-4af5-a6be-22c75d430f2e
</span></span><span style="display:flex;"><span>    health: HEALTH_OK
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  services:
</span></span><span style="display:flex;"><span>    mon: <span style="color:#ae81ff">1</span> daemons, quorum ceph-1
</span></span><span style="display:flex;"><span>    mgr: ceph-1<span style="color:#f92672">(</span>active<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>    mds: cephfs-1/1/1 up  <span style="color:#f92672">{</span>0<span style="color:#f92672">=</span>ceph-1<span style="color:#f92672">=</span>up:active<span style="color:#f92672">}</span>, <span style="color:#ae81ff">2</span> up:standby
</span></span><span style="display:flex;"><span>    osd: <span style="color:#ae81ff">3</span> osds: <span style="color:#ae81ff">3</span> up, <span style="color:#ae81ff">3</span> in
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  data:
</span></span><span style="display:flex;"><span>    pools:   <span style="color:#ae81ff">2</span> pools, <span style="color:#ae81ff">188</span> pgs
</span></span><span style="display:flex;"><span>    objects: <span style="color:#ae81ff">22</span>  objects, 2.2 KiB
</span></span><span style="display:flex;"><span>    usage:   3.0 GiB used, <span style="color:#ae81ff">57</span> GiB / <span style="color:#ae81ff">60</span> GiB avail
</span></span><span style="display:flex;"><span>    pgs:     <span style="color:#ae81ff">188</span> active+clean
</span></span></code></pre></div><p>5、 <strong>挂载使用cephfs</strong></p>
<blockquote>
<p>再客户端使用命令挂载</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># cat ceph.client.admin.keyring</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>client.admin<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>        key <span style="color:#f92672">=</span> AQCcb5hi9KIrGRAA+4Pq24BCk/JgnkX7WDMiqQ<span style="color:#f92672">==</span>
</span></span><span style="display:flex;"><span>       ...
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-clinet ~<span style="color:#f92672">]</span><span style="color:#75715e"># mount -t ceph 192.168.200.43:6789:/ /mnt -o name=admin,secret=AQCcb5hi9KIrGRAA+4Pq24BCk/JgnkX7WDMiqQ==</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-clinet ~<span style="color:#f92672">]</span><span style="color:#75715e"># df -hT</span>
</span></span><span style="display:flex;"><span>Filesystem              Type      Size  Used Avail Use% Mounted on
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>192.168.200.43:6789:/   ceph       13G     <span style="color:#ae81ff">0</span>   13G   0% /mnt
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-clinet ceph<span style="color:#f92672">]</span><span style="color:#75715e"># umount /mnt  #取消挂载</span>
</span></span></code></pre></div><p>6、密钥文件挂载客户端需要安装ceph-common，否则报错</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-clinet ceph<span style="color:#f92672">]</span><span style="color:#75715e"># cat admin.secret</span>
</span></span><span style="display:flex;"><span>AQCcb5hi9KIrGRAA+4Pq24BCk/JgnkX7WDMiqQ<span style="color:#f92672">==</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-clinet ceph<span style="color:#f92672">]</span><span style="color:#75715e"># mount -t ceph 192.168.200.43:6789:/ /opt/cephfs/ -o name=admin,secret=/etc/ceph/admin.secret</span>
</span></span><span style="display:flex;"><span>mount: wrong fs type, bad option, bad superblock on 192.168.200.43:6789:/,
</span></span><span style="display:flex;"><span>       missing codepage or helper program, or other error
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       In some cases useful info is found in syslog - try
</span></span><span style="display:flex;"><span>       dmesg | tail or so.
</span></span></code></pre></div><p>7、使用 FUSE 挂载 CEPHFS</p>
<blockquote>
<p>ceph -fuse是挂载 CephFS 的另一种方式，尽管它挂载在用户空间。因此，FUSE 的性能可能相对较低，但 FUSE 客户端更易于管理，尤其是在升级 CephFS 时。</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-clinet ceph<span style="color:#f92672">]</span><span style="color:#75715e"># yum install -y ceph-fuse</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># scp /etc/ceph/ceph.client.admin.keyring ceph-client:/etc/ceph</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-clinet ceph<span style="color:#f92672">]</span><span style="color:#75715e"># mkdir /etc/cephfs &amp;&amp; ceph-fuse -m 192.168.200.43:6789 /opt/cephfs/</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-clinet ceph<span style="color:#f92672">]</span><span style="color:#75715e"># df -h</span>
</span></span><span style="display:flex;"><span>Filesystem               Size  Used Avail Use% Mounted on
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>ceph-fuse                 13G     <span style="color:#ae81ff">0</span>   13G   0% /opt/cephfs
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-clinet ceph<span style="color:#f92672">]</span><span style="color:#75715e"># umount /opt/cephfs/</span>
</span></span></code></pre></div><blockquote>
<p>cephfs文件系统配置使用完，给虚拟机做个快照。后面会使用。</p>
</blockquote>
<h2 id="二块存储">二、块存储</h2>
<p>1、创建存储池pool</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># ceph osd pool create block_data 60</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># ceph osd lspools</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span> cephfs_data
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span> cephfs_metadata
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">3</span> block_data
</span></span></code></pre></div><p>2、创建RBD镜像，feature为layering</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e">#  rbd create myimage -s 10G --image-feature layering -p block_data</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e">#  rbd ls -p block_data</span>
</span></span><span style="display:flex;"><span>myimage
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># rbd info myimage -p block_data</span>
</span></span><span style="display:flex;"><span>rbd image <span style="color:#e6db74">&#39;myimage&#39;</span>:
</span></span><span style="display:flex;"><span>        size <span style="color:#ae81ff">10</span> GiB in <span style="color:#ae81ff">2560</span> objects
</span></span><span style="display:flex;"><span>        order <span style="color:#ae81ff">22</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">4</span> MiB objects<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        id: 108b6b8b4567
</span></span><span style="display:flex;"><span>        block_name_prefix: rbd_data.108b6b8b4567
</span></span><span style="display:flex;"><span>        format: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>        features: layering
</span></span><span style="display:flex;"><span>        op_features:
</span></span><span style="display:flex;"><span>        flags:
</span></span><span style="display:flex;"><span>        create_timestamp: Thu Jun  <span style="color:#ae81ff">2</span> 21:33:40 <span style="color:#ae81ff">2022</span>
</span></span></code></pre></div><p>3、将myimage映射为块设备</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># rbd map myimage -p block_data</span>
</span></span><span style="display:flex;"><span>/dev/rbd0
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># rbd showmapped</span>
</span></span><span style="display:flex;"><span>id pool       image   snap device
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0</span>  block_data myimage -    /dev/rbd0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># lsblk</span>
</span></span><span style="display:flex;"><span>NAME                        MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>rbd0                        252:0    <span style="color:#ae81ff">0</span>   10G  <span style="color:#ae81ff">0</span> disk
</span></span></code></pre></div><p>4、格式化挂载使用</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># mkfs.xfs /dev/rbd0</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># mount /dev/rbd0 /mnt</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># df -h</span>
</span></span><span style="display:flex;"><span>Filesystem               Size  Used Avail Use% Mounted on
</span></span><span style="display:flex;"><span>/dev/mapper/centos-root   50G  1.6G   49G   4% /
</span></span><span style="display:flex;"><span>devtmpfs                 899M     <span style="color:#ae81ff">0</span>  899M   0% /dev
</span></span><span style="display:flex;"><span>tmpfs                    911M     <span style="color:#ae81ff">0</span>  911M   0% /dev/shm
</span></span><span style="display:flex;"><span>tmpfs                    911M  9.6M  902M   2% /run
</span></span><span style="display:flex;"><span>tmpfs                    911M     <span style="color:#ae81ff">0</span>  911M   0% /sys/fs/cgroup
</span></span><span style="display:flex;"><span>/dev/sda1               1014M  142M  873M  14% /boot
</span></span><span style="display:flex;"><span>/dev/mapper/centos-home   47G   33M   47G   1% /home
</span></span><span style="display:flex;"><span>tmpfs                    183M     <span style="color:#ae81ff">0</span>  183M   0% /run/user/0
</span></span><span style="display:flex;"><span>tmpfs                    911M   52K  911M   1% /var/lib/ceph/osd/ceph-0
</span></span><span style="display:flex;"><span>/dev/rbd0                 10G   33M   10G   1% /mnt
</span></span></code></pre></div><h2 id="三对象存储">三、对象存储</h2>
<blockquote>
<p>在使用对象存储之前，使用我们cephfs快照。（如果安装了块存储，这里的对象存储网关启动不了，原因不明。）</p>
</blockquote>
<p>1、在 ceph-1 上通过 ceph-deploy 将 ceph-radosgw 软件包安装到 ceph-1 中</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># ceph-deploy install --rgw ceph-1</span>
</span></span></code></pre></div><p>2、创建RGW服务</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># ceph-deploy rgw create ceph-1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># ps -ef | grep radosgw</span>
</span></span><span style="display:flex;"><span>ceph        <span style="color:#ae81ff">2347</span>       <span style="color:#ae81ff">1</span>  <span style="color:#ae81ff">2</span> 15:50 ?        00:00:00 /usr/bin/radosgw -f --cluster ceph --name client.rgw.ceph-1 --setuser ceph --setgroup ceph
</span></span><span style="display:flex;"><span>root        <span style="color:#ae81ff">2962</span>    <span style="color:#ae81ff">1771</span>  <span style="color:#ae81ff">0</span> 15:51 pts/0    00:00:00 grep --color<span style="color:#f92672">=</span>auto radosgw
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># systemctl status ceph-radosgw\*</span>
</span></span><span style="display:flex;"><span>● ceph-radosgw@rgw.ceph-1.service - Ceph rados gateway
</span></span><span style="display:flex;"><span>   Loaded: loaded <span style="color:#f92672">(</span>/usr/lib/systemd/system/ceph-radosgw@.service; enabled; vendor preset: disabled<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>   Active: active <span style="color:#f92672">(</span>running<span style="color:#f92672">)</span> since Fri 2022-06-03 15:50:45 CST; 31s ago
</span></span><span style="display:flex;"><span> Main PID: <span style="color:#ae81ff">2347</span> <span style="color:#f92672">(</span>radosgw<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>   CGroup: /system.slice/system-ceph<span style="color:#ae81ff">\x</span>2dradosgw.slice/ceph-radosgw@rgw.ceph-1.service
</span></span><span style="display:flex;"><span>           └─2347 /usr/bin/radosgw -f --cluster ceph --name client.rgw.ceph-1 --setuser ceph --setgroup ceph
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Jun <span style="color:#ae81ff">03</span> 15:50:45 ceph-1 systemd<span style="color:#f92672">[</span>1<span style="color:#f92672">]</span>: Started Ceph rados gateway.
</span></span><span style="display:flex;"><span>Jun <span style="color:#ae81ff">03</span> 15:50:45 ceph-1 systemd<span style="color:#f92672">[</span>1<span style="color:#f92672">]</span>: Starting Ceph rados gateway...
</span></span></code></pre></div><p>3、访问RGW</p>
<blockquote>
<p>RGW默认端口 7480</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># yum install -y net-tools</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># netstat -tnplu</span>
</span></span><span style="display:flex;"><span>Active Internet connections <span style="color:#f92672">(</span>only servers<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 0.0.0.0:7480            0.0.0.0:*               LISTEN      2347/radosgw
</span></span></code></pre></div><p>浏览器访问http://192.168.200.43:7480/
<img
    class="lazyload"
    src="/liudongdong1.github.io/svg/loading.min.svg"
    data-src="../../../../blogimgv2022/417588d72b0a425dadfa0c6a3ae7ff55.png"
    data-srcset="../../../../blogimgv2022/417588d72b0a425dadfa0c6a3ae7ff55.png, ../../../../blogimgv2022/417588d72b0a425dadfa0c6a3ae7ff55.png 1.5x, ../../../../blogimgv2022/417588d72b0a425dadfa0c6a3ae7ff55.png 2x"
    data-sizes="auto"
    alt="在这里插入图片描述"
    title="在这里插入图片描述"/></p>
<h3 id="使用-s3-访问-rgw">使用 S3 访问 RGW</h3>
<p>1、创建 s3 的兼容用户</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># radosgw-admin user create --uid ceph-s3-user --display-name &#34;Ceph S3 User Demo&#34;</span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;keys&#34;</span>: <span style="color:#f92672">[</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">{</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;user&#34;</span>: <span style="color:#e6db74">&#34;ceph-s3-user&#34;</span>, 
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;access_key&#34;</span>: <span style="color:#e6db74">&#34;V3J9L4M1WKV5O5ECAKPU&#34;</span>, 
</span></span><span style="display:flex;"><span>           <span style="color:#e6db74">&#34;secret_key&#34;</span>:<span style="color:#e6db74">&#34;f5LqLVYOVNu38cuQwi0jXC2ZTboCSJDmdvB8oeYw&#34;</span> 
</span></span><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span> 
</span></span></code></pre></div><blockquote>
<p>access_key 与 secret_key 这里可以记录一下，也可以使用命令再次查看。</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># radosgw-admin user info --uid ceph-s3-user </span>
</span></span></code></pre></div><h3 id="使用命令行方式操作-rgw">使用命令行方式操作 rgw</h3>
<p>1、配置命令行工具</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># yum -y install s3cmd </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># s3cmd --configure</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Enter new values or accept defaults in brackets with Enter.
</span></span><span style="display:flex;"><span>Refer to user manual <span style="color:#66d9ef">for</span> detailed description of all options.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Access key and Secret key are your identifiers <span style="color:#66d9ef">for</span> Amazon S3. Leave them empty <span style="color:#66d9ef">for</span> using the env variables.
</span></span><span style="display:flex;"><span>Access Key: 82EWM49KPWGFVR0CWSD4  <span style="color:#75715e">#输入用户Access </span>
</span></span><span style="display:flex;"><span>Secret Key: 129CSMM9Dk3CC1lZwM7kn75lXMhrWBAMPEuyJL5k <span style="color:#75715e">##输入用户Secret </span>
</span></span><span style="display:flex;"><span>Default Region <span style="color:#f92672">[</span>US<span style="color:#f92672">]</span>: <span style="color:#75715e">#默认回车</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Use <span style="color:#e6db74">&#34;s3.amazonaws.com&#34;</span> <span style="color:#66d9ef">for</span> S3 Endpoint and not modify it to the target Amazon S3.
</span></span><span style="display:flex;"><span>S3 Endpoint <span style="color:#f92672">[</span>s3.amazonaws.com<span style="color:#f92672">]</span>: 192.168.200.43:7480  <span style="color:#75715e">#输入Rgw服务地址</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Use <span style="color:#e6db74">&#34;%(bucket)s.s3.amazonaws.com&#34;</span> to the target Amazon S3. <span style="color:#e6db74">&#34;%(bucket)s&#34;</span> and <span style="color:#e6db74">&#34;%(location)s&#34;</span> vars can be used
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> the target S3 system supports dns based buckets.
</span></span><span style="display:flex;"><span>DNS-style bucket+hostname:port template <span style="color:#66d9ef">for</span> accessing a bucket <span style="color:#f92672">[</span>%<span style="color:#f92672">(</span>bucket<span style="color:#f92672">)</span>s.s3.amazonaws.com<span style="color:#f92672">]</span>: 192.168.200.43:7480/%<span style="color:#f92672">(</span>bucket<span style="color:#f92672">)</span>s  <span style="color:#75715e">#输入</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Encryption password is used to protect your files from reading
</span></span><span style="display:flex;"><span>by unauthorized persons <span style="color:#66d9ef">while</span> in transfer to S3
</span></span><span style="display:flex;"><span>Encryption password:  <span style="color:#75715e">##默认回车</span>
</span></span><span style="display:flex;"><span>Path to GPG program <span style="color:#f92672">[</span>/usr/bin/gpg<span style="color:#f92672">]</span>: <span style="color:#75715e">##默认回车</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>When using secure HTTPS protocol all communication with Amazon S3
</span></span><span style="display:flex;"><span>servers is protected from 3rd party eavesdropping. This method is
</span></span><span style="display:flex;"><span>slower than plain HTTP, and can only be proxied with Python 2.7 or newer
</span></span><span style="display:flex;"><span>Use HTTPS protocol <span style="color:#f92672">[</span>Yes<span style="color:#f92672">]</span>: no  <span style="color:#75715e">#输入no</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>On some networks all internet access must go through a HTTP proxy.
</span></span><span style="display:flex;"><span>Try setting it here <span style="color:#66d9ef">if</span> you can<span style="color:#e6db74">&#39;t connect to S3 directly
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">HTTP Proxy server name:   
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">New settings:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  Access Key: 82EWM49KPWGFVR0CWSD4
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  Secret Key: 129CSMM9Dk3CC1lZwM7kn75lXMhrWBAMPEuyJL5k
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  Default Region: US
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  S3 Endpoint: 192.168.200.43:7480  ##输入Rgw服务地址
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  DNS-style bucket+hostname:port template for accessing a bucket: 192.168.200.43:7480/%(bucket)s
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  Encryption password:  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  Path to GPG program: /usr/bin/gpg
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  Use HTTPS protocol: False
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  HTTP Proxy server name: 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  HTTP Proxy server port: 0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Test access with supplied credentials? [Y/n] y  #输入y
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Please wait, attempting to list all buckets...
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Success. Your access key and secret key worked fine :-)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Now verifying that encryption works...
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Not configured. Never mind.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Save settings? [y/N] y  #输入y
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Configuration saved to &#39;</span>/root/.s3cfg<span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span></code></pre></div><p>2、这是需要修改版本，启用v2版本即可</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ~<span style="color:#f92672">]</span><span style="color:#75715e"># s3cmd mb s3://s3cmd-demo</span>
</span></span><span style="display:flex;"><span>ERROR: S3 error: <span style="color:#ae81ff">403</span> <span style="color:#f92672">(</span>SignatureDoesNotMatch<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># sed -i &#39;/signature_v2/s/False/True/g&#39; /root/.s3cfg</span>
</span></span></code></pre></div><p>3、创建</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># s3cmd mb s3://s3cmd-demo</span>
</span></span><span style="display:flex;"><span>Bucket <span style="color:#e6db74">&#39;s3://s3cmd-demo/&#39;</span> created
</span></span></code></pre></div><p>4、上传</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># s3cmd put /etc/fstab s3://s3cmd-demo/fatab-demo</span>
</span></span><span style="display:flex;"><span>upload: <span style="color:#e6db74">&#39;/etc/fstab&#39;</span> -&gt; <span style="color:#e6db74">&#39;s3://s3cmd-demo/fatab-demo&#39;</span>  <span style="color:#f92672">[</span><span style="color:#ae81ff">1</span> of 1<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">541</span> of <span style="color:#ae81ff">541</span>   100% in    1s   327.08 B/s  <span style="color:#66d9ef">done</span>
</span></span></code></pre></div><p>5、下载</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># s3cmd get s3://s3cmd-demo/fatab-demo</span>
</span></span><span style="display:flex;"><span>download: <span style="color:#e6db74">&#39;s3://s3cmd-demo/fatab-demo&#39;</span> -&gt; <span style="color:#e6db74">&#39;./fatab-demo&#39;</span>  <span style="color:#f92672">[</span><span style="color:#ae81ff">1</span> of 1<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">541</span> of <span style="color:#ae81ff">541</span>   100% in    0s    39.79 KB/s  <span style="color:#66d9ef">done</span>
</span></span></code></pre></div><p>6、删除</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ceph-1 ceph<span style="color:#f92672">]</span><span style="color:#75715e"># s3cmd del s3://s3cmd-demo/fatab-demo</span>
</span></span><span style="display:flex;"><span>delete: <span style="color:#e6db74">&#39;s3://s3cmd-demo/fatab-demo&#39;</span>
</span></span></code></pre></div><h1 id="k8s-provision-对接ceph存储">K8s-provision 对接Ceph存储</h1>
<h3 id="cephrbd">CephRBD</h3>
<h4 id="配置-rbd-provisioner">配置 rbd-provisioner</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ae81ff">cat &gt;external-storage-rbd-provisioner.yaml&lt;&lt;EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ServiceAccount</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">rbd-provisioner</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">kube-system</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterRole</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">rbd-provisioner</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">rules</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resources</span>: [<span style="color:#e6db74">&#34;persistentvolumes&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">verbs</span>: [<span style="color:#e6db74">&#34;get&#34;</span>, <span style="color:#e6db74">&#34;list&#34;</span>, <span style="color:#e6db74">&#34;watch&#34;</span>, <span style="color:#e6db74">&#34;create&#34;</span>, <span style="color:#e6db74">&#34;delete&#34;</span>]
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resources</span>: [<span style="color:#e6db74">&#34;persistentvolumeclaims&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">verbs</span>: [<span style="color:#e6db74">&#34;get&#34;</span>, <span style="color:#e6db74">&#34;list&#34;</span>, <span style="color:#e6db74">&#34;watch&#34;</span>, <span style="color:#e6db74">&#34;update&#34;</span>]
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;storage.k8s.io&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resources</span>: [<span style="color:#e6db74">&#34;storageclasses&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">verbs</span>: [<span style="color:#e6db74">&#34;get&#34;</span>, <span style="color:#e6db74">&#34;list&#34;</span>, <span style="color:#e6db74">&#34;watch&#34;</span>]
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resources</span>: [<span style="color:#e6db74">&#34;events&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">verbs</span>: [<span style="color:#e6db74">&#34;create&#34;</span>, <span style="color:#e6db74">&#34;update&#34;</span>, <span style="color:#e6db74">&#34;patch&#34;</span>]
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resources</span>: [<span style="color:#e6db74">&#34;endpoints&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">verbs</span>: [<span style="color:#e6db74">&#34;get&#34;</span>, <span style="color:#e6db74">&#34;list&#34;</span>, <span style="color:#e6db74">&#34;watch&#34;</span>, <span style="color:#e6db74">&#34;create&#34;</span>, <span style="color:#e6db74">&#34;update&#34;</span>, <span style="color:#e6db74">&#34;patch&#34;</span>]
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resources</span>: [<span style="color:#e6db74">&#34;services&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resourceNames</span>: [<span style="color:#e6db74">&#34;kube-dns&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">verbs</span>: [<span style="color:#e6db74">&#34;list&#34;</span>, <span style="color:#e6db74">&#34;get&#34;</span>]
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterRoleBinding</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">rbd-provisioner</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">subjects</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ServiceAccount</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">rbd-provisioner</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">kube-system</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">roleRef</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterRole</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">rbd-provisioner</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">apiGroup</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Role</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">rbd-provisioner</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">kube-system</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">rules</span>:
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;&#34;</span>]
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">resources</span>: [<span style="color:#e6db74">&#34;secrets&#34;</span>]
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">verbs</span>: [<span style="color:#e6db74">&#34;get&#34;</span>]
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">RoleBinding</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">rbd-provisioner</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">kube-system</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">roleRef</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">apiGroup</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Role</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">rbd-provisioner</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">subjects</span>:
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ServiceAccount</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">rbd-provisioner</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">kube-system</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">rbd-provisioner</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">kube-system</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">app</span>: <span style="color:#ae81ff">rbd-provisioner</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">strategy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">Recreate</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">app</span>: <span style="color:#ae81ff">rbd-provisioner</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">rbd-provisioner</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#e6db74">&#34;quay.io/external_storage/rbd-provisioner:v2.0.0-k8s1.11&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">env</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">PROVISIONER_NAME</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">value</span>: <span style="color:#ae81ff">ceph.com/rbd</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">serviceAccount</span>: <span style="color:#ae81ff">rbd-provisioner</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">kubectl apply -f external-storage-rbd-provisioner.yaml</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 查看状态 等待running之后 再进行后续的操作</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">kubectl get pod -n kube-system</span>
</span></span></code></pre></div><h4 id="配置storageclass">配置StorageClass</h4>
<pre tabindex="0"><code>1、创建pod时，kubelet需要使用rbd命令去检测和挂载pv对应的ceph image，所以要在所有的worker节点安装ceph客户端ceph-common。
将ceph的ceph.client.admin.keyring和ceph.conf文件拷贝到master的/etc/ceph目录下
yum -y install ceph-common
2、创建 osd pool 在ceph的mon或者admin节点
ceph osd pool create kube 128 128  
ceph osd pool ls
3、创建k8s访问ceph的用户 在ceph的mon或者admin节点
ceph auth get-or-create client.kube mon &#39;allow r&#39; osd &#39;allow class-read object_prefix rbd_children, allow rwx pool=kube&#39; -o ceph.client.kube.keyring
4、查看key 在ceph的mon或者admin节点
ceph auth get-key client.admin
ceph auth get-key client.kube
5、创建 admin secret
kubectl create secret generic ceph-secret --type=&#34;kubernetes.io/rbd&#34; \
--from-literal=key=AQCtovZdgFEhARAAoKhLtquAyM8ROvmBv55Jig== \
--namespace=kube-system
6、在 default 命名空间创建pvc用于访问ceph的 secret
kubectl create secret generic ceph-user-secret --type=&#34;kubernetes.io/rbd&#34; \
--from-literal=key=AQAM9PxdEFi3AhAAzvvhuyk1AfN5twlY+4zNMA== \
--namespace=default
</code></pre><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ae81ff">cat &gt;storageclass-ceph-rdb.yaml&lt;&lt;EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">StorageClass</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">storage.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">dynamic-ceph-rdb</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">provisioner</span>: <span style="color:#ae81ff">ceph.com/rbd</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">parameters</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">monitors</span>: <span style="color:#ae81ff">192.168.0.201</span>:<span style="color:#ae81ff">6789</span>,<span style="color:#ae81ff">192.168.0.202</span>:<span style="color:#ae81ff">6789</span>,<span style="color:#ae81ff">192.168.0.203</span>:<span style="color:#ae81ff">6789</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">adminId</span>: <span style="color:#ae81ff">admin</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">adminSecretName</span>: <span style="color:#ae81ff">ceph-secret</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">adminSecretNamespace</span>: <span style="color:#ae81ff">kube-system</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">pool</span>: <span style="color:#ae81ff">kube</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">userId</span>: <span style="color:#ae81ff">kube</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">userSecretName</span>: <span style="color:#ae81ff">ceph-user-secret</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">fsType</span>: <span style="color:#ae81ff">ext4</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">imageFormat</span>: <span style="color:#e6db74">&#34;2&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">imageFeatures</span>: <span style="color:#e6db74">&#34;layering&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">EOF</span>
</span></span></code></pre></div><pre tabindex="0"><code>kubectl apply -f storageclass-ceph-rdb.yaml  
kubectl get storageclasses 
</code></pre><h4 id="声明使用pvc">声明使用PVC</h4>
<pre tabindex="0"><code>cat &gt;ceph-rdb-pvc-test.yaml&lt;&lt;EOF
kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: ceph-rdb-claim
spec:
  accessModes:     
    - ReadWriteOnce
  storageClassName: dynamic-ceph-rdb
  resources:
    requests:
      storage: 2Gi
EOF
kubectl apply -f ceph-rdb-pvc-test.yaml
</code></pre><h4 id="应用声明使用pvc">应用声明使用PVC</h4>
<pre tabindex="0"><code>cat &gt;nginx-pod.yaml&lt;&lt;EOF
apiVersion: v1
kind: Pod
metadata:
  name: nginx-pod1
  labels:
    name: nginx-pod1
spec:
  containers:
  - name: nginx-pod1
    image: nginx:alpine
    ports:
    - name: web
      containerPort: 80
    volumeMounts:
    - name: ceph-rdb
      mountPath: /usr/share/nginx/html
  volumes:
  - name: ceph-rdb
    persistentVolumeClaim:
      claimName: ceph-rdb-claim
EOF
kubectl apply -f nginx-pod.yaml
</code></pre><h3 id="cephfs">CephFS</h3>
<pre tabindex="0"><code># 在cephfs 的 mon或者admin节点
ceph osd pool create fs_data 128
ceph osd pool create fs_metadata 128
ceph osd lspools

# 创建cephfs 文件系统
ceph fs new cephfs fs_metadata fs_data
ceph fs ls
</code></pre><h4 id="配置-ceph-fs-provisioner">配置 ceph-fs-provisioner</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ae81ff">cat &gt;external-storage-cephfs-provisioner.yaml&lt;&lt;EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Namespace</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">name</span>: <span style="color:#ae81ff">cephfs</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">name</span>: <span style="color:#ae81ff">cephfs</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ServiceAccount</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">cephfs-provisioner</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">cephfs</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Role</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">cephfs-provisioner</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">cephfs</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">rules</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resources</span>: [<span style="color:#e6db74">&#34;secrets&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">verbs</span>: [<span style="color:#e6db74">&#34;create&#34;</span>, <span style="color:#e6db74">&#34;get&#34;</span>, <span style="color:#e6db74">&#34;delete&#34;</span>]
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resources</span>: [<span style="color:#e6db74">&#34;endpoints&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">verbs</span>: [<span style="color:#e6db74">&#34;get&#34;</span>, <span style="color:#e6db74">&#34;list&#34;</span>, <span style="color:#e6db74">&#34;watch&#34;</span>, <span style="color:#e6db74">&#34;create&#34;</span>, <span style="color:#e6db74">&#34;update&#34;</span>, <span style="color:#e6db74">&#34;patch&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterRole</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">cephfs-provisioner</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">cephfs</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">rules</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resources</span>: [<span style="color:#e6db74">&#34;persistentvolumes&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">verbs</span>: [<span style="color:#e6db74">&#34;get&#34;</span>, <span style="color:#e6db74">&#34;list&#34;</span>, <span style="color:#e6db74">&#34;watch&#34;</span>, <span style="color:#e6db74">&#34;create&#34;</span>, <span style="color:#e6db74">&#34;delete&#34;</span>]
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resources</span>: [<span style="color:#e6db74">&#34;persistentvolumeclaims&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">verbs</span>: [<span style="color:#e6db74">&#34;get&#34;</span>, <span style="color:#e6db74">&#34;list&#34;</span>, <span style="color:#e6db74">&#34;watch&#34;</span>, <span style="color:#e6db74">&#34;update&#34;</span>]
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;storage.k8s.io&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resources</span>: [<span style="color:#e6db74">&#34;storageclasses&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">verbs</span>: [<span style="color:#e6db74">&#34;get&#34;</span>, <span style="color:#e6db74">&#34;list&#34;</span>, <span style="color:#e6db74">&#34;watch&#34;</span>]
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resources</span>: [<span style="color:#e6db74">&#34;events&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">verbs</span>: [<span style="color:#e6db74">&#34;create&#34;</span>, <span style="color:#e6db74">&#34;update&#34;</span>, <span style="color:#e6db74">&#34;patch&#34;</span>]
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resources</span>: [<span style="color:#e6db74">&#34;services&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resourceNames</span>: [<span style="color:#e6db74">&#34;kube-dns&#34;</span>,<span style="color:#e6db74">&#34;coredns&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">verbs</span>: [<span style="color:#e6db74">&#34;list&#34;</span>, <span style="color:#e6db74">&#34;get&#34;</span>]
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resources</span>: [<span style="color:#e6db74">&#34;secrets&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">verbs</span>: [<span style="color:#e6db74">&#34;get&#34;</span>, <span style="color:#e6db74">&#34;create&#34;</span>, <span style="color:#e6db74">&#34;delete&#34;</span>]
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">apiGroups</span>: [<span style="color:#e6db74">&#34;policy&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resourceNames</span>: [<span style="color:#e6db74">&#34;cephfs-provisioner&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">resources</span>: [<span style="color:#e6db74">&#34;podsecuritypolicies&#34;</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">verbs</span>: [<span style="color:#e6db74">&#34;use&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">RoleBinding</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">cephfs-provisioner</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">cephfs</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">roleRef</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">apiGroup</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Role</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">cephfs-provisioner</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">subjects</span>:
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ServiceAccount</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">cephfs-provisioner</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterRoleBinding</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">cephfs-provisioner</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">subjects</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ServiceAccount</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">cephfs-provisioner</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">cephfs</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">roleRef</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ClusterRole</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">cephfs-provisioner</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">apiGroup</span>: <span style="color:#ae81ff">rbac.authorization.k8s.io</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">cephfs-provisioner</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">cephfs</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">app</span>: <span style="color:#ae81ff">cephfs-provisioner</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">strategy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">Recreate</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">app</span>: <span style="color:#ae81ff">cephfs-provisioner</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">cephfs-provisioner</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#e6db74">&#34;quay.io/external_storage/cephfs-provisioner:latest&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">env</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">PROVISIONER_NAME</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">value</span>: <span style="color:#ae81ff">ceph.com/cephfs</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">command</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#e6db74">&#34;/usr/local/bin/cephfs-provisioner&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">args</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#e6db74">&#34;-id=cephfs-provisioner-1&#34;</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#e6db74">&#34;-disable-ceph-namespace-isolation=true&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">serviceAccount</span>: <span style="color:#ae81ff">cephfs-provisioner</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">kubectl apply -f external-storage-cephfs-provisioner.yaml</span>
</span></span></code></pre></div><h4 id="配置storageclass-1">配置storageclass</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ae81ff">cat &gt;storageclass-cephfs.yaml&lt;&lt;EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">StorageClass</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">storage.k8s.io/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">dynamic-cephfs</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">provisioner</span>: <span style="color:#ae81ff">ceph.com/cephfs</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">parameters</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">monitors</span>: <span style="color:#ae81ff">192.168.0.101</span>:<span style="color:#ae81ff">6789</span>,<span style="color:#ae81ff">192.168.0.102</span>:<span style="color:#ae81ff">6789</span>,<span style="color:#ae81ff">192.168.0.103</span>:<span style="color:#ae81ff">6789</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">adminId</span>: <span style="color:#ae81ff">admin</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">adminSecretName</span>: <span style="color:#ae81ff">ceph-secret</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">adminSecretNamespace</span>: <span style="color:#e6db74">&#34;kube-system&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">claimRoot</span>: <span style="color:#ae81ff">/volumes/kubernetes</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">EOF</span>
</span></span></code></pre></div><h4 id="创建pvc">创建pvc</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ae81ff">cat &gt;cephfs-pvc-test.yaml&lt;&lt;EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">PersistentVolumeClaim</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">cephfs-claim</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">accessModes</span>:     
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">ReadWriteOnce</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">storageClassName</span>: <span style="color:#ae81ff">dynamic-cephfs</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">requests</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">storage</span>: <span style="color:#ae81ff">2Gi</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">kubectl apply -f cephfs-pvc-test.yaml</span>
</span></span></code></pre></div><h4 id="用户声明使用pvc">用户声明使用pvc</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ae81ff">cat &gt;nginx-pod.yaml&lt;&lt;EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-pod2</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-pod2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-pod2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">web</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">volumeMounts</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">cephfs</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/usr/share/nginx/html</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">cephfs</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">persistentVolumeClaim</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">claimName</span>: <span style="color:#ae81ff">cephfs-claim</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">EOF</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">kubectl apply -f nginx-pod.yaml</span>
</span></span></code></pre></div><h1 id="参考资料">参考资料</h1>
<ul>
<li><a href="https://docs.ceph.com/en/latest/"target="_blank" rel="external nofollow noopener noreferrer">https://docs.ceph.com/en/latest/<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></li>
<li>From：https://bbs.huaweicloud.com/blogs/358172</li>
<li>Ceph 和K8s 存储对接：https://blog.jairmir.com/index.php/2021/03/27/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8ceph%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%E5%AE%9E%E6%88%98/#1PVPVC</li>
<li>Ceph 和K8s 存储对接 <a href="https://www.cnblogs.com/lvzhenjiang/p/15377425.html"target="_blank" rel="external nofollow noopener noreferrer">https://www.cnblogs.com/lvzhenjiang/p/15377425.html<i class="fa-solid fa-external-link-alt fa-fw fa-xs ms-1 text-secondary" aria-hidden="true"></i></a></li>
</ul>
</div>
<div class="post-footer" id="post-footer">
  <div class="post-info">
    <div class="post-info-line">
      <div class="post-info-mod">
        <span title=2023-09-24&#32;17:00:04>更新于 2023-09-24&nbsp;</span>
      </div><div class="post-info-license">
          <span><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span>
        </div></div>
    <div class="post-info-line">
      <div class="post-info-md"><span><a href="liudongdong1.github.io/kubernetes_%E5%AD%98%E5%82%A8-ceph/index.md" title="阅读原始文档" class="link-to-markdown">阅读原始文档</a></span><span><a href="https://liudongdong1.github.io/edit/master/content/posts%5c%e5%ad%98%e5%82%a8%e8%ae%be%e8%ae%a1%5c%e8%99%9a%e6%8b%9f%e5%8c%96%e6%8a%80%e6%9c%af%5cKubernetes_%e5%ad%98%e5%82%a8-ceph.md" title="编辑此页"target="_blank" rel="external nofollow noopener noreferrer" class="link-to-edit">编辑此页</a></span></div>
      <div class="post-info-share">
        <span><a href="javascript:void(0);" title="分享到 Twitter" data-sharer="twitter" data-url="liudongdong1.github.io/kubernetes_%E5%AD%98%E5%82%A8-ceph/" data-title="Kubernetes-_存储-ceph" data-hashtags="Storage"><i class="fa-brands fa-twitter fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 Facebook" data-sharer="facebook" data-url="liudongdong1.github.io/kubernetes_%E5%AD%98%E5%82%A8-ceph/" data-hashtag="Storage"><i class="fa-brands fa-facebook-square fa-fw" aria-hidden="true"></i></a>
  <a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="liudongdong1.github.io/kubernetes_%E5%AD%98%E5%82%A8-ceph/" data-title="Kubernetes-_存储-ceph"><i class="fa-brands fa-weibo fa-fw" aria-hidden="true"></i></a>
  </span>
      </div>
    </div>
  </div>

  <div class="post-info-more">
    <section class="post-tags"><i class="fa-solid fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="liudongdong1.github.io/tags/storage/">Storage</a></section>
    <section>
      <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="liudongdong1.github.io/">主页</a></span>
    </section>
  </div>

  <div class="post-nav"><a href="liudongdong1.github.io/argobots/" class="prev" rel="prev" title="argobots"><i class="fa-solid fa-angle-left fa-fw" aria-hidden="true"></i>argobots</a>
      <a href="liudongdong1.github.io/rpc%E6%A1%86%E6%9E%B6_mercury/" class="next" rel="next" title="rpc框架-mercury">rpc框架-mercury<i class="fa-solid fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></main><footer class="footer">
    <div class="footer-container"><div class="footer-line powered">由 <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreferrer" title="Hugo 0.118.2">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/hugo-fixit/FixIt" target="_blank" rel="external" title="FixIt v0.2.17-RC"><img class="fixit-icon" src="/liudongdong1.github.io/fixit.min.svg" alt="FixIt logo" />&nbsp;FixIt</a>
        </div><div class="footer-line copyright" itemscope itemtype="http://schema.org/CreativeWork"><i class="fa-regular fa-copyright fa-fw" aria-hidden="true"></i>
            <span itemprop="copyrightYear">2020 - 2023</span><span class="author" itemprop="copyrightHolder">
              <a href="https://liudongdong1.github.io/"target="_blank" rel="external nofollow noopener noreferrer">LiuDongdong</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div><div class="footer-line statistics"><span class="site-time" title='网站运行中 ...'><i class="fa-solid fa-heartbeat fa-fw animate-icon" aria-hidden="true"></i>&nbsp;<span class="run-times">网站运行中 ...</span></span></div><div class="footer-line ibruce">
          <span id="busuanzi_container_site_uv" title='总访客数'><i class="fa-regular fa-user fa-fw" aria-hidden="true"></i>&nbsp;<span id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span><span id="busuanzi_container_site_pv" class="footer-divider" title='总访问量'><i class="fa-regular fa-eye fa-fw" aria-hidden="true"></i>&nbsp;<span id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span></span>
        </div></div>
  </footer></div><div class="widgets"><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role="button" aria-label="回到顶部"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden="true"></i><span class="variant-numeric">0%</span>
        </div></div><a href="https://liudongdong1.github.io/" title="在 GitHub 上查看源代码"target="_blank" rel="external nofollow" class="github-corner right d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><div id="mask"></div><div class="reading-progress-bar" style="left: 0;top: 0;--bg-progress: #0076ff;--bg-progress-dark: #fff;"></div><noscript>
    <div class="noscript-warning">FixIt 主题在启用 JavaScript 的情况下效果最佳。</div>
  </noscript>
</div><link rel="stylesheet" href="/liudongdong1.github.io/lib/katex/katex.min.css"><link rel="stylesheet" href="/liudongdong1.github.io/lib/cookieconsent/cookieconsent.min.css"><script src="/liudongdong1.github.io/lib/autocomplete/autocomplete.min.js" defer></script><script src="/liudongdong1.github.io/lib/algoliasearch/algoliasearch-lite.umd.min.js" defer></script><script src="/liudongdong1.github.io/lib/lazysizes/lazysizes.min.js" async defer></script><script src="/liudongdong1.github.io/lib/sharer/sharer.min.js" async defer></script><script src="/liudongdong1.github.io/lib/typeit/index.umd.js" defer></script><script src="/liudongdong1.github.io/lib/katex/katex.min.js" defer></script><script src="/liudongdong1.github.io/lib/katex/auto-render.min.js" defer></script><script src="/liudongdong1.github.io/lib/katex/copy-tex.min.js" defer></script><script src="/liudongdong1.github.io/lib/katex/mhchem.min.js" defer></script><script src="/liudongdong1.github.io/lib/cookieconsent/cookieconsent.min.js" defer></script><script src="/liudongdong1.github.io/lib/pangu/pangu.min.js" defer></script><script src="/liudongdong1.github.io/lib/cell-watermark/watermark.min.js" defer></script><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async defer></script><script>window.config={"code":{"copyTitle":"复制到剪贴板","editLockTitle":"锁定可编辑代码块","editUnLockTitle":"解锁可编辑代码块","editable":true,"maxShownLines":10},"comment":{"enable":false},"cookieconsent":{"content":{"dismiss":"同意","link":"了解更多","message":"本网站使用 Cookies 来改善您的浏览体验。"},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"data":{"typeit-header-subtitle-desktop":"\u003cspan style='font-family: MMT,\"沐目体\";'\u003e吾日三省吾身\u003c/span\u003e","typeit-header-subtitle-mobile":"\u003cspan style='font-family: MMT,\"沐目体\";'\u003e吾日三省吾身\u003c/span\u003e"},"enablePWA":true,"enablePangu":true,"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"algoliaAppID":"2R1K9SKLQZ","algoliaIndex":"index.zh-cn","algoliaSearchKey":"4a226aa1c5c98d6859e4d1386adb2bc7","highlightTag":"em","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"algolia"},"siteTime":"2020-12-18T16:15:22+08:00","typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"typeit-header-subtitle-desktop":["typeit-header-subtitle-desktop"],"typeit-header-subtitle-mobile":["typeit-header-subtitle-mobile"]},"duration":-1,"speed":100},"watermark":{"appendto":".wrapper\u003emain","colspacing":30,"content":"\u003cimg class=\"fixit-icon\" src=\"/fixit.min.svg\" alt=\"FixIt logo\" /\u003e FixIt 主题","enable":true,"fontfamily":"inherit","fontsize":0.85,"height":21,"opacity":0.0125,"rotate":15,"rowspacing":60,"width":150}};</script><script src="/liudongdong1.github.io/js/theme.min.js" defer></script><script src="/liudongdong1.github.io/js/custom.min.js" defer></script></body>
</html>
