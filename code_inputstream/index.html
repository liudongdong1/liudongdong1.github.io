<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>Code_InputStream - DAY By DAY</title><meta name=author content="LiuDongdong"><meta name=author-link content="https://liudongdong1.github.io/"><meta name=description content="1. InputStream 抽象类 public abstract int read() // 读取数据 public int read(byte b[]) // 将读取到的数据放在 byte 数组中，该方法实际上是根据下面的方法实现的，off 为 0，len 为数组的长度 public int read(byte b[],"><meta name=keywords content="Java,Storage"><meta itemprop=name content="Code_InputStream"><meta itemprop=description content="1. InputStream 抽象类 public abstract int read() // 读取数据 public int read(byte b[]) // 将读取到的数据放在 byte 数组中，该方法实际上是根据下面的方法实现的，off 为 0，len 为数组的长度 public int read(byte b[],"><meta itemprop=datePublished content="2021-05-11T21:31:56+00:00"><meta itemprop=dateModified content="2023-09-28T22:47:27+08:00"><meta itemprop=wordCount content="7058"><meta itemprop=image content="/logo.png"><meta itemprop=keywords content="Java,Storage,"><meta property="og:title" content="Code_InputStream"><meta property="og:description" content="1. InputStream 抽象类 public abstract int read() // 读取数据 public int read(byte b[]) // 将读取到的数据放在 byte 数组中，该方法实际上是根据下面的方法实现的，off 为 0，len 为数组的长度 public int read(byte b[],"><meta property="og:type" content="article"><meta property="og:url" content="liudongdong1.github.io/code_inputstream/"><meta property="og:image" content="/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-05-11T21:31:56+00:00"><meta property="article:modified_time" content="2023-09-28T22:47:27+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/logo.png"><meta name=twitter:title content="Code_InputStream"><meta name=twitter:description content="1. InputStream 抽象类 public abstract int read() // 读取数据 public int read(byte b[]) // 将读取到的数据放在 byte 数组中，该方法实际上是根据下面的方法实现的，off 为 0，len 为数组的长度 public int read(byte b[],"><meta name=application-name content="DAY By DAY"><meta name=apple-mobile-web-app-title content="DAY By DAY"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=liudongdong1.github.io/code_inputstream/><link rel=prev href=liudongdong1.github.io/iteratormode/><link rel=next href=liudongdong1.github.io/strategymode/><link rel=stylesheet href=/liudongdong1.github.io/css/style.min.css><link rel=stylesheet href=/liudongdong1.github.io/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/liudongdong1.github.io/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Code_InputStream","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"liudongdong1.github.io\/code_inputstream\/"},"genre":"posts","keywords":"Java, Storage","wordcount":7058,"url":"liudongdong1.github.io\/code_inputstream\/","datePublished":"2021-05-11T21:31:56+00:00","dateModified":"2023-09-28T22:47:27+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"LiuDongdong","logo":"\/images\/person.png"},"author":{"@type":"Person","name":"liudongdong1"},"description":""}</script></head><body data-header-desktop=auto data-header-mobile=auto><script>(window.localStorage?.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("data-theme","dark")</script><div class=wrapper><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper data-github-corner=right><div class=header-title><a href=liudongdong1.github.io/ title="DAY By DAY"><img class="lazyload logo" src=/liudongdong1.github.io/svg/loading.min.svg data-src=/fixit.min.svg data-srcset="/fixit.min.svg, /fixit.min.svg 1.5x, /fixit.min.svg 2x" data-sizes=auto alt="DAY By DAY" title="DAY By DAY"><span class=header-title-text></span></a><span id=typeit-header-subtitle-desktop class="typeit header-subtitle"></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/liudongdong1.github.io/posts/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 所有文章</a></li><li class=menu-item><a class=menu-link href=/liudongdong1.github.io/categories/><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/liudongdong1.github.io/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class=menu-item><a class=menu-link href=/liudongdong1.github.io/friends/ title=友情链接><i class="fa-solid fa-users fa-fw fa-sm" aria-hidden=true></i> 友链</a></li><li class=menu-item><a class=menu-link href=/liudongdong1.github.io/about/><i class="fa-solid fa-info-circle fa-fw fa-sm" aria-hidden=true></i> 关于</a></li><li class="menu-item delimiter"></li><li class="menu-item language"><span role=button aria-label=选择语言 title=选择语言>简体中文<i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden=true></i></span><ul class=sub-menu><li class=menu-item>没有更多翻译</li></ul></li><li class="menu-item search" id=search-desktop><input type=text placeholder="搜索文章标题或内容 ..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=liudongdong1.github.io/ title="DAY By DAY"><img class="lazyload logo" src=/liudongdong1.github.io/svg/loading.min.svg data-src=/fixit.min.svg data-srcset="/fixit.min.svg, /fixit.min.svg 1.5x, /fixit.min.svg 2x" data-sizes=auto alt=/fixit.min.svg title=/fixit.min.svg><span class=header-title-text></span></a><span id=typeit-header-subtitle-mobile class="typeit header-subtitle"></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="搜索文章标题或内容 ..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fa-solid fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></li><li class=menu-item><a class=menu-link href=/liudongdong1.github.io/posts/><i class="fa-solid fa-archive fa-fw fa-sm" aria-hidden=true></i> 所有文章</a></li><li class=menu-item><a class=menu-link href=/liudongdong1.github.io/categories/><i class="fa-solid fa-th fa-fw fa-sm" aria-hidden=true></i> 分类</a></li><li class=menu-item><a class=menu-link href=/liudongdong1.github.io/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> 标签</a></li><li class=menu-item><a class=menu-link href=/liudongdong1.github.io/friends/ title=友情链接><i class="fa-solid fa-users fa-fw fa-sm" aria-hidden=true></i> 友链</a></li><li class=menu-item><a class=menu-link href=/liudongdong1.github.io/about/><i class="fa-solid fa-info-circle fa-fw fa-sm" aria-hidden=true></i> 关于</a></li><li class="menu-item text-center"><a class=menu-link href=https://liudongdong1.github.io/ title=GitHub rel="noopener noreferrer" target=_blank><i class='fa-brands fa-github fa-fw' aria-hidden=true></i></a></li><li class="menu-item theme-switch" title=切换主题><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li><li class="menu-item language"><span role=button aria-label=选择语言 title=选择语言>简体中文<i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden=true></i></span>
<select class=language-select onchange="location=this.value"><option disabled>没有更多翻译</option></select></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container data-page-style=normal><aside class=toc id=toc-auto><h2 class=toc-title>目录 <i class="toc-icon fa-solid fa-angle-down fa-fw"></i></h2><div class=toc-content id=toc-content-auto></div></aside><aside class=aside-custom id=aside-sakana><div class=sakana-widget><div class=sakana-item id=takina-widget></div><div class=sakana-item id=chisato-widget></div></div><script>function initSakanaWidget(){const e=SakanaWidget.getCharacter("takina");SakanaWidget.registerCharacter("takina-slow",e),new SakanaWidget({character:"takina-slow",controls:!1,autoFit:!0,stroke:{color:"#b4b4b4",width:2}}).mount("#takina-widget");const t=SakanaWidget.getCharacter("chisato");SakanaWidget.registerCharacter("chisato-slow",t),new SakanaWidget({character:"chisato-slow",controls:!1,autoFit:!0,stroke:{color:"#b4b4b4",width:2}}).mount("#chisato-widget")}</script><script async onload=initSakanaWidget() src=https://cdn.jsdelivr.net/npm/sakana-widget@2.3.0/lib/sakana.min.js></script></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>Code_InputStream</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><i class="fa-solid fa-user-circle" aria-hidden=true></i>
liudongdong1</span></span>
<span class=post-category>收录于 <a href=liudongdong1.github.io/categories/><i class="fa-regular fa-folder fa-fw"></i>&nbsp;Categories</a>&ensp;<a href=liudongdong1.github.io/categories/framework/><i class="fa-regular fa-folder fa-fw"></i>&nbsp;Framework</a></span></div><div class=post-meta-line><span title="2021-05-11 21:31:56"><i class="fa-regular fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2021-05-11>2021-05-11</time>
</span>&nbsp;<i class="fa-solid fa-pencil-alt fa-fw"></i>&nbsp;约 7058 字&nbsp;
<i class="fa-regular fa-clock fa-fw"></i>&nbsp;预计阅读 15 分钟&nbsp;<span id=busuanzi_container_page_pv class="busuanzi_visitors comment-visitors" data-flag-title=Code_InputStream>
<i class="fa-regular fa-eye fa-fw"></i>&nbsp;<span id=busuanzi_value_page_pv>-</span>&nbsp;次阅读
</span>&nbsp;</div></div><div class=featured-image><img class=lazyload src=/liudongdong1.github.io/svg/loading.min.svg data-src=https://cdn.stocksnap.io/img-thumbs/280h/workspace-office_CB4OANNVNO.jpg data-srcset="https://cdn.stocksnap.io/img-thumbs/280h/workspace-office_CB4OANNVNO.jpg, https://cdn.stocksnap.io/img-thumbs/280h/workspace-office_CB4OANNVNO.jpg 1.5x, https://cdn.stocksnap.io/img-thumbs/280h/workspace-office_CB4OANNVNO.jpg 2x" data-sizes=auto alt=https://cdn.stocksnap.io/img-thumbs/280h/workspace-office_CB4OANNVNO.jpg title=https://cdn.stocksnap.io/img-thumbs/280h/workspace-office_CB4OANNVNO.jpg></div><div class="details toc" id=toc-static kept=true><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fa-solid fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><ul><li><a href=#1-inputstream-抽象类>1. InputStream 抽象类</a></li><li><a href=#2-inputstream-实现类>2. Inputstream 实现类</a></li><li><a href=#3-filterinputstream>3. FilterInputStream</a></li><li><a href=#4-bytearrayinputstream>4. ByteArrayInputStream</a></li><li><a href=#5-bufferedinputstream>5. BufferedInputStream</a></li><li><a href=#6-pipeinputstream>6. PipeInputStream</a></li><li><a href=#7-fileinputstream>7. FileInputStream</a></li></ul></li></ul></nav></div></div><div class=content id=content><p><img class=lazyload src=/liudongdong1.github.io/svg/loading.min.svg data-src=https://gitee.com/github-25970295/blogpictureV2/raw/master/image-20210803121102170.png data-srcset="https://gitee.com/github-25970295/blogpictureV2/raw/master/image-20210803121102170.png, https://gitee.com/github-25970295/blogpictureV2/raw/master/image-20210803121102170.png 1.5x, https://gitee.com/github-25970295/blogpictureV2/raw/master/image-20210803121102170.png 2x" data-sizes=auto alt=https://gitee.com/github-25970295/blogpictureV2/raw/master/image-20210803121102170.png title=https://gitee.com/github-25970295/blogpictureV2/raw/master/image-20210803121102170.png></p><h3 id=1-inputstream-抽象类>1. InputStream 抽象类</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>abstract</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>read</span><span style=color:#f92672>()</span> 
</span></span><span style=display:flex><span><span style=color:#75715e>// 读取数据
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>read</span><span style=color:#f92672>(</span><span style=color:#66d9ef>byte</span> b<span style=color:#f92672>[])</span> 
</span></span><span style=display:flex><span><span style=color:#75715e>// 将读取到的数据放在 byte 数组中，该方法实际上是根据下面的方法实现的，off 为 0，len 为数组的长度
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>read</span><span style=color:#f92672>(</span><span style=color:#66d9ef>byte</span> b<span style=color:#f92672>[],</span> <span style=color:#66d9ef>int</span> off<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> len<span style=color:#f92672>)</span> 
</span></span><span style=display:flex><span><span style=color:#75715e>// 从第 off 位置读取 len 长度字节的数据放到 byte 数组中，流是以 -1 来判断是否读取结束的
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>long</span> <span style=color:#a6e22e>skip</span><span style=color:#f92672>(</span><span style=color:#66d9ef>long</span> n<span style=color:#f92672>)</span> 
</span></span><span style=display:flex><span><span style=color:#75715e>// 跳过指定个数的字节不读取，想想看电影跳过片头片尾
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>available</span><span style=color:#f92672>()</span> 
</span></span><span style=display:flex><span><span style=color:#75715e>// 返回可读的字节数量
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>close</span><span style=color:#f92672>()</span> 
</span></span><span style=display:flex><span><span style=color:#75715e>// 读取完，关闭流，释放资源
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>synchronized</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>mark</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> readlimit<span style=color:#f92672>)</span> 
</span></span><span style=display:flex><span><span style=color:#75715e>// 标记读取位置，下次还可以从这里开始读取，使用前要看当前流是否支持，可以使用 markSupport() 方法判断
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>synchronized</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>reset</span><span style=color:#f92672>()</span> 
</span></span><span style=display:flex><span><span style=color:#75715e>// 重置读取位置为上次 mark 标记的位置
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>markSupported</span><span style=color:#f92672>()</span> 
</span></span><span style=display:flex><span><span style=color:#75715e>// 判断当前流是否支持标记流，和上面两个方法配套使用
</span></span></span></code></pre></div><h3 id=2-inputstream-实现类>2. Inputstream 实现类</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>abstract</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>InputStream</span> <span style=color:#66d9ef>implements</span> Closeable <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> SKIP_BUFFER_SIZE <span style=color:#f92672>=</span> 2048<span style=color:#f92672>;</span>  <span style=color:#75715e>//用于skip方法，和skipBuffer相关
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>byte</span><span style=color:#f92672>[]</span> skipBuffer<span style=color:#f92672>;</span>    <span style=color:#75715e>// skipBuffer is initialized in skip(long), if needed.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>//从输入流中读取下一个字节，
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>//正常返回0-255，到达文件的末尾返回-1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>//在流中还有数据，但是没有读到时该方法会阻塞(block)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>//Java IO和New IO的区别就是阻塞流和非阻塞流
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>//抽象方法！不同的子类不同的实现！
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>abstract</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>read</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> IOException<span style=color:#f92672>;</span>  
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>//将流中的数据读入放在byte数组的第off个位置先后的len个位置中
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>//返回值为放入字节的个数。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>//这个方法在利用抽象方法read，某种意义上简单的Templete模式。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>read</span><span style=color:#f92672>(</span><span style=color:#66d9ef>byte</span> b<span style=color:#f92672>[],</span> <span style=color:#66d9ef>int</span> off<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> len<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//检查输入是否正常。一般情况下，检查输入是方法设计的第一步
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>b <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>    
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> NullPointerException<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>off <span style=color:#f92672>&lt;</span> 0 <span style=color:#f92672>||</span> len <span style=color:#f92672>&lt;</span> 0 <span style=color:#f92672>||</span> len <span style=color:#f92672>&gt;</span> b<span style=color:#f92672>.</span><span style=color:#a6e22e>length</span> <span style=color:#f92672>-</span> off<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>             <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> IndexOutOfBoundsException<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>len <span style=color:#f92672>==</span> 0<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>             <span style=color:#66d9ef>return</span> 0<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>//读取下一个字节
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>int</span> c <span style=color:#f92672>=</span> read<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//到达文件的末端返回-1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>c <span style=color:#f92672>==</span> <span style=color:#f92672>-</span>1<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>    <span style=color:#66d9ef>return</span> <span style=color:#f92672>-</span>1<span style=color:#f92672>;</span>   <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//返回的字节downcast                           
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        b<span style=color:#f92672>[</span>off<span style=color:#f92672>]</span> <span style=color:#f92672>=</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>byte</span><span style=color:#f92672>)</span>c<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//已经读取了一个字节                                                   
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 1<span style=color:#f92672>;</span>                                                                        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>//最多读取len个字节，所以要循环len次
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>for</span> <span style=color:#f92672>(;</span> i <span style=color:#f92672>&lt;</span> len <span style=color:#f92672>;</span> i<span style=color:#f92672>++)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>//每次循环从流中读取一个字节
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#75715e>//由于read方法阻塞，
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#75715e>//所以read(byte[],int,int)也会阻塞
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                c <span style=color:#f92672>=</span> read<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>//到达末尾，理所当然返回-1                                       
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>c <span style=color:#f92672>==</span> <span style=color:#f92672>-</span>1<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>            <span style=color:#66d9ef>break</span><span style=color:#f92672>;</span>           <span style=color:#f92672>}</span> 
</span></span><span style=display:flex><span>                <span style=color:#75715e>//读到就放入byte数组中
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                b<span style=color:#f92672>[</span>off <span style=color:#f92672>+</span> i<span style=color:#f92672>]</span> <span style=color:#f92672>=</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>byte</span><span style=color:#f92672>)</span>c<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>IOException ee<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>     <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> i<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     <span style=color:#75715e>//利用上面的方法read(byte[] b)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>read</span><span style=color:#f92672>(</span><span style=color:#66d9ef>byte</span> b<span style=color:#f92672>[])</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> read<span style=color:#f92672>(</span>b<span style=color:#f92672>,</span> 0<span style=color:#f92672>,</span> b<span style=color:#f92672>.</span><span style=color:#a6e22e>length</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>     <span style=color:#f92672>}</span>                          
</span></span><span style=display:flex><span>    <span style=color:#75715e>//方法内部使用的、表示要跳过的字节数目，
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>     <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>long</span> <span style=color:#a6e22e>skip</span><span style=color:#f92672>(</span><span style=color:#66d9ef>long</span> n<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>long</span> remaining <span style=color:#f92672>=</span> n<span style=color:#f92672>;</span>    
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> nr<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>skipBuffer <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//初始化一个跳转的缓存
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        skipBuffer <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>byte</span><span style=color:#f92672>[</span>SKIP_BUFFER_SIZE<span style=color:#f92672>];</span>                   
</span></span><span style=display:flex><span>        <span style=color:#75715e>//本地化的跳转缓存
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>byte</span><span style=color:#f92672>[]</span> localSkipBuffer <span style=color:#f92672>=</span> skipBuffer<span style=color:#f92672>;</span>          
</span></span><span style=display:flex><span>        <span style=color:#75715e>//检查输入参数，应该放在方法的开始                            
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>n <span style=color:#f92672>&lt;=</span> 0<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>    <span style=color:#66d9ef>return</span> 0<span style=color:#f92672>;</span>      <span style=color:#f92672>}</span>                             
</span></span><span style=display:flex><span>        <span style=color:#75715e>//一共要跳过n个，每次跳过部分，循环       
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>while</span> <span style=color:#f92672>(</span>remaining <span style=color:#f92672>&gt;</span> 0<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>                                      
</span></span><span style=display:flex><span>            nr <span style=color:#f92672>=</span> read<span style=color:#f92672>(</span>localSkipBuffer<span style=color:#f92672>,</span> 0<span style=color:#f92672>,</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span><span style=color:#f92672>)</span> Math<span style=color:#f92672>.</span><span style=color:#a6e22e>min</span><span style=color:#f92672>(</span>SKIP_BUFFER_SIZE<span style=color:#f92672>,</span> remaining<span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>//利用上面的read(byte[],int,int)方法尽量读取n个字节  
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#75715e>//读到流的末端，则返回
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>nr <span style=color:#f92672>&lt;</span> 0<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>  <span style=color:#66d9ef>break</span><span style=color:#f92672>;</span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>//没有完全读到需要的，则继续循环
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            remaining <span style=color:#f92672>-=</span> nr<span style=color:#f92672>;</span>                                       
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>       
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> n <span style=color:#f92672>-</span> remaining<span style=color:#f92672>;</span><span style=color:#75715e>//返回时要么全部读完，要么因为到达文件末端，读取了部分
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//查询流中还有多少可以读取的字节
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>//该方法不会block。在java中抽象类方法的实现一般有以下几种方式: 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>//1.抛出异常(java.util)；2.“弱”实现。像上面这种。子类在必要的时候覆盖它。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>//3.“空”实现。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>available</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>           
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> 0<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//关闭当前流、同时释放与此流相关的资源
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>//关闭当前流、同时释放与此流相关的资源
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>close</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//markSupport可以查询当前流是否支持mark
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>synchronized</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>mark</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> readlimit<span style=color:#f92672>)</span> <span style=color:#f92672>{}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//对mark过的流进行复位。只有当流支持mark时才可以使用此方法。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>synchronized</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>reset</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                   <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> IOException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;mark/reset not supported&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//查询是否支持mark
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>//绝大部分不支持，因此提供默认实现，返回false。子类有需要可以覆盖。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>markSupported</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>           
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=3-filterinputstream>3. FilterInputStream</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>FilterInputStream</span> <span style=color:#66d9ef>extends</span> InputStream <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//装饰器的代码特征: 被装饰的对象一般是装饰器的成员变量
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>volatile</span> InputStream in<span style=color:#f92672>;</span> <span style=color:#75715e>//将要被装饰的字节输入流
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>protected</span> <span style=color:#a6e22e>FilterInputStream</span><span style=color:#f92672>(</span>InputStream in<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>   <span style=color:#75715e>//通过构造方法传入此被装饰的流
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>in</span> <span style=color:#f92672>=</span> in<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>     <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//下面这些方法，完成最小的装饰――0装饰，只是调用被装饰流的方法而已
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>read</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> in<span style=color:#f92672>.</span><span style=color:#a6e22e>read</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>read</span><span style=color:#f92672>(</span><span style=color:#66d9ef>byte</span> b<span style=color:#f92672>[])</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> read<span style=color:#f92672>(</span>b<span style=color:#f92672>,</span> 0<span style=color:#f92672>,</span> b<span style=color:#f92672>.</span><span style=color:#a6e22e>length</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>     <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>read</span><span style=color:#f92672>(</span><span style=color:#66d9ef>byte</span> b<span style=color:#f92672>[],</span> <span style=color:#66d9ef>int</span> off<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> len<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> in<span style=color:#f92672>.</span><span style=color:#a6e22e>read</span><span style=color:#f92672>(</span>b<span style=color:#f92672>,</span> off<span style=color:#f92672>,</span> len<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>     <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>long</span> <span style=color:#a6e22e>skip</span><span style=color:#f92672>(</span><span style=color:#66d9ef>long</span> n<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> in<span style=color:#f92672>.</span><span style=color:#a6e22e>skip</span><span style=color:#f92672>(</span>n<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>available</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> in<span style=color:#f92672>.</span><span style=color:#a6e22e>available</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>close</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        in<span style=color:#f92672>.</span><span style=color:#a6e22e>close</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>synchronized</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>mark</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> readlimit<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        in<span style=color:#f92672>.</span><span style=color:#a6e22e>mark</span><span style=color:#f92672>(</span>readlimit<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>     <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>synchronized</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>reset</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        in<span style=color:#f92672>.</span><span style=color:#a6e22e>reset</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>markSupported</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> in<span style=color:#f92672>.</span><span style=color:#a6e22e>markSupported</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=4-bytearrayinputstream>4. ByteArrayInputStream</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ByteArrayInputStream</span> <span style=color:#66d9ef>extends</span> InputStream <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>byte</span> buf<span style=color:#f92672>[];</span>                <span style=color:#75715e>//内部的buffer，一般通过构造器输入
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>int</span> pos<span style=color:#f92672>;</span>                   <span style=color:#75715e>//当前位置的cursor。从0至byte数组的长度。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>//byte[pos]就是read方法读取的字节
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>int</span> mark <span style=color:#f92672>=</span> 0<span style=color:#f92672>;</span>           <span style=color:#75715e>//mark的位置。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>int</span> count<span style=color:#f92672>;</span>              <span style=color:#75715e>//流中字节的数目。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//构造器，从一个byte[]创建一个ByteArrayInputStream
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>     <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>ByteArrayInputStream</span><span style=color:#f92672>(</span><span style=color:#66d9ef>byte</span> buf<span style=color:#f92672>[])</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//初始化流中的各个成员变量
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>buf</span> <span style=color:#f92672>=</span> buf<span style=color:#f92672>;</span>              
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>pos</span> <span style=color:#f92672>=</span> 0<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>count</span> <span style=color:#f92672>=</span> buf<span style=color:#f92672>.</span><span style=color:#a6e22e>length</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>     <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//构造器
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>     <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>ByteArrayInputStream</span><span style=color:#f92672>(</span><span style=color:#66d9ef>byte</span> buf<span style=color:#f92672>[],</span> <span style=color:#66d9ef>int</span> offset<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> length<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>                
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>buf</span> <span style=color:#f92672>=</span> buf<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>pos</span> <span style=color:#f92672>=</span> offset<span style=color:#f92672>;</span> <span style=color:#75715e>//与上面不同
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>count</span> <span style=color:#f92672>=</span> Math<span style=color:#f92672>.</span><span style=color:#a6e22e>min</span><span style=color:#f92672>(</span>offset <span style=color:#f92672>+</span> length<span style=color:#f92672>,</span> buf<span style=color:#f92672>.</span><span style=color:#a6e22e>length</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>.</span><span style=color:#a6e22e>mark</span> <span style=color:#f92672>=</span> offset<span style=color:#f92672>;</span> <span style=color:#75715e>//与上面不同
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//从流中读取下一个字节
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>     <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>synchronized</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>read</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>           
</span></span><span style=display:flex><span>        <span style=color:#75715e>//返回下一个位置的字节//流中没有数据则返回-1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>return</span> <span style=color:#f92672>(</span>pos <span style=color:#f92672>&lt;</span> count<span style=color:#f92672>)</span> <span style=color:#f92672>?</span> <span style=color:#f92672>(</span>buf<span style=color:#f92672>[</span>pos<span style=color:#f92672>++]</span> <span style=color:#f92672>&amp;</span> 0xff<span style=color:#f92672>)</span> <span style=color:#f92672>:</span> <span style=color:#f92672>-</span>1<span style=color:#f92672>;</span> 
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ByteArrayInputStream要覆盖InputStream中可以看出其提供了该方法的实现
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>//某些时候，父类不能完全实现子类的功能，父类的实现一般比较通用。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>//当子类有更有效的方法时，我们会覆盖这些方法。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>synchronized</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>read</span><span style=color:#f92672>(</span><span style=color:#66d9ef>byte</span> b<span style=color:#f92672>[],</span> <span style=color:#66d9ef>int</span> off<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> len<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//首先检查输入参数的状态是否正确
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span>b<span style=color:#f92672>==</span><span style=color:#66d9ef>null</span><span style=color:#f92672>){</span> 
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> NullPointerException<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>off <span style=color:#f92672>&lt;</span> 0 <span style=color:#f92672>||</span> len <span style=color:#f92672>&lt;</span> 0 <span style=color:#f92672>||</span> len <span style=color:#f92672>&gt;</span> b<span style=color:#f92672>.</span><span style=color:#a6e22e>length</span> <span style=color:#f92672>-</span> off<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> IndexOutOfBoundsException<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>pos <span style=color:#f92672>&gt;=</span> count<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>             <span style=color:#66d9ef>return</span> <span style=color:#f92672>-</span>1<span style=color:#f92672>;</span>             <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>pos <span style=color:#f92672>+</span> len <span style=color:#f92672>&gt;</span> count<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>      len <span style=color:#f92672>=</span> count <span style=color:#f92672>-</span> pos<span style=color:#f92672>;</span>         <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>len <span style=color:#f92672>&lt;=</span> 0<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>           <span style=color:#66d9ef>return</span> 0<span style=color:#f92672>;</span>     <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//java中提供数据复制的方法
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>//出于速度的原因！他们都用到System.arraycopy方法
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        System<span style=color:#f92672>.</span><span style=color:#a6e22e>arraycopy</span><span style=color:#f92672>(</span>buf<span style=color:#f92672>,</span> pos<span style=color:#f92672>,</span> b<span style=color:#f92672>,</span> off<span style=color:#f92672>,</span> len<span style=color:#f92672>);</span> 
</span></span><span style=display:flex><span>        pos <span style=color:#f92672>+=</span> len<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> len<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//下面这个方法，在InputStream中也已经实现了。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>//但是当时是通过将字节读入一个buffer中实现的，好像效率低了一点。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>//比InputStream中的方法简单、高效
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>synchronized</span> <span style=color:#66d9ef>long</span> <span style=color:#a6e22e>skip</span><span style=color:#f92672>(</span><span style=color:#66d9ef>long</span> n<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//当前位置，可以跳跃的字节数目
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>pos <span style=color:#f92672>+</span> n <span style=color:#f92672>&gt;</span> count<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>    n <span style=color:#f92672>=</span> count <span style=color:#f92672>-</span> pos<span style=color:#f92672>;</span>       <span style=color:#f92672>}</span>       
</span></span><span style=display:flex><span>        <span style=color:#75715e>//小于0，则不可以跳跃
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>         <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>n <span style=color:#f92672>&lt;</span> 0<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>       <span style=color:#66d9ef>return</span> 0<span style=color:#f92672>;</span>     <span style=color:#f92672>}</span>   
</span></span><span style=display:flex><span>        <span style=color:#75715e>//跳跃后，当前位置变化                                 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        pos <span style=color:#f92672>+=</span> n<span style=color:#f92672>;</span>                                                                              
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> n<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>   
</span></span><span style=display:flex><span>    <span style=color:#75715e>//查询流中还有多少字节没有读取。                                 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>synchronized</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>available</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> count <span style=color:#f92672>-</span> pos<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//ByteArrayInputStream支持mark所以返回true
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>markSupported</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>                   
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                   <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>//在流中当前位置mark。      
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>mark</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> readAheadLimit<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>            
</span></span><span style=display:flex><span>        mark <span style=color:#f92672>=</span> pos<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>     <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//重置流。即回到mark的位置。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>synchronized</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>reset</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        pos <span style=color:#f92672>=</span> mark<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//关闭ByteArrayInputStream不会产生任何动作。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>close</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>   <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=5-bufferedinputstream>5. BufferedInputStream</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>BufferedInputStream</span> <span style=color:#66d9ef>extends</span> FilterInputStream <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>int</span> defaultBufferSize <span style=color:#f92672>=</span> 8192<span style=color:#f92672>;</span>    <span style=color:#75715e>//默认缓存的大小
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>volatile</span> <span style=color:#66d9ef>byte</span> buf<span style=color:#f92672>[];</span>  <span style=color:#75715e>//内部的缓存
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>int</span> count<span style=color:#f92672>;</span>     <span style=color:#75715e>//buffer的大小
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>int</span> pos<span style=color:#f92672>;</span>      <span style=color:#75715e>//buffer中cursor的位置
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>int</span> markpos <span style=color:#f92672>=</span> <span style=color:#f92672>-</span>1<span style=color:#f92672>;</span>    <span style=color:#75715e>//mark的位置
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>int</span> marklimit<span style=color:#f92672>;</span>     <span style=color:#75715e>//mark的范围
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>//原子性更新。和一致性编程相关
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span>    
</span></span><span style=display:flex><span>    AtomicReferenceFieldUpdater<span style=color:#f92672>&lt;</span>BufferedInputStream<span style=color:#f92672>,</span> <span style=color:#66d9ef>byte</span><span style=color:#f92672>[]&gt;</span> bufUpdater <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>    AtomicReferenceFieldUpdater<span style=color:#f92672>.</span><span style=color:#a6e22e>newUpdater</span> <span style=color:#f92672>(</span>BufferedInputStream<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>byte</span><span style=color:#f92672>[].</span><span style=color:#a6e22e>class</span><span style=color:#f92672>,</span><span style=color:#e6db74>&#34;buf&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//检查输入流是否关闭，同时返回被包装流
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>     <span style=color:#66d9ef>private</span> InputStream <span style=color:#a6e22e>getInIfOpen</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        InputStream input <span style=color:#f92672>=</span> in<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>input <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span>    <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> IOException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Stream closed&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> input<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//检查buffer的状态，同时返回缓存
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>byte</span><span style=color:#f92672>[]</span> <span style=color:#a6e22e>getBufIfOpen</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>                       
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>byte</span><span style=color:#f92672>[]</span> buffer <span style=color:#f92672>=</span> buf<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//不太可能发生的状态
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>buffer <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span>   <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> IOException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Stream closed&#34;</span><span style=color:#f92672>);</span>    
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> buffer<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//构造器
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#a6e22e>BufferedInputStream</span><span style=color:#f92672>(</span>InputStream in<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//指定默认长度的buffer
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>(</span>in<span style=color:#f92672>,</span> defaultBufferSize<span style=color:#f92672>);</span>                                                              
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//构造器
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>BufferedInputStream</span><span style=color:#f92672>(</span>InputStream in<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> size<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>                           
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span><span style=color:#f92672>(</span>in<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//检查输入参数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span>size<span style=color:#f92672>&lt;=</span>0<span style=color:#f92672>){</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> IllegalArgumentException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Buffer size &lt;= 0&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//创建指定长度的buffer
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        buf <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>byte</span><span style=color:#f92672>[</span>size<span style=color:#f92672>];</span> 
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//从流中读取数据，填充如缓存中。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>fill</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//得到buffer
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>byte</span><span style=color:#f92672>[]</span> buffer <span style=color:#f92672>=</span> getBufIfOpen<span style=color:#f92672>();</span>                            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>markpos <span style=color:#f92672>&lt;</span> 0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>//mark位置小于0，此时pos为0
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            pos <span style=color:#f92672>=</span> 0<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>//pos大于buffer的长度            
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>pos <span style=color:#f92672>&gt;=</span> buffer<span style=color:#f92672>.</span><span style=color:#a6e22e>length</span><span style=color:#f92672>)</span> 
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>markpos <span style=color:#f92672>&gt;</span> 0<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>        
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>int</span> sz <span style=color:#f92672>=</span> pos <span style=color:#f92672>-</span> markpos<span style=color:#f92672>;</span>                                                           
</span></span><span style=display:flex><span>　　　　　　　　　 System<span style=color:#f92672>.</span><span style=color:#a6e22e>arraycopy</span><span style=color:#f92672>(</span>buffer<span style=color:#f92672>,</span> markpos<span style=color:#f92672>,</span> buffer<span style=color:#f92672>,</span> 0<span style=color:#f92672>,</span> sz<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                pos <span style=color:#f92672>=</span> sz<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>                markpos <span style=color:#f92672>=</span> 0<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>buffer<span style=color:#f92672>.</span><span style=color:#a6e22e>length</span> <span style=color:#f92672>&gt;=</span> marklimit<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>                 
</span></span><span style=display:flex><span>                <span style=color:#75715e>//buffer的长度大于marklimit时，mark失效
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                markpos <span style=color:#f92672>=</span> <span style=color:#f92672>-</span>1<span style=color:#f92672>;</span> 
</span></span><span style=display:flex><span>                <span style=color:#75715e>//丢弃buffer中的内容                                                                  
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>　　　　　　　　　 pos <span style=color:#f92672>=</span> 0<span style=color:#f92672>;</span>                                    
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span><span style=color:#66d9ef>else</span><span style=color:#f92672>{</span>                                                                         
</span></span><span style=display:flex><span>                <span style=color:#75715e>//buffer的长度小于marklimit时对buffer扩容
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#66d9ef>int</span> nsz <span style=color:#f92672>=</span> pos <span style=color:#f92672>*</span> 2<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>nsz <span style=color:#f92672>&gt;</span> marklimit<span style=color:#f92672>)</span> 
</span></span><span style=display:flex><span>                    nsz <span style=color:#f92672>=</span> marklimit<span style=color:#f92672>;</span><span style=color:#75715e>//扩容为原来的2倍，太大则为marklimit大小
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    <span style=color:#66d9ef>byte</span> nbuf<span style=color:#f92672>[]</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>byte</span><span style=color:#f92672>[</span>nsz<span style=color:#f92672>];</span>                   
</span></span><span style=display:flex><span>                    <span style=color:#75715e>//将buffer中的字节拷贝如扩容后的buf中    
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    System<span style=color:#f92672>.</span><span style=color:#a6e22e>arraycopy</span><span style=color:#f92672>(</span>buffer<span style=color:#f92672>,</span> 0<span style=color:#f92672>,</span> nbuf<span style=color:#f92672>,</span> 0<span style=color:#f92672>,</span> pos<span style=color:#f92672>);</span>        
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(!</span>bufUpdater<span style=color:#f92672>.</span><span style=color:#a6e22e>compareAndSet</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>,</span> buffer<span style=color:#f92672>,</span> nbuf<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>    
</span></span><span style=display:flex><span>                    <span style=color:#75715e>//在buffer在被操作时，不能取代此buffer
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> IOException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Stream closed&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>//将新buf赋值给buffer
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                buffer <span style=color:#f92672>=</span> nbuf<span style=color:#f92672>;</span>                                                               
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            count <span style=color:#f92672>=</span> pos<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>int</span> n <span style=color:#f92672>=</span> getInIfOpen<span style=color:#f92672>().</span><span style=color:#a6e22e>read</span><span style=color:#f92672>(</span>buffer<span style=color:#f92672>,</span> pos<span style=color:#f92672>,</span> buffer<span style=color:#f92672>.</span><span style=color:#a6e22e>length</span> <span style=color:#f92672>-</span> pos<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>n <span style=color:#f92672>&gt;</span> 0<span style=color:#f92672>)</span>     count <span style=color:#f92672>=</span> n <span style=color:#f92672>+</span> pos<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//读取下一个字节
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>synchronized</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>read</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span> 
</span></span><span style=display:flex><span>        <span style=color:#75715e>//到达buffer的末端    
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>pos <span style=color:#f92672>&gt;=</span> count<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>                                                                 
</span></span><span style=display:flex><span>            <span style=color:#75715e>//就从流中读取数据，填充buffer 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            fill<span style=color:#f92672>();</span>                                                                                
</span></span><span style=display:flex><span>　　　　　　　<span style=color:#75715e>//读过一次，没有数据则返回-1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>pos <span style=color:#f92672>&gt;=</span> count<span style=color:#f92672>)</span>  <span style=color:#66d9ef>return</span> <span style=color:#f92672>-</span>1<span style=color:#f92672>;</span>                                
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//返回buffer中下一个位置的字节
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>return</span> getBufIfOpen<span style=color:#f92672>()[</span>pos<span style=color:#f92672>++]</span> <span style=color:#f92672>&amp;</span> 0xff<span style=color:#f92672>;</span>                           
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//将数据从流中读入buffer中
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>     <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>read1</span><span style=color:#f92672>(</span><span style=color:#66d9ef>byte</span><span style=color:#f92672>[]</span> b<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> off<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> len<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>                 
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> avail <span style=color:#f92672>=</span> count <span style=color:#f92672>-</span> pos<span style=color:#f92672>;</span> <span style=color:#75715e>//buffer中还剩的可读字符                                                                            
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>//buffer中没有可以读取的数据时
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span>avail<span style=color:#f92672>&lt;=</span>0<span style=color:#f92672>){</span>                                                                                        
</span></span><span style=display:flex><span>            <span style=color:#75715e>//将输入流中的字节读入b中
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>len <span style=color:#f92672>&gt;=</span> getBufIfOpen<span style=color:#f92672>().</span><span style=color:#a6e22e>length</span> <span style=color:#f92672>&amp;&amp;</span> markpos <span style=color:#f92672>&lt;</span> 0<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>             
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> getInIfOpen<span style=color:#f92672>().</span><span style=color:#a6e22e>read</span><span style=color:#f92672>(</span>b<span style=color:#f92672>,</span> off<span style=color:#f92672>,</span> len<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            fill<span style=color:#f92672>();</span><span style=color:#75715e>//填充                                                                                               
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            avail <span style=color:#f92672>=</span> count <span style=color:#f92672>-</span> pos<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>avail <span style=color:#f92672>&lt;=</span> 0<span style=color:#f92672>)</span> <span style=color:#66d9ef>return</span> <span style=color:#f92672>-</span>1<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//从流中读取后，检查可以读取的数目
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>int</span> cnt <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>avail <span style=color:#f92672>&lt;</span> len<span style=color:#f92672>)</span> <span style=color:#f92672>?</span> avail <span style=color:#f92672>:</span> len<span style=color:#f92672>;</span>                                                  
</span></span><span style=display:flex><span>        <span style=color:#75715e>//将当前buffer中的字节放入b的末端
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        System<span style=color:#f92672>.</span><span style=color:#a6e22e>arraycopy</span><span style=color:#f92672>(</span>getBufIfOpen<span style=color:#f92672>(),</span> pos<span style=color:#f92672>,</span> b<span style=color:#f92672>,</span> off<span style=color:#f92672>,</span> cnt<span style=color:#f92672>);</span>            
</span></span><span style=display:flex><span>        pos <span style=color:#f92672>+=</span> cnt<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> cnt<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>synchronized</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>read</span><span style=color:#f92672>(</span><span style=color:#66d9ef>byte</span> b<span style=color:#f92672>[],</span> <span style=color:#66d9ef>int</span> off<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> len<span style=color:#f92672>)</span><span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        getBufIfOpen<span style=color:#f92672>();</span>                                                                                     
</span></span><span style=display:flex><span>　　　　　<span style=color:#75715e>// 检查buffer是否open
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>//检查输入参数是否正确
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>((</span>off <span style=color:#f92672>|</span> len <span style=color:#f92672>|</span> <span style=color:#f92672>(</span>off <span style=color:#f92672>+</span> len<span style=color:#f92672>)</span> <span style=color:#f92672>|</span> <span style=color:#f92672>(</span>b<span style=color:#f92672>.</span><span style=color:#a6e22e>length</span> <span style=color:#f92672>-</span> <span style=color:#f92672>(</span>off <span style=color:#f92672>+</span> len<span style=color:#f92672>)))</span> <span style=color:#f92672>&lt;</span> 0<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>           
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> IndexOutOfBoundsException<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>len <span style=color:#f92672>==</span> 0<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> 0<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> n <span style=color:#f92672>=</span> 0<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> <span style=color:#f92672>(;;)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>int</span> nread <span style=color:#f92672>=</span> read1<span style=color:#f92672>(</span>b<span style=color:#f92672>,</span> off <span style=color:#f92672>+</span> n<span style=color:#f92672>,</span> len <span style=color:#f92672>-</span> n<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>nread <span style=color:#f92672>&lt;=</span> 0<span style=color:#f92672>)</span>     <span style=color:#66d9ef>return</span> <span style=color:#f92672>(</span>n <span style=color:#f92672>==</span> 0<span style=color:#f92672>)</span> <span style=color:#f92672>?</span> nread <span style=color:#f92672>:</span> n<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            n <span style=color:#f92672>+=</span> nread<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>n <span style=color:#f92672>&gt;=</span> len<span style=color:#f92672>)</span>     <span style=color:#66d9ef>return</span> n<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            InputStream input <span style=color:#f92672>=</span> in<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>input <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>&amp;&amp;</span> input<span style=color:#f92672>.</span><span style=color:#a6e22e>available</span><span style=color:#f92672>()</span> <span style=color:#f92672>&lt;=</span> 0<span style=color:#f92672>)</span>     <span style=color:#66d9ef>return</span> n<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>synchronized</span> <span style=color:#66d9ef>long</span> <span style=color:#a6e22e>skip</span><span style=color:#f92672>(</span><span style=color:#66d9ef>long</span> n<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 检查buffer是否关闭
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        getBufIfOpen<span style=color:#f92672>();</span>                                        
</span></span><span style=display:flex><span>        <span style=color:#75715e>//检查输入参数是否正确
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>n <span style=color:#f92672>&lt;=</span> 0<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>    <span style=color:#66d9ef>return</span> 0<span style=color:#f92672>;</span>      <span style=color:#f92672>}</span>                 
</span></span><span style=display:flex><span>        <span style=color:#75715e>//buffered中可以读取字节的数目
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>long</span> avail <span style=color:#f92672>=</span> count <span style=color:#f92672>-</span> pos<span style=color:#f92672>;</span>                    
</span></span><span style=display:flex><span>        <span style=color:#75715e>//可以读取的小于0，则从流中读取
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>avail <span style=color:#f92672>&lt;=</span> 0<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>                                          
</span></span><span style=display:flex><span>            <span style=color:#75715e>//mark小于0，则mark在流中 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>markpos <span style=color:#f92672>&lt;</span>0<span style=color:#f92672>)</span>  <span style=color:#66d9ef>return</span> getInIfOpen<span style=color:#f92672>().</span><span style=color:#a6e22e>skip</span><span style=color:#f92672>(</span>n<span style=color:#f92672>);</span>     
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 从流中读取数据，填充缓冲区。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            fill<span style=color:#f92672>();</span>                                  
</span></span><span style=display:flex><span>            <span style=color:#75715e>//可以读的取字节为buffer的容量减当前位置
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            avail <span style=color:#f92672>=</span> count <span style=color:#f92672>-</span> pos<span style=color:#f92672>;</span>                                   
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>avail <span style=color:#f92672>&lt;=</span> 0<span style=color:#f92672>)</span>     <span style=color:#66d9ef>return</span> 0<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>       
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>long</span> skipped <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>avail <span style=color:#f92672>&lt;</span> n<span style=color:#f92672>)</span> <span style=color:#f92672>?</span> avail <span style=color:#f92672>:</span> n<span style=color:#f92672>;</span>      
</span></span><span style=display:flex><span>        pos <span style=color:#f92672>+=</span> skipped<span style=color:#f92672>;</span>                                       
</span></span><span style=display:flex><span>　　　　　<span style=color:#75715e>//当前位置改变
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>return</span> skipped<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//该方法不会block！返回流中可以读取的字节的数目。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>//该方法的返回值为缓存中的可读字节数目加流中可读字节数目的和
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>synchronized</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>available</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> getInIfOpen<span style=color:#f92672>().</span><span style=color:#a6e22e>available</span><span style=color:#f92672>()</span> <span style=color:#f92672>+</span> <span style=color:#f92672>(</span>count <span style=color:#f92672>-</span> pos<span style=color:#f92672>);</span>                 
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//当前位置处为mark位置
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>synchronized</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>mark</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> readlimit<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>  
</span></span><span style=display:flex><span>        marklimit <span style=color:#f92672>=</span> readlimit<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        markpos <span style=color:#f92672>=</span> pos<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>synchronized</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>reset</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 缓冲去关闭了，肯定就抛出异常！程序设计中经常的手段
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        getBufIfOpen<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>markpos <span style=color:#f92672>&lt;</span> 0<span style=color:#f92672>)</span>     <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> IOException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Resetting to invalid mark&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        pos <span style=color:#f92672>=</span> markpos<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//该流和ByteArrayInputStream一样都支持mark
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>markSupported</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>           
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//关闭当前流同时释放相应的系统资源。
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>close</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>byte</span><span style=color:#f92672>[]</span> buffer<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>while</span> <span style=color:#f92672>(</span> <span style=color:#f92672>(</span>buffer <span style=color:#f92672>=</span> buf<span style=color:#f92672>)</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>bufUpdater<span style=color:#f92672>.</span><span style=color:#a6e22e>compareAndSet</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>,</span> buffer<span style=color:#f92672>,</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            InputStream input <span style=color:#f92672>=</span> in<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            in <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>input <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span>    input<span style=color:#f92672>.</span><span style=color:#a6e22e>close</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Else retry in case a new buf was CASed in fill()
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=6-pipeinputstream>6. PipeInputStream</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PipedInputStream</span> <span style=color:#66d9ef>extends</span> InputStream <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//标识有读取方或写入方关闭
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>boolean</span> closedByWriter <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>                                                             
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>volatile</span> <span style=color:#66d9ef>boolean</span> closedByReader <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>//是否建立连接
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>boolean</span> connected <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>                                                                     
</span></span><span style=display:flex><span>    <span style=color:#75715e>//标识哪个线程
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    Thread readSide<span style=color:#f92672>;</span>                                                                                             
</span></span><span style=display:flex><span>    Thread writeSide<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//缓冲区的默认大小
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> PIPE_SIZE <span style=color:#f92672>=</span> 1024<span style=color:#f92672>;</span>                         
</span></span><span style=display:flex><span>    <span style=color:#75715e>//缓冲区
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>byte</span> buffer<span style=color:#f92672>[]</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#66d9ef>byte</span><span style=color:#f92672>[</span>PIPE_SIZE<span style=color:#f92672>];</span>                 
</span></span><span style=display:flex><span>    <span style=color:#75715e>//下一个写入字节的位置。0代表空，in==out代表满
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>int</span> in <span style=color:#f92672>=</span> <span style=color:#f92672>-</span>1<span style=color:#f92672>;</span>               
</span></span><span style=display:flex><span>    <span style=color:#75715e>//下一个读取字节的位置
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>int</span> out <span style=color:#f92672>=</span> 0<span style=color:#f92672>;</span>    
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//给定源的输入流
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>PipedInputStream</span><span style=color:#f92672>(</span>PipedOutputStream src<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>                
</span></span><span style=display:flex><span>        connect<span style=color:#f92672>(</span>src<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//默认构造器，下部一定要connect源
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>PipedInputStream</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>    <span style=color:#f92672>}</span>                                                
</span></span><span style=display:flex><span>    <span style=color:#75715e>//连接输入源
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>connect</span><span style=color:#f92672>(</span>PipedOutputStream src<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>               
</span></span><span style=display:flex><span>        <span style=color:#75715e>//调用源的connect方法连接当前对象
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        src<span style=color:#f92672>.</span><span style=color:#a6e22e>connect</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>);</span>                                                                           
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//只被PipedOuputStream调用
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>synchronized</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>receive</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> b<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>                  
</span></span><span style=display:flex><span>        <span style=color:#75715e>//检查状态，写入
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        checkStateForReceive<span style=color:#f92672>();</span>                                                                                 
</span></span><span style=display:flex><span>        <span style=color:#75715e>//永远是PipedOuputStream
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        writeSide <span style=color:#f92672>=</span> Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>currentThread</span><span style=color:#f92672>();</span>                                                      
</span></span><span style=display:flex><span>        <span style=color:#75715e>//输入和输出相等，等待空间
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>in <span style=color:#f92672>==</span> out<span style=color:#f92672>)</span>     awaitSpace<span style=color:#f92672>();</span>                                                           
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>in <span style=color:#f92672>&lt;</span> 0<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            in <span style=color:#f92672>=</span> 0<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            out <span style=color:#f92672>=</span> 0<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//放入buffer相应的位置
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        buffer<span style=color:#f92672>[</span>in<span style=color:#f92672>++]</span> <span style=color:#f92672>=</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>byte</span><span style=color:#f92672>)(</span>b <span style=color:#f92672>&amp;</span> 0xFF<span style=color:#f92672>);</span>                                                             
</span></span><span style=display:flex><span>        <span style=color:#75715e>//in为0表示buffer已空
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>in <span style=color:#f92672>&gt;=</span> buffer<span style=color:#f92672>.</span><span style=color:#a6e22e>length</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>      in <span style=color:#f92672>=</span> 0<span style=color:#f92672>;</span>         <span style=color:#f92672>}</span>                                             
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>synchronized</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>receive</span><span style=color:#f92672>(</span><span style=color:#66d9ef>byte</span> b<span style=color:#f92672>[],</span> <span style=color:#66d9ef>int</span> off<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> len<span style=color:#f92672>)</span>  <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        checkStateForReceive<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//从PipedOutputStream可以看出
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        writeSide <span style=color:#f92672>=</span> Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>currentThread</span><span style=color:#f92672>();</span>                                   
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> bytesToTransfer <span style=color:#f92672>=</span> len<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>while</span> <span style=color:#f92672>(</span>bytesToTransfer <span style=color:#f92672>&gt;</span> 0<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>//满了，会通知读取的；空会通知写入
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>in <span style=color:#f92672>==</span> out<span style=color:#f92672>)</span>    awaitSpace<span style=color:#f92672>();</span>                                
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>int</span> nextTransferAmount <span style=color:#f92672>=</span> 0<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>out <span style=color:#f92672>&lt;</span> in<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                nextTransferAmount <span style=color:#f92672>=</span> buffer<span style=color:#f92672>.</span><span style=color:#a6e22e>length</span> <span style=color:#f92672>-</span> in<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>in <span style=color:#f92672>&lt;</span> out<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>in <span style=color:#f92672>==</span> <span style=color:#f92672>-</span>1<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    in <span style=color:#f92672>=</span> out <span style=color:#f92672>=</span> 0<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>                    nextTransferAmount <span style=color:#f92672>=</span> buffer<span style=color:#f92672>.</span><span style=color:#a6e22e>length</span> <span style=color:#f92672>-</span> in<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                    nextTransferAmount <span style=color:#f92672>=</span> out <span style=color:#f92672>-</span> in<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>nextTransferAmount <span style=color:#f92672>&gt;</span> bytesToTransfer<span style=color:#f92672>)</span>  nextTransferAmount <span style=color:#f92672>=</span> bytesToTransfer<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>assert</span><span style=color:#f92672>(</span>nextTransferAmount <span style=color:#f92672>&gt;</span> 0<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            System<span style=color:#f92672>.</span><span style=color:#a6e22e>arraycopy</span><span style=color:#f92672>(</span>b<span style=color:#f92672>,</span> off<span style=color:#f92672>,</span> buffer<span style=color:#f92672>,</span> in<span style=color:#f92672>,</span> nextTransferAmount<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            bytesToTransfer <span style=color:#f92672>-=</span> nextTransferAmount<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            off <span style=color:#f92672>+=</span> nextTransferAmount<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            in <span style=color:#f92672>+=</span> nextTransferAmount<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>in <span style=color:#f92672>&gt;=</span> buffer<span style=color:#f92672>.</span><span style=color:#a6e22e>length</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>     in <span style=color:#f92672>=</span> 0<span style=color:#f92672>;</span>      <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//检查当前状态，等待输入
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>checkStateForReceive</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>                           
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(!</span>connected<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> IOException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Pipe not connected&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>closedByWriter <span style=color:#f92672>||</span> closedByReader<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> IOException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Pipe closed&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>readSide <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span>readSide<span style=color:#f92672>.</span><span style=color:#a6e22e>isAlive</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> IOException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Read end dead&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//Buffer已满，等待一段时间
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>awaitSpace</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>                                              
</span></span><span style=display:flex><span>        <span style=color:#75715e>//in==out表示满了，没有空间
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>while</span> <span style=color:#f92672>(</span>in <span style=color:#f92672>==</span> out<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>                                                                                             
</span></span><span style=display:flex><span>            <span style=color:#75715e>//检查接受端的状态
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            checkStateForReceive<span style=color:#f92672>();</span>                                                                       
</span></span><span style=display:flex><span>            <span style=color:#75715e>//通知读取端
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            notifyAll<span style=color:#f92672>();</span>                                                                                  
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                wait<span style=color:#f92672>(</span>1000<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>InterruptedException ex<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> java<span style=color:#f92672>.</span><span style=color:#a6e22e>io</span><span style=color:#f92672>.</span><span style=color:#a6e22e>InterruptedIOException</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//通知所有等待的线程()已经接受到最后的字节
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>synchronized</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>receivedLast</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>                  
</span></span><span style=display:flex><span>        closedByWriter <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>                             <span style=color:#75715e>//
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        notifyAll<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>synchronized</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>read</span><span style=color:#f92672>()</span>  <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//检查一些内部状态
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(!</span>connected<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>                                                                              
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> IOException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Pipe not connected&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>closedByReader<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> IOException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Pipe closed&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>writeSide <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span>writeSide<span style=color:#f92672>.</span><span style=color:#a6e22e>isAlive</span><span style=color:#f92672>()&amp;&amp;</span> <span style=color:#f92672>!</span>closedByWriter <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>(</span>in <span style=color:#f92672>&lt;</span> 0<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> IOException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Write end dead&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//当前线程读取
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        readSide <span style=color:#f92672>=</span> Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>currentThread</span><span style=color:#f92672>();</span>                                            
</span></span><span style=display:flex><span>        <span style=color:#75715e>//重复两次? ? ? 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>int</span> trials <span style=color:#f92672>=</span> 2<span style=color:#f92672>;</span>                                                                               
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>while</span> <span style=color:#f92672>(</span>in <span style=color:#f92672>&lt;</span> 0<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>//输入断关闭返回-1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>closedByWriter<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>              <span style=color:#66d9ef>return</span> <span style=color:#f92672>-</span>1<span style=color:#f92672>;</span>        <span style=color:#f92672>}</span>                 
</span></span><span style=display:flex><span>            <span style=color:#75715e>//状态错误
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>((</span>writeSide <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>(!</span>writeSide<span style=color:#f92672>.</span><span style=color:#a6e22e>isAlive</span><span style=color:#f92672>())</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>(--</span>trials <span style=color:#f92672>&lt;</span> 0<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>         
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> IOException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Pipe broken&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            notifyAll<span style=color:#f92672>();</span>        <span style=color:#75715e>// 空了，通知写入端可以写入                                                                         try {
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            wait<span style=color:#f92672>(</span>1000<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>InterruptedException ex<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> java<span style=color:#f92672>.</span><span style=color:#a6e22e>io</span><span style=color:#f92672>.</span><span style=color:#a6e22e>InterruptedIOException</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> ret <span style=color:#f92672>=</span> buffer<span style=color:#f92672>[</span>out<span style=color:#f92672>++]</span> <span style=color:#f92672>&amp;</span> 0xFF<span style=color:#f92672>;</span>                                                                         <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>out <span style=color:#f92672>&gt;=</span> buffer<span style=color:#f92672>.</span><span style=color:#a6e22e>length</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>             out <span style=color:#f92672>=</span> 0<span style=color:#f92672>;</span>                <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//没有任何字节
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>in <span style=color:#f92672>==</span> out<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>           in <span style=color:#f92672>=</span> <span style=color:#f92672>-</span>1<span style=color:#f92672>;</span>                 <span style=color:#f92672>}</span>                             
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> ret<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>synchronized</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>read</span><span style=color:#f92672>(</span><span style=color:#66d9ef>byte</span> b<span style=color:#f92672>[],</span> <span style=color:#66d9ef>int</span> off<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> len<span style=color:#f92672>)</span>  <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//检查输入参数的正确性
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>b <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>                                                                                 
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> NullPointerException<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>off <span style=color:#f92672>&lt;</span> 0 <span style=color:#f92672>||</span> len <span style=color:#f92672>&lt;</span> 0 <span style=color:#f92672>||</span> len <span style=color:#f92672>&gt;</span> b<span style=color:#f92672>.</span><span style=color:#a6e22e>length</span> <span style=color:#f92672>-</span> off<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> IndexOutOfBoundsException<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>len <span style=color:#f92672>==</span> 0<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> 0<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//读取下一个
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>int</span> c <span style=color:#f92672>=</span> read<span style=color:#f92672>();</span>                                                                                 
</span></span><span style=display:flex><span>    <span style=color:#75715e>//已经到达末尾了，返回-1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>c <span style=color:#f92672>&lt;</span> 0<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>    <span style=color:#66d9ef>return</span> <span style=color:#f92672>-</span>1<span style=color:#f92672>;</span>       <span style=color:#f92672>}</span>                                            
</span></span><span style=display:flex><span>    <span style=color:#75715e>//放入外部buffer中
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    b<span style=color:#f92672>[</span>off<span style=color:#f92672>]</span> <span style=color:#f92672>=</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>byte</span><span style=color:#f92672>)</span> c<span style=color:#f92672>;</span>                                                                    
</span></span><span style=display:flex><span>    <span style=color:#75715e>//return-len
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>int</span> rlen <span style=color:#f92672>=</span> 1<span style=color:#f92672>;</span>                                                                            
</span></span><span style=display:flex><span>    <span style=color:#75715e>//下一个in存在，且没有到达len
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>while</span> <span style=color:#f92672>((</span>in <span style=color:#f92672>&gt;=</span> 0<span style=color:#f92672>)</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>(--</span>len <span style=color:#f92672>&gt;</span> 0<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>                                          
</span></span><span style=display:flex><span>        <span style=color:#75715e>//依次放入外部buffer
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        b<span style=color:#f92672>[</span>off <span style=color:#f92672>+</span> rlen<span style=color:#f92672>]</span> <span style=color:#f92672>=</span> buffer<span style=color:#f92672>[</span>out<span style=color:#f92672>++];</span>                                         
</span></span><span style=display:flex><span>        rlen<span style=color:#f92672>++;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//读到buffer的末尾，返回头部
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>out <span style=color:#f92672>&gt;=</span> buffer<span style=color:#f92672>.</span><span style=color:#a6e22e>length</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>         out <span style=color:#f92672>=</span> 0<span style=color:#f92672>;</span>           <span style=color:#f92672>}</span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>//读、写位置一致时，表示没有数据
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>in <span style=color:#f92672>==</span> out<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>     in <span style=color:#f92672>=</span> <span style=color:#f92672>-</span>1<span style=color:#f92672>;</span>      <span style=color:#f92672>}</span>               
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//返回填充的长度
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> rlen<span style=color:#f92672>;</span>                                                                            
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//返回还有多少字节可以读取
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>synchronized</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>available</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>             
</span></span><span style=display:flex><span>    <span style=color:#75715e>//到达末端，没有字节
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span>in <span style=color:#f92672>&lt;</span> 0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> 0<span style=color:#f92672>;</span>                                                                                         
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span><span style=color:#f92672>(</span>in <span style=color:#f92672>==</span> out<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//写入的和读出的一致，表示满
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>return</span> buffer<span style=color:#f92672>.</span><span style=color:#a6e22e>length</span><span style=color:#f92672>;</span>                                                               
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>in <span style=color:#f92672>&gt;</span> out<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//写入的大于读出
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>return</span> in <span style=color:#f92672>-</span> out<span style=color:#f92672>;</span>                                                                                 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>//写入的小于读出的
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>return</span> in <span style=color:#f92672>+</span> buffer<span style=color:#f92672>.</span><span style=color:#a6e22e>length</span> <span style=color:#f92672>-</span> out<span style=color:#f92672>;</span>                                                
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//关闭当前流，同时释放与其相关的资源
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>close</span><span style=color:#f92672>()</span>  <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>                
</span></span><span style=display:flex><span>    <span style=color:#75715e>//表示由输入流关闭
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    closedByReader <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>                                             
</span></span><span style=display:flex><span>    <span style=color:#75715e>//同步化当前对象，in为-1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>synchronized</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>     in <span style=color:#f92672>=</span> <span style=color:#f92672>-</span>1<span style=color:#f92672>;</span>    <span style=color:#f92672>}</span>        
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=7-fileinputstream>7. FileInputStream</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>FileInputStream</span> <span style=color:#66d9ef>extends</span> InputStream
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/* File Descriptor - handle to the open file */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> FileDescriptor fd<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * The path of the referenced file
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * (null if the stream is created with a file descriptor)
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> String path<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> FileChannel channel <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> Object closeLock <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Object<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>volatile</span> <span style=color:#66d9ef>boolean</span> closed <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * Creates a &lt;code&gt;FileInputStream&lt;/code&gt; by
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * opening a connection to an actual file,
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * the file named by the path name &lt;code&gt;name&lt;/code&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * in the file system.  A new &lt;code&gt;FileDescriptor&lt;/code&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * object is created to represent this file
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * connection.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * &lt;p&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * First, if there is a security
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * manager, its &lt;code&gt;checkRead&lt;/code&gt; method
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * is called with the &lt;code&gt;name&lt;/code&gt; argument
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * as its argument.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * &lt;p&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * If the named file does not exist, is a directory rather than a regular
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * file, or for some other reason cannot be opened for reading then a
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * &lt;code&gt;FileNotFoundException&lt;/code&gt; is thrown.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param      name   the system-dependent file name.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @exception  FileNotFoundException  if the file does not exist,
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *                   is a directory rather than a regular file,
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *                   or for some other reason cannot be opened for
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *                   reading.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @exception  SecurityException      if a security manager exists and its
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *               &lt;code&gt;checkRead&lt;/code&gt; method denies read access
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *               to the file.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @see        java.lang.SecurityManager#checkRead(java.lang.String)
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>FileInputStream</span><span style=color:#f92672>(</span>String name<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> FileNotFoundException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span><span style=color:#f92672>(</span>name <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>?</span> <span style=color:#66d9ef>new</span> File<span style=color:#f92672>(</span>name<span style=color:#f92672>)</span> <span style=color:#f92672>:</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * Creates a &lt;code&gt;FileInputStream&lt;/code&gt; by
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * opening a connection to an actual file,
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * the file named by the &lt;code&gt;File&lt;/code&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * object &lt;code&gt;file&lt;/code&gt; in the file system.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * A new &lt;code&gt;FileDescriptor&lt;/code&gt; object
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * is created to represent this file connection.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * &lt;p&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * First, if there is a security manager,
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * its &lt;code&gt;checkRead&lt;/code&gt; method  is called
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * with the path represented by the &lt;code&gt;file&lt;/code&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * argument as its argument.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * &lt;p&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * If the named file does not exist, is a directory rather than a regular
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * file, or for some other reason cannot be opened for reading then a
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * &lt;code&gt;FileNotFoundException&lt;/code&gt; is thrown.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param      file   the file to be opened for reading.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @exception  FileNotFoundException  if the file does not exist,
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *                   is a directory rather than a regular file,
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *                   or for some other reason cannot be opened for
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *                   reading.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @exception  SecurityException      if a security manager exists and its
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *               &lt;code&gt;checkRead&lt;/code&gt; method denies read access to the file.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @see        java.io.File#getPath()
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @see        java.lang.SecurityManager#checkRead(java.lang.String)
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>FileInputStream</span><span style=color:#f92672>(</span>File file<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> FileNotFoundException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        String name <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>file <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>?</span> file<span style=color:#f92672>.</span><span style=color:#a6e22e>getPath</span><span style=color:#f92672>()</span> <span style=color:#f92672>:</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        SecurityManager security <span style=color:#f92672>=</span> System<span style=color:#f92672>.</span><span style=color:#a6e22e>getSecurityManager</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>security <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            security<span style=color:#f92672>.</span><span style=color:#a6e22e>checkRead</span><span style=color:#f92672>(</span>name<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>name <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> NullPointerException<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>file<span style=color:#f92672>.</span><span style=color:#a6e22e>isInvalid</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> FileNotFoundException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Invalid file path&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        fd <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> FileDescriptor<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        fd<span style=color:#f92672>.</span><span style=color:#a6e22e>attach</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        path <span style=color:#f92672>=</span> name<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        open<span style=color:#f92672>(</span>name<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * Creates a &lt;code&gt;FileInputStream&lt;/code&gt; by using the file descriptor
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * &lt;code&gt;fdObj&lt;/code&gt;, which represents an existing connection to an
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * actual file in the file system.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * &lt;p&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * If there is a security manager, its &lt;code&gt;checkRead&lt;/code&gt; method is
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * called with the file descriptor &lt;code&gt;fdObj&lt;/code&gt; as its argument to
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * see if it&#39;s ok to read the file descriptor. If read access is denied
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * to the file descriptor a &lt;code&gt;SecurityException&lt;/code&gt; is thrown.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * &lt;p&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * If &lt;code&gt;fdObj&lt;/code&gt; is null then a &lt;code&gt;NullPointerException&lt;/code&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * is thrown.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * &lt;p&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * This constructor does not throw an exception if &lt;code&gt;fdObj&lt;/code&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * is {@link java.io.FileDescriptor#valid() invalid}.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * However, if the methods are invoked on the resulting stream to attempt
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * I/O on the stream, an &lt;code&gt;IOException&lt;/code&gt; is thrown.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param      fdObj   the file descriptor to be opened for reading.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @throws     SecurityException      if a security manager exists and its
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *                 &lt;code&gt;checkRead&lt;/code&gt; method denies read access to the
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *                 file descriptor.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @see        SecurityManager#checkRead(java.io.FileDescriptor)
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>FileInputStream</span><span style=color:#f92672>(</span>FileDescriptor fdObj<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        SecurityManager security <span style=color:#f92672>=</span> System<span style=color:#f92672>.</span><span style=color:#a6e22e>getSecurityManager</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>fdObj <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> NullPointerException<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>security <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            security<span style=color:#f92672>.</span><span style=color:#a6e22e>checkRead</span><span style=color:#f92672>(</span>fdObj<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        fd <span style=color:#f92672>=</span> fdObj<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        path <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>         * FileDescriptor is being shared by streams.
</span></span></span><span style=display:flex><span><span style=color:#75715e>         * Register this stream with FileDescriptor tracker.
</span></span></span><span style=display:flex><span><span style=color:#75715e>         */</span>
</span></span><span style=display:flex><span>        fd<span style=color:#f92672>.</span><span style=color:#a6e22e>attach</span><span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * Opens the specified file for reading.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param name the name of the file
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>native</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>open0</span><span style=color:#f92672>(</span>String name<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> FileNotFoundException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// wrap native call to allow instrumentation
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * Opens the specified file for reading.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param name the name of the file
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>open</span><span style=color:#f92672>(</span>String name<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> FileNotFoundException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        open0<span style=color:#f92672>(</span>name<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * Reads a byte of data from this input stream. This method blocks
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * if no input is yet available.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return     the next byte of data, or &lt;code&gt;-1&lt;/code&gt; if the end of the
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *             file is reached.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @exception  IOException  if an I/O error occurs.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>read</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> read0<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>native</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>read0</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> IOException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * Reads a subarray as a sequence of bytes.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param b the data to be written
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param off the start offset in the data
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param len the number of bytes that are written
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @exception IOException If an I/O error has occurred.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>native</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>readBytes</span><span style=color:#f92672>(</span><span style=color:#66d9ef>byte</span> b<span style=color:#f92672>[],</span> <span style=color:#66d9ef>int</span> off<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> len<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> IOException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * Reads up to &lt;code&gt;b.length&lt;/code&gt; bytes of data from this input
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * stream into an array of bytes. This method blocks until some input
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * is available.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param      b   the buffer into which the data is read.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return     the total number of bytes read into the buffer, or
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *             &lt;code&gt;-1&lt;/code&gt; if there is no more data because the end of
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *             the file has been reached.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @exception  IOException  if an I/O error occurs.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>read</span><span style=color:#f92672>(</span><span style=color:#66d9ef>byte</span> b<span style=color:#f92672>[])</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> readBytes<span style=color:#f92672>(</span>b<span style=color:#f92672>,</span> 0<span style=color:#f92672>,</span> b<span style=color:#f92672>.</span><span style=color:#a6e22e>length</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * Reads up to &lt;code&gt;len&lt;/code&gt; bytes of data from this input stream
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * into an array of bytes. If &lt;code&gt;len&lt;/code&gt; is not zero, the method
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * blocks until some input is available; otherwise, no
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * bytes are read and &lt;code&gt;0&lt;/code&gt; is returned.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param      b     the buffer into which the data is read.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param      off   the start offset in the destination array &lt;code&gt;b&lt;/code&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param      len   the maximum number of bytes read.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return     the total number of bytes read into the buffer, or
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *             &lt;code&gt;-1&lt;/code&gt; if there is no more data because the end of
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *             the file has been reached.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @exception  NullPointerException If &lt;code&gt;b&lt;/code&gt; is &lt;code&gt;null&lt;/code&gt;.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @exception  IndexOutOfBoundsException If &lt;code&gt;off&lt;/code&gt; is negative,
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * &lt;code&gt;len&lt;/code&gt; is negative, or &lt;code&gt;len&lt;/code&gt; is greater than
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * &lt;code&gt;b.length - off&lt;/code&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @exception  IOException  if an I/O error occurs.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>read</span><span style=color:#f92672>(</span><span style=color:#66d9ef>byte</span> b<span style=color:#f92672>[],</span> <span style=color:#66d9ef>int</span> off<span style=color:#f92672>,</span> <span style=color:#66d9ef>int</span> len<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> readBytes<span style=color:#f92672>(</span>b<span style=color:#f92672>,</span> off<span style=color:#f92672>,</span> len<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * Skips over and discards &lt;code&gt;n&lt;/code&gt; bytes of data from the
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * input stream.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * &lt;p&gt;The &lt;code&gt;skip&lt;/code&gt; method may, for a variety of
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * reasons, end up skipping over some smaller number of bytes,
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * possibly &lt;code&gt;0&lt;/code&gt;. If &lt;code&gt;n&lt;/code&gt; is negative, the method
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * will try to skip backwards. In case the backing file does not support
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * backward skip at its current position, an &lt;code&gt;IOException&lt;/code&gt; is
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * thrown. The actual number of bytes skipped is returned. If it skips
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * forwards, it returns a positive value. If it skips backwards, it
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * returns a negative value.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * &lt;p&gt;This method may skip more bytes than what are remaining in the
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * backing file. This produces no exception and the number of bytes skipped
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * may include some number of bytes that were beyond the EOF of the
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * backing file. Attempting to read from the stream after skipping past
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * the end will result in -1 indicating the end of the file.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param      n   the number of bytes to be skipped.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return     the actual number of bytes skipped.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @exception  IOException  if n is negative, if the stream does not
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *             support seek, or if an I/O error occurs.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>long</span> <span style=color:#a6e22e>skip</span><span style=color:#f92672>(</span><span style=color:#66d9ef>long</span> n<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> skip0<span style=color:#f92672>(</span>n<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>native</span> <span style=color:#66d9ef>long</span> <span style=color:#a6e22e>skip0</span><span style=color:#f92672>(</span><span style=color:#66d9ef>long</span> n<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> IOException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * Returns an estimate of the number of remaining bytes that can be read (or
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * skipped over) from this input stream without blocking by the next
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * invocation of a method for this input stream. Returns 0 when the file
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * position is beyond EOF. The next invocation might be the same thread
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * or another thread. A single read or skip of this many bytes will not
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * block, but may read or skip fewer bytes.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * &lt;p&gt; In some cases, a non-blocking read (or skip) may appear to be
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * blocked when it is merely slow, for example when reading large
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * files over slow networks.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return     an estimate of the number of remaining bytes that can be read
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *             (or skipped over) from this input stream without blocking.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @exception  IOException  if this file input stream has been closed by calling
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *             {@code close} or an I/O error occurs.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>available</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> available0<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>native</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>available0</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> IOException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * Closes this file input stream and releases any system resources
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * associated with the stream.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * &lt;p&gt; If this stream has an associated channel then the channel is closed
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * as well.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @exception  IOException  if an I/O error occurs.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @revised 1.4
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @spec JSR-51
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>close</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>synchronized</span> <span style=color:#f92672>(</span>closeLock<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>closed<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            closed <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>channel <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>           channel<span style=color:#f92672>.</span><span style=color:#a6e22e>close</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        fd<span style=color:#f92672>.</span><span style=color:#a6e22e>closeAll</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> Closeable<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>close</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>               close0<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>           <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>});</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * Returns the &lt;code&gt;FileDescriptor&lt;/code&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * object  that represents the connection to
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * the actual file in the file system being
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * used by this &lt;code&gt;FileInputStream&lt;/code&gt;.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return     the file descriptor object associated with this stream.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @exception  IOException  if an I/O error occurs.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @see        java.io.FileDescriptor
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>final</span> FileDescriptor <span style=color:#a6e22e>getFD</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>fd <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> fd<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> IOException<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * Returns the unique {@link java.nio.channels.FileChannel FileChannel}
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * object associated with this file input stream.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * &lt;p&gt; The initial {@link java.nio.channels.FileChannel#position()
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * position} of the returned channel will be equal to the
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * number of bytes read from the file so far.  Reading bytes from this
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * stream will increment the channel&#39;s position.  Changing the channel&#39;s
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * position, either explicitly or by reading, will change this stream&#39;s
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * file position.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return  the file channel associated with this file input stream
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @since 1.4
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @spec JSR-51
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> FileChannel <span style=color:#a6e22e>getChannel</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>synchronized</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>this</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>channel <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                channel <span style=color:#f92672>=</span> FileChannelImpl<span style=color:#f92672>.</span><span style=color:#a6e22e>open</span><span style=color:#f92672>(</span>fd<span style=color:#f92672>,</span> path<span style=color:#f92672>,</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>this</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> channel<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>native</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>initIDs</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>native</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>close0</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> IOException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>static</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        initIDs<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * Ensures that the &lt;code&gt;close&lt;/code&gt; method of this file input stream is
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * called when there are no more references to it.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @exception  IOException  if an I/O error occurs.
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @see        java.io.FileInputStream#close()
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>finalize</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>((</span>fd <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>&amp;&amp;</span>  <span style=color:#f92672>(</span>fd <span style=color:#f92672>!=</span> FileDescriptor<span style=color:#f92672>.</span><span style=color:#a6e22e>in</span><span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>/* if fd is shared, the references in FileDescriptor
</span></span></span><span style=display:flex><span><span style=color:#75715e>             * will ensure that finalizer is only called when
</span></span></span><span style=display:flex><span><span style=color:#75715e>             * safe to do so. All references using the fd have
</span></span></span><span style=display:flex><span><span style=color:#75715e>             * become unreachable. We can call close()
</span></span></span><span style=display:flex><span><span style=color:#75715e>             */</span>
</span></span><span style=display:flex><span>            close<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="2023-09-28 22:47:27">更新于 2023-09-28&nbsp;</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a href=liudongdong1.github.io/code_inputstream/index.md title=阅读原始文档 class=link-to-markdown>阅读原始文档</a></span><span><a href=https://liudongdong1.github.io/edit/master/content/posts%5c%e7%bc%96%e7%a8%8b%e8%af%ad%e8%a8%80%5cjava%5cjavaIO%5cCode_InputStream.md title=编辑此页 target=_blank rel="external nofollow noopener noreferrer" class=link-to-edit>编辑此页</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=liudongdong1.github.io/code_inputstream/ data-title=Code_InputStream data-hashtags=Java,Storage><i class="fa-brands fa-twitter fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=liudongdong1.github.io/code_inputstream/ data-hashtag=Java><i class="fa-brands fa-facebook-square fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=liudongdong1.github.io/code_inputstream/ data-title=Code_InputStream data-image=https://cdn.stocksnap.io/img-thumbs/280h/workspace-office_CB4OANNVNO.jpg><i class="fa-brands fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=liudongdong1.github.io/tags/java/>Java</a>,&nbsp;<a href=liudongdong1.github.io/tags/storage/>Storage</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=liudongdong1.github.io/>主页</a></span></section></div><div class=post-nav><a href=liudongdong1.github.io/iteratormode/ class=prev rel=prev title=IteratorMode><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>IteratorMode</a>
<a href=liudongdong1.github.io/strategymode/ class=next rel=next title=StrategyMode>StrategyMode<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></main><footer class=footer><div class=footer-container><div class="footer-line powered">由 <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.118.2">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.2.17-RC"><img class=fixit-icon src=/liudongdong1.github.io/fixit.min.svg alt="FixIt logo">&nbsp;FixIt</a></div><div class="footer-line copyright" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2020 - 2023</span><span class=author itemprop=copyrightHolder>
<a href=https://liudongdong1.github.io/ target=_blank rel="external nofollow noopener noreferrer">LiuDongdong</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class="footer-line statistics"><span class=site-time title='网站运行中 ...'><i class="fa-solid fa-heartbeat fa-fw animate-icon" aria-hidden=true></i>&nbsp;<span class=run-times>网站运行中 ...</span></span></div><div class="footer-line ibruce"><span id=busuanzi_container_site_uv title=总访客数><i class="fa-regular fa-user fa-fw" aria-hidden=true></i>&nbsp;<span id=busuanzi_value_site_uv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span><span id=busuanzi_container_site_pv class=footer-divider title=总访问量><i class="fa-regular fa-eye fa-fw" aria-hidden=true></i>&nbsp;<span id=busuanzi_value_site_pv><i class="fa-solid fa-spinner fa-spin fa-fw" aria-hidden=true></i></span></span></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label=回到顶部><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class=variant-numeric>0%</span></div></div><a href=https://liudongdong1.github.io/ title="在 GitHub 上查看源代码" target=_blank rel="external nofollow" class="github-corner right d-none-mobile"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><div id=mask></div><div class=reading-progress-bar style=left:0;top:0;--bg-progress:#0076ff;--bg-progress-dark:#fff></div><noscript><div class=noscript-warning>FixIt 主题在启用 JavaScript 的情况下效果最佳。</div></noscript></div><link rel=stylesheet href=/liudongdong1.github.io/lib/katex/katex.min.css><link rel=stylesheet href=/liudongdong1.github.io/lib/cookieconsent/cookieconsent.min.css><script src=/liudongdong1.github.io/lib/autocomplete/autocomplete.min.js defer></script><script src=/liudongdong1.github.io/lib/algoliasearch/algoliasearch-lite.umd.min.js defer></script><script src=/liudongdong1.github.io/lib/lazysizes/lazysizes.min.js async defer></script><script src=/liudongdong1.github.io/lib/sharer/sharer.min.js async defer></script><script src=/liudongdong1.github.io/lib/typeit/index.umd.js defer></script><script src=/liudongdong1.github.io/lib/katex/katex.min.js defer></script><script src=/liudongdong1.github.io/lib/katex/auto-render.min.js defer></script><script src=/liudongdong1.github.io/lib/katex/copy-tex.min.js defer></script><script src=/liudongdong1.github.io/lib/katex/mhchem.min.js defer></script><script src=/liudongdong1.github.io/lib/cookieconsent/cookieconsent.min.js defer></script><script src=/liudongdong1.github.io/lib/pangu/pangu.min.js defer></script><script src=/liudongdong1.github.io/lib/cell-watermark/watermark.min.js defer></script><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js async defer></script><script>window.config={code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:10},comment:{enable:!1},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验。"},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},data:{"typeit-header-subtitle-desktop":`<span style='font-family: MMT,"沐目体";'>吾日三省吾身</span>`,"typeit-header-subtitle-mobile":`<span style='font-family: MMT,"沐目体";'>吾日三省吾身</span>`},enablePWA:!0,enablePangu:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{algoliaAppID:"2R1K9SKLQZ",algoliaIndex:"index.zh-cn",algoliaSearchKey:"4a226aa1c5c98d6859e4d1386adb2bc7",highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"algolia"},siteTime:"2020-12-18T16:15:22+08:00",typeit:{cursorChar:"|",cursorSpeed:1e3,data:{"typeit-header-subtitle-desktop":["typeit-header-subtitle-desktop"],"typeit-header-subtitle-mobile":["typeit-header-subtitle-mobile"]},duration:-1,speed:100},watermark:{appendto:".wrapper>main",colspacing:30,content:'<img class="fixit-icon" src="/fixit.min.svg" alt="FixIt logo" /> FixIt 主题',enable:!0,fontfamily:"inherit",fontsize:.85,height:21,opacity:.0125,rotate:15,rowspacing:60,width:150}}</script><script src=/liudongdong1.github.io/js/theme.min.js defer></script><script src=/liudongdong1.github.io/js/custom.min.js defer></script></body></html>