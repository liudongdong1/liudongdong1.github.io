<!DOCTYPE HTML>
<html lang="en">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Zookeeper, AIOT,Space&amp;Temporal Sequence Analysis,SpringBoot,liudongdong1,cloud">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>Zookeeper | DaybyDay</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="DaybyDay" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">DaybyDay</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>Index</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>Tags</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>Categories</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>Archives</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">

      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>About</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
    </a>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="/about">
          
          <i class="fas fa-user-circle" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>about</span>
        </a>
      </li>
      
      <li>
        <a href="/resume">
          
          <i class="fa fa-user-secret" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>resume</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>Friends</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/gallery" class="waves-effect waves-light">
      
      <i class="fas fa-camera" style="zoom: 0.6;"></i>
      
      <span>Galleries</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="Search" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">DaybyDay</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			Index
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			Tags
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			Categories
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			Archives
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-user-circle"></i>
			
			About
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>

                  <a href="/about " style="margin-left:75px">
				  
				   <i class="fa fas fa-user-circle" style="position: absolute;left:50px" ></i>
			      
		          <span>about</span>
                  </a>
                </li>
              
                <li>

                  <a href="/resume " style="margin-left:75px">
				  
				   <i class="fa fa fa-user-secret" style="position: absolute;left:50px" ></i>
			      
		          <span>resume</span>
                  </a>
                </li>
              
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			Friends
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/gallery" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-camera"></i>
			
			Galleries
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/liudongdong1" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/liudongdong1" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/4.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Zookeeper</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    .toc-fixed .toc-link::before{
        position: fixed!important;/*当toc的位置改为fixed时，.toc-link::before也要改为fixed*/
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Framework/">
                                <span class="chip bg-color">Framework</span>
                            </a>
                        
                            <a href="/tags/Distribution/">
                                <span class="chip bg-color">Distribution</span>
                            </a>
                        
                            <a href="/tags/zookeeper/">
                                <span class="chip bg-color">zookeeper</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E8%AF%AD%E8%A8%80%E6%A1%86%E6%9E%B6/" class="post-category">
                                语言框架
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>Publish Date:&nbsp;&nbsp;
                    2021-07-19
                </div>
                

                <!-- 
                    <i class="fa fa-pencil"></i> Author: liudongdong1
                  -->

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>Update Date:&nbsp;&nbsp;
                    2021-07-24
                </div>
                

                <!-- 
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>Word Count:&nbsp;&nbsp;
                    6.4k
                </div>
                 -->

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>Read Times:&nbsp;&nbsp;
                    27 Min
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>Read Count:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <blockquote>
<p>ZooKeeper是一个<code>分布式的、开放源码的分布式协调服务</code>，是Google的Chubby一个开源的实现，<code>是Hadoop和Hbase的重要组件</code>。它是一个为分布式应用提供一致性服务的软件，提供的功能包括：<code>配置维护、域名服务、分布式同步、组服务等</code>。由于Hadoop生态系统中很多项目都依赖于zookeeper，如Pig，Hive等， 似乎很像一个动物园管理员，于是取名为Zookeeper。 <a href="https://github.com/apache/zookeeper" target="_blank" rel="noopener">Zookeeper</a>官网地址为<a href="https://link.zhihu.com/?target=http%3A//zookeeper.apache.org/">http://zookeeper.apache.org/</a>。</p>
<ul>
<li><strong>顺序一致性</strong> 从<code>同一个客户端</code>发起的事务请求，将会<code>严格按照其发起顺序</code>被应用到zookeeper中</li>
<li><strong>原子性</strong> 所有事物请求的处理结果在整个集群中所有机器上的应用情况是一致的，要么<code>整个集群中所有机器都成功应用了某一事务</code>，<code>要么都没有应用某一事务</code>，不会出现集群中部分机器应用了事务，另一部分没有应用的情况。</li>
<li><strong>单一视图</strong> 无论客户端连接的是哪个zookeeper服务端，<code>其获取的服务端数据模型都是一致的</code>。</li>
<li><strong>可靠性</strong> 一旦服务端成功的应用了一个事务，并完成对客户端的响应，那么<code>该事务所引起的服务端状态变更将会一直保留下来</code>，直到有另一个事务又对其进行了改变。</li>
<li><strong>实时性</strong> 一旦服务端成功的应用了一个事物，那客户端立刻能看到变更后的状态</li>
</ul>
</blockquote>
<h3 id="1-基本概念"><a href="#1-基本概念" class="headerlink" title="1.  基本概念"></a>1.  基本概念</h3><h4 id="1-角色"><a href="#1-角色" class="headerlink" title=".1. 角色"></a>.1. 角色</h4><p><img src="../../../../../picture/2020060621.png" alt=""></p>
<h4 id="2-网路结构"><a href="#2-网路结构" class="headerlink" title=".2. 网路结构"></a>.2. 网路结构</h4><p><img src="../../../../../picture/2020060622.png" alt=""></p>
<ul>
<li>Leader和各个follower是互相通信的，对于zk系统的数据都是保存在内存里面的，同样也会备份一份在磁盘上。</li>
<li>对于每个zk节点而言，可以看做每个zk节点的命名空间是一样的，也就是有同样的数据。（可查看下面的树结构）</li>
<li>如果Leader挂了，zk集群会重新选举，在毫秒级别就会重新选举出一个Leaer。</li>
<li>集群中除非有一半以上的zk节点挂了，zk service才不可用。</li>
</ul>
<h4 id="3-命名控件结构"><a href="#3-命名控件结构" class="headerlink" title=".3. 命名控件结构"></a>.3. 命名控件结构</h4><blockquote>
<p>与linux文件系统不同的是，linux文件系统有目录和文件的区别，而zk统一叫做znode，一个znode节点可以包含子znode，同时也可以包含数据。比如/Nginx/conf，/是一个znode，/Nginx是/的子znode，/Nginx还可以包含数据，数据内容就是所有安装Nginx的机器IP，/Nginx/conf是/Nginx子znode，它也可以包含内容，数据就是Nginx的配置文件内容。在应用中，我们可以通过这样一个路径就可以获得所有安装Nginx的机器IP列表，还可以获得这些机器上Nginx的配置文件。</p>
</blockquote>
<p><img src="../../../../../picture/2020060623.png" alt=""></p>
<h4 id="4-读写数据"><a href="#4-读写数据" class="headerlink" title=".4. 读写数据"></a>.4. 读写数据</h4><blockquote>
<ul>
<li><p>写数据，当一个客户端进行写数据请求时，会指定zk集群中节点，如果是<code>follower接收到写请求</code>，就会<code>把请求转发给Leader</code>，<code>Leader通过内部的Zab协议进行原子广播，直到所有zk节点都成功写了数据后（内存同步以及磁盘更新）</code>，这次写请求算是完成，然后<code>zk service就会给client发回响应</code></p>
</li>
<li><p>读数据，因为集群中所有的zk节点都呈现一个同样的命名空间视图（就是结构数据），上面的写请求已经保证了写一次数据必须保证集群所有的zk节点都是同步命名空间的，所以<code>读的时候可以在任意一台zk节点上</code></p>
</li>
</ul>
<p>ps:其实写数据的时候不是要保证所有zk节点都写完才响应，而是<code>保证一半以上的节点写完了</code>就把这次变更更新到内存，<code>并且当做最新命名空间的应用</code>。所以在读数据的时候可能会读到不是最新的zk节点，这时候只能通过sync()解决。</p>
</blockquote>
<h4 id="5-znode类型"><a href="#5-znode类型" class="headerlink" title=".5. znode类型"></a>.5. znode类型</h4><ul>
<li><strong>PERSISTENT</strong>：<code>持久化znode节点</code>，一旦创建这个znode点存储的数据不会主动消失，除非是客户端主动的delete。</li>
<li><strong>SEQUENCE</strong>：<code>顺序增加编号znode节点</code>，比如ClientA去zk service上建立一个znode名字叫做/Nginx/conf，指定了这种类型的节点后zk会创建/Nginx/conf0000000000，ClientB再去创建就是创建/Nginx/conf0000000001，ClientC是创建/Nginx/conf0000000002，以后任意Client来创建这个znode都会得到一个比当前zk命名空间最大znode编号+1的znode，也就说任意一个Client去创建znode都是保证得到的znode是递增的，而且是唯一的。</li>
<li><strong>EPHEMERAL</strong>：<code>临时znode节点</code>，Client连接到zk service的时候会建立一个session，之后用这个zk连接实例创建该类型的znode，一旦Client关闭了zk的连接，服务器就会清除session，然后这个session建立的znode节点都会从命名空间消失。总结就是，这个<code>类型的znode的生命周期是和Client建立的连接一样的</code>。比如ClientA创建了一个EPHEMERAL的/Nginx/conf0000000011的znode节点，一旦ClientA的zk连接关闭，这个znode节点就会消失。整个zk service命名空间里就会删除这个znode节点。</li>
<li><strong>PERSISTENT|SEQUENTIAL</strong>：<code>顺序自动编号的znode节点</code>，这种znoe节点会根据当前已近存在的znode节点编号自动加 1，而且不会随session断开而消失。</li>
<li><strong>EPHEMERAL|SEQUENTIAL</strong>：<code>临时自动编号节点</code>，znode节点编号会自动增加，但是会随session消失而消失</li>
</ul>
<h3 id="2-工作原理"><a href="#2-工作原理" class="headerlink" title="2. 工作原理"></a>2. 工作原理</h3><blockquote>
<p><code>Zookeeper 的核心是广播</code>，这个机制保证了各个Server之间的同步。实现这个机制的协议叫做<code>Zab协议</code>。</p>
<p>Zab协议有两种模式，它们分别是<code>恢复模式（选主</code>）和<code>广播 模式（同步）</code>。当服务启动或者在领导者崩溃后，Zab就进入了恢复模式，当领导者被选举出来，且大多数Server完成了和leader的状态同步以后， 恢复模式就结束了。状态同步保证了leader和Server具有相同的系统状态。<code>为了保证事务的顺序一致性，zookeeper采用了递增的事务id号 （zxid）来标识事务</code>。所有的提议（proposal）都在被提出的时候加上了zxid。实现中zxid是一个64位的数字，它高32位是epoch用 来标识leader关系是否改变，每次一个leader被选出来，它都会有一个新的epoch，标识当前属于那个leader的统治时期。低32位用于递增计数。</p>
<p>每个Server在工作过程中有三种状态：</p>
<ul>
<li><code>LOOKING</code>：当前<code>Server不知道leader是谁</code>，正在搜寻。</li>
<li><code>LEADING</code>：当前<code>Server即为选举出来的leader</code>。</li>
<li><code>FOLLOWING</code>：leader已经选举出来，<code>当前Server与之同步</code>。</li>
</ul>
</blockquote>
<h4 id="1-Sessions（会话）"><a href="#1-Sessions（会话）" class="headerlink" title=".1. Sessions（会话）"></a>.1. Sessions（会话）</h4><blockquote>
<p>会话对于ZooKeeper的操作非常重要。<code>会话中的请求按FIFO顺序执行</code>。一旦客户端连接到服务器，将建立会话并向客户端分配会话ID 。客户端<code>以特定的时间间隔发送心跳以保持会话有效</code>。如果ZooKeeper集合在超过服务器开启时指定的期间（会话超时）都没有从客户端接收到心跳，则它会判定客户端死机。会话超时通常<code>以毫秒为单位</code>。当会话由于任何原因结束时，在该会话期间创建的临时节点也会被删除。</p>
</blockquote>
<h4 id="2-Watches（监视）"><a href="#2-Watches（监视）" class="headerlink" title=".2. Watches（监视）"></a>.2. Watches（监视）</h4><blockquote>
<p>监视是一种简单的机制，<code>使客户端收到关于ZooKeeper集合中的更改的通知</code>。客户端可以在读取特定znode时设置Watches。<code>Watches会向注册的客户端发送任何znode（客户端注册表）更改的通知</code>。Znode更改是与znode相关的数据的修改或znode的子项中的更改。只触发一次watches。如果客户端想要再次通知，则必须通过另一个读取操作来完成。当连接会话过期时，客户端将与服务器断开连接，相关的watches也将被删除。</p>
</blockquote>
<h3 id="3-安装"><a href="#3-安装" class="headerlink" title="3. 安装"></a>3. 安装</h3><h4 id="1-单机安装"><a href="#1-单机安装" class="headerlink" title=".1. 单机安装"></a>.1. 单机安装</h4><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看jdk版本</span></span><br><span class="line">java -version</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 下载 zookeeper</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 下载对应版本安装包</span></span><br><span class="line">wget http://mirrors.bfsu.edu.cn/apache/zookeeper/zookeeper-3.6.2/apache-zookeeper-3.6.2-bin.tar.gz</span><br><span class="line"><span class="meta">#</span><span class="bash"> 解压到指定安装目录</span></span><br><span class="line">tar -zxvf apache-zookeeper-3.6.2-bin.tar.gz -C /usr/local/zookeeper</span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建数据和日志目录</span></span><br><span class="line">cd /usr/local/zookeeper &amp;&amp; mv apache-zookeeper-3.6.2-bin apache-zookeeper-3.6.2</span><br><span class="line">mkdir -pv data logs</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置自己的配置文件</span></span><br><span class="line">vi /usr/local/zookeeper/apache-zookeeper-3.6.2/conf/zoo.cfg</span><br></pre></td></tr></tbody></table></figure>

<h5 id="1-zookeeper配置文件"><a href="#1-zookeeper配置文件" class="headerlink" title=".1. zookeeper配置文件"></a>.1. zookeeper配置文件</h5><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 心跳间隔 毫秒</span></span><br><span class="line">tickTime=1000</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动时leader连接follower，超过多少次心跳间隔，follower连接超时</span></span><br><span class="line">initLimit=10</span><br><span class="line"><span class="meta">#</span><span class="bash"> leader与follower 通信超时 最长心跳间隔次数</span></span><br><span class="line">syncLimit=5</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 客户端连接的端口</span></span><br><span class="line">clientPort=2181</span><br><span class="line"><span class="meta">#</span><span class="bash"> 客户端连接的最大数量</span></span><br><span class="line"><span class="meta">#</span><span class="bash">maxClientCnxns=60</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 数据文件目录</span></span><br><span class="line">dataDir=/usr/local/zookeeper/apache-zookeeper-3.6.2/data</span><br><span class="line"><span class="meta">#</span><span class="bash"> 日志目录</span></span><br><span class="line">dataLogDir=/usr/local/zookeeper/apache-zookeeper-3.6.2/logs</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 最小会话超时时间</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> minSessionTimeout=2000</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 最大会话超时时间</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> maxSessionTimeout=20000</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 清除任务间隔（以小时为单位）</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置为0以禁用自动清除功能</span></span><br><span class="line">autopurge.purgeInterval=5</span><br><span class="line"><span class="meta">#</span><span class="bash"> 最多保存20个文件 日志文件、快照</span></span><br><span class="line">autopurge.snapRetainCount=20 </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">开启四字命令</span></span><br><span class="line"><span class="meta">#</span><span class="bash">4lw.commands.whitelist=*</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 集群信息</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> server.A=B:C:D</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> A 代表记号服务器，在dataDir目录下myid文件下记录</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> B 服务器ip地址</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> C 服务器与集群中的leader服务器交换信息的端口</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> D 选举leader所用的端口</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> server.1=127.0.0.1:3181:4181</span></span><br></pre></td></tr></tbody></table></figure>

<h5 id="2-shell-命令"><a href="#2-shell-命令" class="headerlink" title=".2. shell 命令"></a>.2. shell 命令</h5><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">启动zk : bin/zkServer.sh start</span><br><span class="line">查看ZK服务状态: bin/zkServer.sh status</span><br><span class="line">停止ZK服务: bin/zkServer.sh stop</span><br><span class="line">重启ZK服务: bin/zkServer.sh restart</span><br><span class="line">连接服务器 : bin/zkCli.sh -server 127.0.0.1:2181</span><br></pre></td></tr></tbody></table></figure>

<h4 id="2-单机伪集群安装"><a href="#2-单机伪集群安装" class="headerlink" title=".2. 单机伪集群安装"></a>.2. 单机伪集群安装</h4><ul>
<li><h4 id="指定服务机器名称"><a href="#指定服务机器名称" class="headerlink" title="指定服务机器名称"></a>指定服务机器名称</h4></li>
</ul>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建每个服务对应的目录 这里使用2181，2182，2183三个端口，data是数据目录，conf是配置文件目录，logs是日志目录。</span></span><br><span class="line">mkdir -pv cluster/{2181/{conf,data,logs},2182/{conf,data,logs},2183/{conf,data,logs}}</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><strong>指定服务机器名称</strong></li>
</ul>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 指定服务机器名称， zookeeper集群中的每台机器都知道其他的机器的信息，便于在集群出现问题后，重新选举leader等。</span></span><br><span class="line">echo 1 &gt; cluster/2181/data/myid</span><br><span class="line">echo 2 &gt; cluster/2182/data/myid</span><br><span class="line">echo 3 &gt; cluster/2183/data/myid</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><strong>创建服务配置文件</strong></li>
</ul>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">为每个服务配置指定的配置文件，主要修改端口号，数据、日志目录。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入2181服务目录，修改其配置文件</span></span><br><span class="line">vi cluster/2181/conf/zoo.cfg</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 更改端口号，数据、日志目录，并配置集群机器信息</span></span><br><span class="line">clientPort=2181</span><br><span class="line">dataDir=/usr/local/zookeeper/apache-zookeeper-3.6.2/cluster/2181/data</span><br><span class="line">dataLogDir=/usr/local/zookeeper/apache-zookeeper-3.6.2/cluster/2181/logs</span><br><span class="line"></span><br><span class="line">server.1=127.0.0.1:3181:4181</span><br><span class="line">server.2=127.0.0.1:3182:4182</span><br><span class="line">server.3=127.0.0.1:3183:4183</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 复制配置文件到其他服务目录</span></span><br><span class="line">cp cluster/2181/conf/zoo.cfg cluster/2182/conf/zoo.cfg</span><br><span class="line">cp cluster/2181/conf/zoo.cfg cluster/2183/conf/zoo.cfg</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改其他服务配置文件 </span></span><br><span class="line">vi cluster/2182/conf/zoo.cfg</span><br><span class="line">vi cluster/2182/conf/zoo.cfg</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> vim 快速替换 %s/2181/2182/g</span></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><strong>启动集群服务</strong></li>
</ul>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./bin/zkServer.sh start /usr/local/zookeeper/apache-zookeeper-3.6.2/cluster/2181/conf/zoo.cfg</span><br><span class="line">./bin/zkServer.sh start /usr/local/zookeeper/apache-zookeeper-3.6.2/cluster/2182/conf/zoo.cfg</span><br><span class="line">./bin/zkServer.sh start /usr/local/zookeeper/apache-zookeeper-3.6.2/cluster/2183/conf/zoo.cfg</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><strong>查看服务状态</strong></li>
</ul>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./bin/zkServer.sh status /usr/local/zookeeper/apache-zookeeper-3.6.2/cluster/2181/conf/zoo.cfg</span><br><span class="line">./bin/zkServer.sh status /usr/local/zookeeper/apache-zookeeper-3.6.2/cluster/2182/conf/zoo.cfg</span><br><span class="line">./bin/zkServer.sh status /usr/local/zookeeper/apache-zookeeper-3.6.2/cluster/2183/conf/zoo.cfg</span><br></pre></td></tr></tbody></table></figure>

<h3 id="4-zookeeper-CLI"><a href="#4-zookeeper-CLI" class="headerlink" title="4. zookeeper CLI"></a>4. zookeeper CLI</h3><blockquote>
<p>ZooKeeper命令行界面（CLI）用于与ZooKeeper集合进行交互以进行开发。它有助于调试和解决不同的选项。<br>要执行ZooKeeper CLI操作，首先打开ZooKeeper服务器（“bin/zkServer.sh start”），然后打开ZooKeeper客户端（“bin/zkCli.sh”）。</p>
</blockquote>
<h4 id="1-节点属性"><a href="#1-节点属性" class="headerlink" title=".1. 节点属性"></a>.1. 节点属性</h4><table>
<thead>
<tr>
<th>属性名</th>
<th>属性说明</th>
</tr>
</thead>
<tbody><tr>
<td>cZxid</td>
<td>数据节点创建的事务id。</td>
</tr>
<tr>
<td>ctime</td>
<td>数据节点创建的时间。</td>
</tr>
<tr>
<td>mZxid</td>
<td>数据节点最后一次更新时的事务id</td>
</tr>
<tr>
<td>mtime</td>
<td>数据节点最后一次更新的时间。</td>
</tr>
<tr>
<td>pZxid</td>
<td>数据节点的子节点最后一次被修改时的事务id。</td>
</tr>
<tr>
<td>cversion</td>
<td>子节点的更改次数。</td>
</tr>
<tr>
<td>dataVersion</td>
<td>节点数据的更改次数，也就是数据的版本。类似于关系型数据库的乐观锁。</td>
</tr>
<tr>
<td>aclVersion</td>
<td>节点ACL权限的更改次数。</td>
</tr>
<tr>
<td>ephemeralOwner</td>
<td>如果节点是临时节点，则该属性表示创建该节点的会话SessionId。如果该节点是持久节点，该属性为0，可以使用该属性来判断节点是否为临时节点。</td>
</tr>
<tr>
<td>dataLength</td>
<td>数据的内容长度，单位字节。</td>
</tr>
<tr>
<td>numChildren</td>
<td>子节点的个数</td>
</tr>
</tbody></table>
<h4 id="2-shell-命令-1"><a href="#2-shell-命令-1" class="headerlink" title=".2. shell 命令"></a>.2. shell 命令</h4><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建一个节点 -e为临时节点 -s为顺序节点 -c为容器节点 -t为ttl节点</span></span><br><span class="line">create /file "file data"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 获取当前节点数据</span></span><br><span class="line">get /file</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置节点数据</span></span><br><span class="line">set /file "data"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建子节点</span></span><br><span class="line">create /file/test "data"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 获取当前节点状态</span></span><br><span class="line">stat /file</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除一个节点</span></span><br><span class="line">delete /file</span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除指定版本的节点</span></span><br><span class="line">delete -v 1 /file</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除节点以及其包含的子节点</span></span><br><span class="line">deleteall /file</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置节点配置</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -n 子节点个数 -b 节点数据长度</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 超出配额并不会报错，而是会在日志（*.out）中出现警告</span></span><br><span class="line">setquota /data -n 3</span><br><span class="line">setquota /data -b 100</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看配额</span></span><br><span class="line">listquota /data</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除配额</span></span><br><span class="line">delquota /data</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 列出节点下面的所有子节点</span></span><br><span class="line">ls -R /</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 强制同步所有的更新操作</span></span><br><span class="line">sync /data</span><br></pre></td></tr></tbody></table></figure>

<h3 id="5-Java-API"><a href="#5-Java-API" class="headerlink" title="5. Java API"></a>5. Java API</h3><h4 id="1-连接"><a href="#1-连接" class="headerlink" title=".1. 连接"></a>.1. 连接</h4><blockquote>
<p><code>每个构造器创建连接都是异步的</code>，构造方法启动与服务器的连接,然后立马返回,此时会话处于CONNECTING状态，通过watcher通知。此通知可以在构造方法调用返回之前或之后的任何时候到来。会话创建成功之后,状态会改为CONNECTED。</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数名</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>connectString</td>
<td>要创建ZooKeeper客户端对象，应用程序需要传递一个连接字符串，其中包含逗号分隔的host:port列表，每个对应一个ZooKeeper服务器。例如：127.0.0.1:2181,127.0.0.1:2182,127.0.0.1:2183实例化的ZooKeeper客户端对象将从connectString中选择一个任意服务器并尝试连接到它。如果建立连接失败，将尝试连接字符串中的另一个服务器（顺序是非确定性的，因为是随机），直到建立连接。客户端将继续尝试，直到会话显式关闭。在3.2.0版本之后,也可以在connectString后面添加后缀字符串，如：127.0.0.1:2181,127.0.0.1:2182,127.0.0.1:2183/app/a,客户端连接上ZooKeeper服务器之后，所有对ZooKeeper的操作，都会基于这个根目录。例如，客户端对/foo/bar的操作，都会指向节点/app/a/foo/bar——这个目录也叫Chroot，即客户端隔离命名空间。</td>
</tr>
<tr>
<td>sessionTimeout</td>
<td>会话超时（以毫秒为单位）客户端和服务端连接创建成功之后,ZooKeeper中会建立一个会话，在一个会话周期内，ZooKeeper客户端和服务端之间会通过心跳检测机制来维持会话的有效性，一旦在sessionTimeout时间内没有进行有效的心跳检测，会话就会失效。</td>
</tr>
<tr>
<td>watcher</td>
<td>创建ZooKeeper客户端对象时,ZooKeeper允许客户端在构造方法中传入一个接口Watcher（org.apache.zookeeper.Watcher）的实现类对象来作为默认的Watcher事件通知处理器。当然，该参数可以设置为null以表明不需要设置默认的Watcher处理器。如果设置为null，日志中会有空指针异常，但是并不影响使用。</td>
</tr>
<tr>
<td>canBeReadOnly</td>
<td>3.4之后添加的boolean类型的参数，用于标识当前会话是否支持“read-only”模式。默认情况下，在ZooKeeper集群中，一个机器如果和集群中过半以上机器失去了网络连接，那么这个机器将不再处理客户端请求（包括读写请求）。但是在某些使用场景下，当ZooKeeper服务器发生此类故障的时候，我们还是希望ZooKeeper服务器能够提供读服务（当然写服务肯定无法提供）——这就是ZooKeeper的“read-only”模式。</td>
</tr>
<tr>
<td>sessionId 和 sessionPasswd</td>
<td>会话id和 会话密码，这两个参数能够唯一确定一个会话，同时客户端使用这两个参数实现客户端会话复用，从而达到恢复会话的效果，使用方法：第一次连接上ZooKeeper服务器后，客户端使用getSessionId()和getSessionPasswd()获取这两个值，如果需要会话复用,在重新创建ZooKeeper客户端对象的时候可以传过去，如果不需要会话复用，请使用不需要这些参数的其他构造函数。</td>
</tr>
<tr>
<td>HostProvider</td>
<td>客户端地址列表管理器</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.sivan.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.WatchedEvent;</span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.Watcher;</span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.ZooKeeper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * zookeeper的连接和数据库的连接不同，数据库通过DriverManager的getConnect方法就可以直接获取到连接。</span></span><br><span class="line"><span class="comment"> * 但zookeeper在获取连接的过程中，使用了Future。也就意味着，new之后所拿到的仅仅是一个zookeeper对象，而这个对象可能还没有连接到zookeeper服务。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Connect</span> <span class="keyword">implements</span> <span class="title">Watcher</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> CountDownLatch countDownLatch = <span class="keyword">new</span> CountDownLatch(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(WatchedEvent watchedEvent)</span> </span>{</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (watchedEvent.getState() == Event.KeeperState.SyncConnected) {</span><br><span class="line">            <span class="comment">//连接创建成功，唤醒等待线程。</span></span><br><span class="line">            countDownLatch.countDown();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 连接zookeeper</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> connStr address</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> timeout 超时时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ZooKeeper <span class="title">connect</span><span class="params">(String connStr, <span class="keyword">int</span> timeout)</span> </span>{</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">//创建zookeeper</span></span><br><span class="line">            ZooKeeper zooKeeper = <span class="keyword">new</span> ZooKeeper(connStr, timeout, <span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//当前线程 等待连接连接成功的通知</span></span><br><span class="line">            countDownLatch.await();</span><br><span class="line">            <span class="keyword">return</span> zooKeeper;</span><br><span class="line">        } <span class="keyword">catch</span> (Exception ex) {</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<table>
<thead>
<tr>
<th>state</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Disconnected</td>
<td>客户端处于断开状态 - 未连接</td>
</tr>
<tr>
<td>SyncConnected</td>
<td>客户端处于连接状态 - 已连接</td>
</tr>
<tr>
<td>AuthFailed</td>
<td>验证失败状态</td>
</tr>
<tr>
<td>ConnectedReadOnly</td>
<td>客户端连接到只读服务器</td>
</tr>
<tr>
<td>SaslAuthenticated</td>
<td>客户端已通过 SASL 认证，可以使用其 SASL 授权的权限执行 Zookeeper 操作</td>
</tr>
<tr>
<td>Expired</td>
<td>会话已失效</td>
</tr>
<tr>
<td>Closed</td>
<td>客户端已关闭，客户端调用时在本地生成</td>
</tr>
</tbody></table>
<h4 id="2-API-使用"><a href="#2-API-使用" class="headerlink" title=".2. API 使用"></a>.2. API 使用</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.sivan.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.AddWatchMode;</span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.CreateMode;</span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.ZooDefs;</span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.ZooKeeper;</span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.data.ACL;</span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.data.Id;</span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.data.Stat;</span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.server.auth.DigestAuthenticationProvider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZookeeperSimple</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        String path = <span class="string">"/chodble"</span>;</span><br><span class="line">        String address = <span class="string">"127.0.0.1:2181"</span>;</span><br><span class="line">        <span class="keyword">int</span> timeout = <span class="number">3000</span>;</span><br><span class="line"></span><br><span class="line">        Connect zkConnect = <span class="keyword">new</span> Connect();</span><br><span class="line">        ZooKeeper zk = zkConnect.connect(address, timeout);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//判断节点是否存在</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == zk.exists(path, <span class="keyword">true</span>)) {</span><br><span class="line"></span><br><span class="line">            <span class="comment">//设置认证方式</span></span><br><span class="line">            Id ADMIN_IDS = <span class="keyword">new</span> Id(<span class="string">"digest"</span>, DigestAuthenticationProvider.generateDigest(<span class="string">"root:root"</span>));</span><br><span class="line">            Id USER_IDS = <span class="keyword">new</span> Id(<span class="string">"digest"</span>, DigestAuthenticationProvider.generateDigest(<span class="string">"user:user"</span>));</span><br><span class="line">            Id ANYONE_ID_UNSAFE = ZooDefs.Ids.ANYONE_ID_UNSAFE;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             *设置ACL权限</span></span><br><span class="line"><span class="comment">             *Create  允许对子节点Create 操作</span></span><br><span class="line"><span class="comment">             *Read    允许对本节点GetChildren 和GetData 操作</span></span><br><span class="line"><span class="comment">             *Write   允许对本节点SetData 操作</span></span><br><span class="line"><span class="comment">             *Delete  允许对子节点Delete 操作(本节点也可以删除)</span></span><br><span class="line"><span class="comment">             *Admin   允许对本节点setAcl 操作</span></span><br><span class="line"><span class="comment">             *ALL = READ | WRITE | CREATE | DELETE | ADMIN;</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            List&lt;ACL&gt; aclList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            aclList.add(<span class="keyword">new</span> ACL(ZooDefs.Perms.ADMIN, ADMIN_IDS));</span><br><span class="line">            <span class="comment">//aclList.add(new ACL(ZooDefs.Perms.CREATE | ZooDefs.Perms.READ | ZooDefs.Perms.WRITE | ZooDefs.Perms.DELETE, USER_IDS));</span></span><br><span class="line">            aclList.add(<span class="keyword">new</span> ACL(ZooDefs.Perms.READ, ANYONE_ID_UNSAFE));</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 创建根节点</span></span><br><span class="line"><span class="comment">             * 不支持递归创建，即无法在父节点不存在的情况下创建一个子节点</span></span><br><span class="line"><span class="comment">             * 一个节点已经存在了，那么创建同名节点的时候，会抛出NodeExistException异常。如果是顺序节点,那么永远不会抛出NodeExistException异常</span></span><br><span class="line"><span class="comment">             * 临时节点不能有子节点</span></span><br><span class="line"><span class="comment">             *</span></span><br><span class="line"><span class="comment">             * CreateMode</span></span><br><span class="line"><span class="comment">             * PERSISTENT : 持久节点</span></span><br><span class="line"><span class="comment">             * PERSISTENT_SEQUENTIAL : 持久顺序节点</span></span><br><span class="line"><span class="comment">             * EPHEMERAL : 临时节点</span></span><br><span class="line"><span class="comment">             * EPHEMERAL_SEQUENTIAL : 临时顺序节点</span></span><br><span class="line"><span class="comment">             * CONTAINER : 容器节点</span></span><br><span class="line"><span class="comment">             * PERSISTENT_WITH_TTL : 持久TTL节点</span></span><br><span class="line"><span class="comment">             * PERSISTENT_SEQUENTIAL_WITH_TTL : 持久顺序TTL节点</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            zk.create(path, <span class="string">"宁川"</span>.getBytes(), aclList, CreateMode.PERSISTENT);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//设置Acl</span></span><br><span class="line">            zk.setACL(path, Collections.singletonList(<span class="keyword">new</span> ACL(ZooDefs.Perms.CREATE | ZooDefs.Perms.READ | ZooDefs.Perms.WRITE | ZooDefs.Perms.DELETE, USER_IDS)), -<span class="number">1</span>);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">//进行认证</span></span><br><span class="line">        zk.addAuthInfo(<span class="string">"digest"</span>, <span class="string">"user:user"</span>.getBytes());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//查看ACL权限</span></span><br><span class="line">        Stat stat = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> ((stat = zk.exists(path, <span class="keyword">true</span>)) != <span class="keyword">null</span>) {</span><br><span class="line">            System.out.println(<span class="string">"查看节点权限："</span> + zk.getACL(path, stat));</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取子节点数量</span></span><br><span class="line">        System.out.println(<span class="string">"获取子节点数量："</span> + zk.getAllChildrenNumber(path));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取所有的节点</span></span><br><span class="line">        System.out.println(<span class="string">"所有的节点:"</span> + zk.getChildren(<span class="string">"/"</span>, <span class="keyword">false</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取节点的值，并设置监听</span></span><br><span class="line">        System.out.println(<span class="string">"获取节点的值："</span> + <span class="keyword">new</span> String(zk.getData(path, (event -&gt; {</span><br><span class="line">            System.out.println(<span class="string">"getWatch："</span> + event.toString());</span><br><span class="line">        }), stat)));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//添加监听</span></span><br><span class="line">        zk.addWatch(path, (event) -&gt; {</span><br><span class="line">            System.out.println(<span class="string">"addWatch："</span> + event.toString());</span><br><span class="line">        }, AddWatchMode.PERSISTENT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置节点数据</span></span><br><span class="line">        <span class="comment">// 1 -自动维护</span></span><br><span class="line">        System.out.println(<span class="string">"设置节点数据："</span> + zk.setData(path, <span class="string">"123"</span>.getBytes(), -<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 异步创建一个 临时顺序节点，ACL为 ip:127.0.0.1:c</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        zk.create(<span class="string">"/node"</span>,</span><br><span class="line">                <span class="string">"123"</span>.getBytes(),</span><br><span class="line">                Collections.singletonList(<span class="keyword">new</span> ACL(ZooDefs.Perms.CREATE, <span class="keyword">new</span> Id(<span class="string">"ip"</span>, <span class="string">"127.0.0.1"</span>))),</span><br><span class="line">                CreateMode.EPHEMERAL_SEQUENTIAL,</span><br><span class="line">                <span class="comment">//new AsyncCallback.StringCallback()</span></span><br><span class="line">                (rc, path1, ctx, name) -&gt; {</span><br><span class="line">                    System.out.println(<span class="string">"rc:"</span> + rc);</span><br><span class="line">                    System.out.println(<span class="string">"path:"</span> + path1);</span><br><span class="line">                    System.out.println(<span class="string">"ctx:"</span> + ctx);</span><br><span class="line">                    System.out.println(<span class="string">"name:"</span> + name);</span><br><span class="line">                }, <span class="string">"传给服务端的内容,会在异步回调时传回来"</span>);</span><br><span class="line">        <span class="comment">//等待执行结果</span></span><br><span class="line">        Thread.sleep(<span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//删除节点</span></span><br><span class="line">        <span class="keyword">if</span> ((stat = zk.exists(path, <span class="keyword">true</span>)) != <span class="keyword">null</span>) {</span><br><span class="line">            List&lt;String&gt; subPaths = zk.getChildren(path, <span class="keyword">false</span>);</span><br><span class="line">            <span class="keyword">if</span> (subPaths.isEmpty()) {</span><br><span class="line">                zk.delete(path, stat.getVersion());</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="keyword">for</span> (String subPath : subPaths) {</span><br><span class="line">                    zk.delete(path + <span class="string">"/"</span> + subPath, -<span class="number">1</span>);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="3-CreateModel"><a href="#3-CreateModel" class="headerlink" title=".3. CreateModel"></a>.3. CreateModel</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> CreateMode {</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 持久节点</span></span><br><span class="line"><span class="comment">     * The znode will not be automatically deleted upon client's disconnect.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    PERSISTENT(<span class="number">0</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>),</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 持久顺序节点</span></span><br><span class="line"><span class="comment">     * The znode will not be automatically deleted upon client's disconnect,</span></span><br><span class="line"><span class="comment">     * and its name will be appended with a monotonically increasing number.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    PERSISTENT_SEQUENTIAL(<span class="number">2</span>, <span class="keyword">false</span>, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">false</span>),</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 临时节点</span></span><br><span class="line"><span class="comment">     * The znode will be deleted upon the client's disconnect.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    EPHEMERAL(<span class="number">1</span>, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>),</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 临时顺序节点</span></span><br><span class="line"><span class="comment">     * The znode will be deleted upon the client's disconnect, and its name</span></span><br><span class="line"><span class="comment">     * will be appended with a monotonically increasing number.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    EPHEMERAL_SEQUENTIAL(<span class="number">3</span>, <span class="keyword">true</span>, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">false</span>),</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 容器节点</span></span><br><span class="line"><span class="comment">     * The znode will be a container node. Container</span></span><br><span class="line"><span class="comment">     * nodes are special purpose nodes useful for recipes such as leader, lock,</span></span><br><span class="line"><span class="comment">     * etc. When the last child of a container is deleted, the container becomes</span></span><br><span class="line"><span class="comment">     * a candidate to be deleted by the server at some point in the future.</span></span><br><span class="line"><span class="comment">     * Given this property, you should be prepared to get</span></span><br><span class="line"><span class="comment">     * {<span class="doctag">@link</span> org.apache.zookeeper.KeeperException.NoNodeException}</span></span><br><span class="line"><span class="comment">     * when creating children inside of this container node.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    CONTAINER(<span class="number">4</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">true</span>, <span class="keyword">false</span>),</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 持久TTL节点</span></span><br><span class="line"><span class="comment">     * The znode will not be automatically deleted upon client's disconnect.</span></span><br><span class="line"><span class="comment">     * However if the znode has not been modified within the given TTL, it</span></span><br><span class="line"><span class="comment">     * will be deleted once it has no children.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    PERSISTENT_WITH_TTL(<span class="number">5</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">true</span>),</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 持久顺序TTL节点</span></span><br><span class="line"><span class="comment">     * The znode will not be automatically deleted upon client's disconnect,</span></span><br><span class="line"><span class="comment">     * and its name will be appended with a monotonically increasing number.</span></span><br><span class="line"><span class="comment">     * However if the znode has not been modified within the given TTL, it</span></span><br><span class="line"><span class="comment">     * will be deleted once it has no children.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    PERSISTENT_SEQUENTIAL_WITH_TTL(<span class="number">6</span>, <span class="keyword">false</span>, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">true</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="4-Zoodefs-Ids"><a href="#4-Zoodefs-Ids" class="headerlink" title=".4. Zoodefs.Ids"></a>.4. Zoodefs.Ids</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Ids</span> </span>{</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * world:anyone:adrwa</span></span><br><span class="line"><span class="comment">         * This Id represents anyone.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Id ANYONE_ID_UNSAFE = <span class="keyword">new</span> Id(<span class="string">"world"</span>, <span class="string">"anyone"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 认证后可操作</span></span><br><span class="line"><span class="comment">         * This Id is only usable to set ACLs. It will get substituted with the</span></span><br><span class="line"><span class="comment">         * Id's the client authenticated with.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Id AUTH_IDS = <span class="keyword">new</span> Id(<span class="string">"auth"</span>, <span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 完全开放的ACL，任何连接的客户端都可以操作该属性znode</span></span><br><span class="line"><span class="comment">         * This is a completely open ACL .</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="meta">@SuppressFBWarnings</span>(value = <span class="string">"MS_MUTABLE_COLLECTION"</span>, justification = <span class="string">"Cannot break API"</span>)</span><br><span class="line">        ArrayList&lt;ACL&gt; OPEN_ACL_UNSAFE = <span class="keyword">new</span> ArrayList&lt;ACL&gt;(Collections.singletonList(<span class="keyword">new</span> ACL(Perms.ALL, ANYONE_ID_UNSAFE)));</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 只有创建者才有ACL权限</span></span><br><span class="line"><span class="comment">         * This ACL gives the creators authentication id's all permissions.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="meta">@SuppressFBWarnings</span>(value = <span class="string">"MS_MUTABLE_COLLECTION"</span>, justification = <span class="string">"Cannot break API"</span>)</span><br><span class="line">        ArrayList&lt;ACL&gt; CREATOR_ALL_ACL = <span class="keyword">new</span> ArrayList&lt;ACL&gt;(Collections.singletonList(<span class="keyword">new</span> ACL(Perms.ALL, AUTH_IDS)));</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 只读ACL</span></span><br><span class="line"><span class="comment">         * This ACL gives the world the ability to read.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="meta">@SuppressFBWarnings</span>(value = <span class="string">"MS_MUTABLE_COLLECTION"</span>, justification = <span class="string">"Cannot break API"</span>)</span><br><span class="line">        ArrayList&lt;ACL&gt; READ_ACL_UNSAFE = <span class="keyword">new</span> ArrayList&lt;ACL&gt;(Collections.singletonList(<span class="keyword">new</span> ACL(Perms.READ, ANYONE_ID_UNSAFE)));</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="5-Watch"><a href="#5-Watch" class="headerlink" title=".5. Watch"></a>.5. Watch</h4><blockquote>
<p>一个Watch事件是一个一次性的触发器，当被设置了Watch的数据发生了改变的时候，则服务器将这个改变发送给设置了Watch的客户端，以便通知它们。</p>
<p>watch机制的特点：</p>
<ul>
<li>一次性触发 数据发生改变时，一个watcher event会被发送到client，但是client只会收到一次这样的信息。</li>
<li>watcher event异步发送 watcher 的通知事件从server发送到client是异步的，这就存在一个问题，不同的客户端和服务器之间通过socket进行通信，由于网络延迟或其他因素导致客户端在不通的时刻监听到事件，由于Zookeeper本身提供了ordering guarantee，即客户端监听事件后，才会感知它所监视znode发生了变化。</li>
<li>数据监视 Zookeeper有数据监视和子数据监视 getdata() and exists() 设置数据监视，getchildren()设置了子节点监视</li>
<li>注册watcher getData、exists、getChildren</li>
<li>触发watcher create、delete、setData</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">nodedatachanged # 节点数据改变</span><br><span class="line">nodecreate # 节点创建事件</span><br><span class="line">nodedelete #节点删除事件</span><br><span class="line">nodechildrenchanged # 子节点改变事件</span><br><span class="line"><span class="keyword">package</span> cn.sivan.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.AddWatchMode;</span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.CreateMode;</span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.ZooDefs;</span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.ZooKeeper;</span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.data.ACL;</span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.data.Id;</span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.data.Stat;</span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.server.auth.DigestAuthenticationProvider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WatchTest</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line"></span><br><span class="line">        String path = <span class="string">"/chodble2"</span>;</span><br><span class="line">        String pathValue = <span class="string">"root-value"</span>;</span><br><span class="line"></span><br><span class="line">        String subPath = path + <span class="string">"/node"</span>;</span><br><span class="line">        String subPathValue = <span class="string">"sbu-value"</span>;</span><br><span class="line"></span><br><span class="line">        String address = <span class="string">"127.0.0.1:2181"</span>;</span><br><span class="line">        <span class="keyword">int</span> timeout = <span class="number">3000</span>;</span><br><span class="line"></span><br><span class="line">        Connect zkConnect = <span class="keyword">new</span> Connect();</span><br><span class="line">        ZooKeeper zk = zkConnect.connect(address, timeout);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//判断节点是否存在</span></span><br><span class="line">        Stat stat = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> ((stat = zk.exists(path, <span class="keyword">true</span>)) == <span class="keyword">null</span>) {</span><br><span class="line"></span><br><span class="line">            <span class="comment">//创建节点</span></span><br><span class="line">            zk.create(path, pathValue.getBytes(), Collections.singletonList(<span class="keyword">new</span> ACL(ZooDefs.Perms.ALL, ZooDefs.Ids.ANYONE_ID_UNSAFE)), CreateMode.PERSISTENT);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">//进行认证</span></span><br><span class="line">        zk.addAuthInfo(<span class="string">"digest"</span>, <span class="string">"user:user"</span>.getBytes());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置节点监听</span></span><br><span class="line">        zk.addWatch(path, event -&gt; {</span><br><span class="line">            System.out.println(<span class="string">"addWatch-1："</span> + event);</span><br><span class="line">        }, AddWatchMode.PERSISTENT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取值</span></span><br><span class="line">        zk.getData(path, <span class="keyword">true</span>, <span class="keyword">new</span> Stat());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置值</span></span><br><span class="line">        zk.setData(path, <span class="string">"new-data"</span>.getBytes(), -<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//测试通知</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) {</span><br><span class="line">            <span class="comment">//重新设置值</span></span><br><span class="line">            zk.setData(path, (<span class="string">"new-data"</span> + i).getBytes(), -<span class="number">1</span>);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置权限</span></span><br><span class="line">        zk.setACL(path, Collections.singletonList(<span class="keyword">new</span> ACL(ZooDefs.Perms.ALL, <span class="keyword">new</span> Id(<span class="string">"digest"</span>, DigestAuthenticationProvider.generateDigest(<span class="string">"user:user"</span>)))), -<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建子节点</span></span><br><span class="line">        zk.create(subPath, subPathValue.getBytes(), Collections.singletonList(<span class="keyword">new</span> ACL(ZooDefs.Perms.ALL, ZooDefs.Ids.AUTH_IDS)), CreateMode.PERSISTENT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取子节点的值</span></span><br><span class="line">        zk.getData(subPath, <span class="keyword">true</span>, <span class="keyword">new</span> Stat());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置子节点的值</span></span><br><span class="line">        zk.setData(subPath, <span class="string">"sub-new-data"</span>.getBytes(), -<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置子节点权限</span></span><br><span class="line">        zk.setACL(subPath, Collections.singletonList(<span class="keyword">new</span> ACL(ZooDefs.Perms.ALL, <span class="keyword">new</span> Id(<span class="string">"digest"</span>, DigestAuthenticationProvider.generateDigest(<span class="string">"user:user"</span>)))), -<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取子节点的个数</span></span><br><span class="line">        zk.getAllChildrenNumber(path);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//列出所有的子节点</span></span><br><span class="line">        zk.getChildren(path, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//查看节点ACl</span></span><br><span class="line">        <span class="keyword">if</span> ((stat = zk.exists(path, <span class="keyword">true</span>)) != <span class="keyword">null</span>) {</span><br><span class="line">            System.out.println(<span class="string">"查看节点权限："</span> + zk.getACL(path, stat));</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">//删除子节点</span></span><br><span class="line">        zk.delete(subPath, -<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//删除节点</span></span><br><span class="line">        zk.delete(path, -<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Resource"><a href="#Resource" class="headerlink" title="Resource"></a>Resource</h3><ul>
<li><a href="http://www.uml.org.cn/zjjs/202006062.asp" target="_blank" rel="noopener">http://www.uml.org.cn/zjjs/202006062.asp</a></li>
<li><a href="https://www.cnblogs.com/sivanchan/p/13763030.html" target="_blank" rel="noopener">https://www.cnblogs.com/sivanchan/p/13763030.html</a></li>
</ul>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        Author:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://liudongdong1.github.io" rel="external nofollow noreferrer">liudongdong1</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        Link:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://liudongdong1.github.io/2021/07/19/yu-yan-kuang-jia/framework/distribution/zookeeper/">https://liudongdong1.github.io/2021/07/19/yu-yan-kuang-jia/framework/distribution/zookeeper/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        Reprint policy:
                    </i>
                </span>
                <span class="reprint-info">
                    All articles in this blog are used except for special statements
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    reprint polocy. If reproduced, please indicate source
                    <a href="https://liudongdong1.github.io" target="_blank">liudongdong1</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>Copied successfully, please follow the reprint policy of this article</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">more</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Framework/">
                                    <span class="chip bg-color">Framework</span>
                                </a>
                            
                                <a href="/tags/Distribution/">
                                    <span class="chip bg-color">Distribution</span>
                                </a>
                            
                                <a href="/tags/zookeeper/">
                                    <span class="chip bg-color">zookeeper</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="qq,qzone,wechat,weibo,douban" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;Previous</div>
            <div class="card">
                <a href="/2021/07/19/writing/latex/latex-gong-ju/">
                    <div class="card-image">
                        
                        <img src="https://cdn.stocksnap.io/img-thumbs/280h/EFELLTZDQ8.jpg" class="responsive-img" alt="LaTex 工具">
                        
                        <span class="card-title">LaTex 工具</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            1. 表格工具
https://www.tablesgenerator.com/


tablesgenerator，所见即所得，可以一键转换成LaTex、markdown、HTML等形式的表格，非常方便！你可以把你的实验结果记录在exce
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2021-07-19
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/writing/" class="post-category">
                                    writing
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/latex/">
                        <span class="chip bg-color">latex</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                Next&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2021/07/19/yu-yan-kuang-jia/framework/middleware/kafka/kafka-command/">
                    <div class="card-image">
                        
                        <img src="https://cdn.stocksnap.io/img-thumbs/280h/pink-blossoms_MSZ3ZOAWI1.jpg" class="responsive-img" alt="kafka_command">
                        
                        <span class="card-title">kafka_command</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
https://blog.gmem.cc/apache-kafka-study-note
https://blog.gmem.cc/elasticsearch-study-note
https://blog.gmem.cc/apache-
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-07-19
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E8%AF%AD%E8%A8%80%E6%A1%86%E6%9E%B6/" class="post-category">
                                    语言框架
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Framework/">
                        <span class="chip bg-color">Framework</span>
                    </a>
                    
                    <a href="/tags/middleware/">
                        <span class="chip bg-color">middleware</span>
                    </a>
                    
                    <a href="/tags/kafka/">
                        <span class="chip bg-color">kafka</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;TOC</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <!-- <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="463294659"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            <span id="year">2019</span>
            <a href="https://liudongdong1.github.io" target="_blank">liudongdong</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">1206.4k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/liudongdong1/" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:3463264078@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>














    <a href="https://blog.csdn.net/liudongdong19/" class="tooltipped" target="_blank" data-tooltip="关注我的CSDN: https://blog.csdn.net/liudongdong19/" data-position="top" data-delay="50">
        <i class="fab fa-csdn">C</i>
    </a>





</div>
    </div>
</footer>

<div class="progress-bar"></div>
 -->

    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;Search</span>
            <input type="search" id="searchInput" name="s" placeholder="Please enter a search keyword"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/search.xml", 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script type="text/javascript" src="/js/CFS.Snow.min.js"></script>
    <!-- 点击爆灯效果 -->
    <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" ></canvas> 
    <script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script> 
    <script type="text/javascript" src="/js/fireworks.js"></script>
    <!--动态线条背景-->
    <script type="text/javascript"
        color="122 103 238" opacity='0.7' zIndex="-2" count="200" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js">
    </script>
    <!-- 天气 -->
    <!-- weather -->
    <!-- weather -->
    <script type="text/javascript">
         WIDGET = {FID: 'knAMQaFanP'}
    </script>
    <script type="text/javascript" src="https://apip.weatherdt.com/float/static/js/r.js?v=1111"></script>
    <script type="text/javascript" src="https://apip.weatherdt.com/float/static/js/r.js?v=1111"></script>
    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    

    
    
    <script type="text/javascript" size="150" alpha='0.6'
        zIndex="-1" src="/libs/background/ribbon-refresh.min.js" async="async"></script>
    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    
    <!-- {% include '_custom/custom.swig' %} -->

</body>

</html>
