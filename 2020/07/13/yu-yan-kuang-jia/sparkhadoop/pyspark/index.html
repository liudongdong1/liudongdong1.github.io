<!DOCTYPE HTML>
<html lang="en">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="PySpark, AIOT,Space&amp;Temporal Sequence Analysis,SpringBoot,liudongdong1,cloud">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>PySpark | DaybyDay</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="DaybyDay" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">DaybyDay</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>Index</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>Tags</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>Categories</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>Archives</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">

      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>About</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
    </a>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="/about">
          
          <i class="fas fa-user-circle" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>about</span>
        </a>
      </li>
      
      <li>
        <a href="/resume">
          
          <i class="fa fa-user-secret" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>resume</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>Friends</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/gallery" class="waves-effect waves-light">
      
      <i class="fas fa-camera" style="zoom: 0.6;"></i>
      
      <span>Galleries</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="Search" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">DaybyDay</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			Index
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			Tags
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			Categories
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			Archives
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-user-circle"></i>
			
			About
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>

                  <a href="/about " style="margin-left:75px">
				  
				   <i class="fa fas fa-user-circle" style="position: absolute;left:50px" ></i>
			      
		          <span>about</span>
                  </a>
                </li>
              
                <li>

                  <a href="/resume " style="margin-left:75px">
				  
				   <i class="fa fa fa-user-secret" style="position: absolute;left:50px" ></i>
			      
		          <span>resume</span>
                  </a>
                </li>
              
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			Friends
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/gallery" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-camera"></i>
			
			Galleries
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/liudongdong1" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/liudongdong1" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('https://gitee.com/github-25970295/blogImage/raw/master/img/4.jpeg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">PySpark</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    .toc-fixed .toc-link::before{
        position: fixed!important;/*当toc的位置改为fixed时，.toc-link::before也要改为fixed*/
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/spark/">
                                <span class="chip bg-color">spark</span>
                            </a>
                        
                            <a href="/tags/stream/">
                                <span class="chip bg-color">stream</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/Framewrok/" class="post-category">
                                Framewrok
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>Publish Date:&nbsp;&nbsp;
                    2020-07-13
                </div>
                

                <!-- 
                    <i class="fa fa-pencil"></i> Author: liudongdong1
                  -->

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>Update Date:&nbsp;&nbsp;
                    2022-02-26
                </div>
                

                <!-- 
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>Word Count:&nbsp;&nbsp;
                    4.9k
                </div>
                 -->

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>Read Times:&nbsp;&nbsp;
                    25 Min
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>Read Count:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <blockquote>
<p>Apart from real-time and batch processing, Apache Spark supports interactive queries and iterative algorithms. Using PySpark, you can work with <strong>RDDs</strong> in Python programming language also. It is because of a library called <strong>Py4j</strong> that they are able to achieve this.</p>
</blockquote>
<blockquote>
<ul>
<li><strong>Resilient Distributed Dataset (RDD)</strong>: RDD is an immutable (read-only), fundamental <code>collection of elements or items</code> that can be operated on many devices at the same time (parallel processing). Each dataset in an RDD can be divided into logical portions, which are then executed on different nodes of a cluster.</li>
<li><strong>Directed Acyclic Graph (DAG)</strong>: DAG is the <code>scheduling layer of the Apache Spark architecture</code> that implements <strong>stage-oriented scheduling</strong>. Compared to MapReduce that creates a graph in two stages, Map and Reduce, Apache Spark can create DAGs that contain many stages.</li>
</ul>
</blockquote>
<p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/image-20201119211239377.png" alt=""></p>
<h2 id="0-Architecture"><a href="#0-Architecture" class="headerlink" title="0. Architecture"></a>0. Architecture</h2><p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/image-20201119211608027.png" alt="Basic"></p>
<p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/image-20201119211639658.png" alt="standalone"></p>
<p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/image-20201119211701746.png" alt="Yarn"></p>
<p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/image-20201119211800146.png" alt="component"></p>
<h2 id="1-core-class"><a href="#1-core-class" class="headerlink" title="1. core class"></a>1. core class</h2><p><a href="https://spark.apache.org/docs/latest/api/python/pyspark.html#pyspark.SparkContext" target="_blank" rel="noopener"><code>pyspark.SparkContext</code></a>Main entry point for Spark functionality.</p>
<p><a href="https://spark.apache.org/docs/latest/api/python/pyspark.html#pyspark.RDD" target="_blank" rel="noopener"><code>pyspark.RDD</code></a>A Resilient Distributed Dataset (RDD), the basic abstraction in Spark.</p>
<p><a href="https://spark.apache.org/docs/latest/api/python/pyspark.streaming.html#pyspark.streaming.StreamingContext" target="_blank" rel="noopener"><code>pyspark.streaming.StreamingContext</code></a>Main entry point for Spark Streaming functionality.</p>
<p><a href="https://spark.apache.org/docs/latest/api/python/pyspark.streaming.html#pyspark.streaming.DStream" target="_blank" rel="noopener"><code>pyspark.streaming.DStream</code></a>A Discretized Stream (DStream), the basic abstraction in Spark Streaming.</p>
<p><a href="https://spark.apache.org/docs/latest/api/python/pyspark.sql.html#pyspark.sql.SparkSession" target="_blank" rel="noopener"><code>pyspark.sql.SparkSession</code></a>Main entry point for DataFrame and SQL functionality.</p>
<p><a href="https://spark.apache.org/docs/latest/api/python/pyspark.sql.html#pyspark.sql.DataFrame" target="_blank" rel="noopener"><code>pyspark.sql.DataFrame</code></a>A distributed collection of data grouped into named columns.</p>
<p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/image-20210225232741569.png" alt=""></p>
<pre class=" language-shell"><code class="language-shell">#连接spark cluster
from pyspark import SparkContext, SparkConf
conf = SparkConf().setAppName("sparkAppExample")
sc = SparkContext(conf=conf)

#使用session
from pyspark.sql import SparkSession
spark = SparkSession.builder \
          .master("local") \
          .appName("Word Count") \
          .config("spark.some.config.option", "some-value") \
          .getOrCreate()
# 如果使用 hive table 则加上 .enableHiveSupport()
#spark.sparkContext._conf.getAll()  # check the config</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> pyspark <span class="token keyword">import</span> SparkContext<span class="token punctuation">,</span> SparkConf
<span class="token keyword">from</span> pyspark<span class="token punctuation">.</span>sql <span class="token keyword">import</span> SparkSession


<span class="token keyword">def</span> <span class="token function">create_sc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    sc_conf <span class="token operator">=</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sc_conf<span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">'spark://master:7077'</span><span class="token punctuation">)</span>
    sc_conf<span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">'my-app'</span><span class="token punctuation">)</span>
    sc_conf<span class="token punctuation">.</span>set<span class="token punctuation">(</span><span class="token string">'spark.executor.memory'</span><span class="token punctuation">,</span> <span class="token string">'2g'</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">#executor memory是每个节点上占用的内存。每一个节点可使用内存</span>
    sc_conf<span class="token punctuation">.</span>set<span class="token punctuation">(</span><span class="token string">"spark.executor.cores"</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#spark.executor.cores：顾名思义这个参数是用来指定executor的cpu内核个数，分配更多的内核意味着executor并发能力越强，能够同时执行更多的task</span>
    sc_conf<span class="token punctuation">.</span>set<span class="token punctuation">(</span><span class="token string">'spark.cores.max'</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">#spark.cores.max：为一个application分配的最大cpu核心数，如果没有设置这个值默认为spark.deploy.defaultCores</span>
    sc_conf<span class="token punctuation">.</span>set<span class="token punctuation">(</span><span class="token string">'spark.logConf'</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">#当SparkContext启动时，将有效的SparkConf记录为INFO。</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>sc_conf<span class="token punctuation">.</span>getAll<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    sc <span class="token operator">=</span> SparkContext<span class="token punctuation">(</span>conf<span class="token operator">=</span>sc_conf<span class="token punctuation">)</span>

    <span class="token keyword">return</span> sc

<span class="token keyword">from</span> pyspark<span class="token punctuation">.</span>conf <span class="token keyword">import</span> SparkConf
conf<span class="token operator">=</span>SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span>
        conf<span class="token punctuation">.</span>set<span class="token punctuation">(</span><span class="token string">'spark.sql.execute.arrow.enabled'</span><span class="token punctuation">,</span><span class="token string">'true'</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">"APP_MODE"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'prod'</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">"""
            集群环境
            """</span>
            url <span class="token operator">=</span> <span class="token string">'spark://master:7077'</span>
            conf<span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">'prod-practice-info'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>set<span class="token punctuation">(</span><span class="token string">"spark.driver.maxResultSize"</span><span class="token punctuation">,</span> <span class="token string">"12g"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>set<span class="token punctuation">(</span><span class="token string">"spark.executor.memory"</span><span class="token punctuation">,</span> <span class="token string">'4g'</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">"""
            本地环境
            """</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"本地环境"</span><span class="token punctuation">)</span>
            url <span class="token operator">=</span> <span class="token string">'local[*]'</span>
            conf<span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">'prod-practice-info'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
        spark <span class="token operator">=</span> SparkSession<span class="token punctuation">.</span>builder<span class="token punctuation">.</span> \
            config<span class="token punctuation">(</span>conf<span class="token operator">=</span>conf<span class="token punctuation">)</span><span class="token punctuation">.</span>\
            getOrCreate<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<h3 id="1-0-Submit-Model"><a href="#1-0-Submit-Model" class="headerlink" title="1.0. Submit Model"></a>1.0. Submit Model</h3><ul>
<li><code>--class</code>: The entry point for your application (e.g. <code>org.apache.spark.examples.SparkPi</code>)</li>
<li><code>--master</code>: The <a href="https://spark.apache.org/docs/latest/submitting-applications.html#master-urls" target="_blank" rel="noopener">master URL</a> for the cluster (e.g. <code>spark://23.195.26.187:7077</code>)</li>
<li><code>--deploy-mode</code>: Whether to deploy your driver on the worker nodes (<code>cluster</code>) or locally as an external client (<code>client</code>) (default: <code>client</code>) <strong>†</strong></li>
<li><code>--conf</code>: Arbitrary Spark configuration property in key=value format. For values that contain spaces wrap “key=value” in quotes (as shown). Multiple configurations should be passed as separate arguments. (e.g. <code>--conf &lt;key&gt;=&lt;value&gt; --conf &lt;key2&gt;=&lt;value2&gt;</code>)</li>
<li><code>application-jar</code>: Path to a bundled jar including your application and all dependencies. The URL must be globally visible inside of your cluster, for instance, an <code>hdfs://</code> path or a <code>file://</code> path that is present on all nodes.</li>
<li><code>application-arguments</code>: Arguments passed to the main method of your main class.</li>
</ul>
<pre class=" language-shell"><code class="language-shell"># Run application locally on 8 cores
./bin/spark-submit \
  --class org.apache.spark.examples.SparkPi \
  --master local[8] \
  /path/to/examples.jar \
  100

# Run on a Spark standalone cluster in client deploy mode
./bin/spark-submit \
  --class org.apache.spark.examples.SparkPi \
  --master spark://207.184.161.138:7077 \
  --executor-memory 20G \
  --total-executor-cores 100 \
  /path/to/examples.jar \
  1000

# Run on a Spark standalone cluster in cluster deploy mode with supervise
./bin/spark-submit \
  --class org.apache.spark.examples.SparkPi \
  --master spark://207.184.161.138:7077 \
  --deploy-mode cluster \
  --supervise \
  --executor-memory 20G \
  --total-executor-cores 100 \
  /path/to/examples.jar \
  1000

# Run on a YARN cluster
export HADOOP_CONF_DIR=XXX
./bin/spark-submit \
  --class org.apache.spark.examples.SparkPi \
  --master yarn \
  --deploy-mode cluster \  # can be client for client mode
  --executor-memory 20G \
  --num-executors 50 \
  /path/to/examples.jar \
  1000

# Run a Python application on a Spark standalone cluster
./bin/spark-submit \
  --master spark://207.184.161.138:7077 \
  examples/src/main/python/pi.py \
  1000

# Run on a Mesos cluster in cluster deploy mode with supervise
./bin/spark-submit \
  --class org.apache.spark.examples.SparkPi \
  --master mesos://207.184.161.138:7077 \
  --deploy-mode cluster \
  --supervise \
  --executor-memory 20G \
  --total-executor-cores 100 \
  http://path/to/examples.jar \
  1000

# Run on a Kubernetes cluster in cluster deploy mode
./bin/spark-submit \
  --class org.apache.spark.examples.SparkPi \
  --master k8s://xx.yy.zz.ww:443 \
  --deploy-mode cluster \
  --executor-memory 20G \
  --num-executors 50 \
  http://path/to/examples.jar \
  1000</code></pre>
<h3 id="1-1-RDD"><a href="#1-1-RDD" class="headerlink" title="1.1. RDD"></a>1.1. RDD</h3><blockquote>
<p>支持两种类型的操作： 转化操作（transformation） 和行动操作（action）。转化操作会由一个RDD 生成一个新的RDD。行动操作是对的RDD 内容进行操作，它们会把最终求得的结果返回到驱动器程序，或者写入外部存储系统中。由于行动操作需要生成实际的输出，它们会强制执行那些求值必须用到的RDD 的转化操作。RDD的转化操作与行动操作不同，是惰性求值的，也就是在被调用行动操作之前Spark 不会开始计算。同样创建操作也是一样，数据并没有被立刻读取到内存中，只是记录了读取操作需要的相关信息。我理解为这与tensorflow的网络构建类似，我们之前编写的代码只是记录了整个操作过程的计算流程图，只有当计算操作被激活时，数据才会沿着之前定义的计算图进行计算.</p>
</blockquote>
<h4 id="1-1-1-RDD-creation"><a href="#1-1-1-RDD-creation" class="headerlink" title="1.1.1. RDD creation"></a>1.1.1. RDD creation</h4><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#---  Creating a RDD from a file</span>
<span class="token keyword">import</span> urllib
f <span class="token operator">=</span> urllib<span class="token punctuation">.</span>urlretrieve <span class="token punctuation">(</span><span class="token string">"http://kdd.ics.uci.edu/databases/kddcup99/kddcup.data_10_percent.gz"</span><span class="token punctuation">,</span> <span class="token string">"kddcup.data_10_percent.gz"</span><span class="token punctuation">)</span>
data_file <span class="token operator">=</span> <span class="token string">"./kddcup.data_10_percent.gz"</span>
raw_data <span class="token operator">=</span> sc<span class="token punctuation">.</span>textFile<span class="token punctuation">(</span>data_file<span class="token punctuation">)</span><span class="token punctuation">.</span>cache<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#---  Creating and RDD using parallelize</span>
a <span class="token operator">=</span> range<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
data <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#---  makeRDD 操作</span>
val rdd02 <span class="token operator">=</span> sc<span class="token punctuation">.</span>makeRDD<span class="token punctuation">(</span>Array<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#----  create key-value data</span>
key_value_data <span class="token operator">=</span> csv_data<span class="token punctuation">.</span>map<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">41</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># x[41] contains the network interaction tag</span>
durations_by_key <span class="token operator">=</span> key_value_duration<span class="token punctuation">.</span>reduceByKey<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> x <span class="token operator">+</span> y<span class="token punctuation">)</span>
counts_by_key <span class="token operator">=</span> key_value_data<span class="token punctuation">.</span>countByKey<span class="token punctuation">(</span><span class="token punctuation">)</span>

head_rows <span class="token operator">=</span> raw_data<span class="token punctuation">.</span>take<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 查看前面5个</span>
count<span class="token operator">=</span>raw_data<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 查看个数</span>
<span class="token comment" spellcheck="true">#-------   sample</span>
raw_data_sample <span class="token operator">=</span> raw_data<span class="token punctuation">.</span>sample<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">1234</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># # whether the sampling is done with replacement, sample size as a fraction, random seed;</span>
raw_data_sample <span class="token operator">=</span> raw_data<span class="token punctuation">.</span>takeSample<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token number">400000</span><span class="token punctuation">,</span> <span class="token number">1234</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#grab a sample of raw data from our RDD into local memory, number samples</span>

<span class="token comment" spellcheck="true">#----     set operation</span>
attack_raw_data <span class="token operator">=</span> raw_data<span class="token punctuation">.</span>subtract<span class="token punctuation">(</span>normal_raw_data<span class="token punctuation">)</span>

csv_data <span class="token operator">=</span> raw_data<span class="token punctuation">.</span>map<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

normal_raw_data <span class="token operator">=</span> raw_data<span class="token punctuation">.</span>filter<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token string">'normal.'</span> <span class="token keyword">in</span> x<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">#count how many normal</span>

<span class="token keyword">def</span> <span class="token function">parse_interaction</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">:</span>
    elems <span class="token operator">=</span> line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span>
    tag <span class="token operator">=</span> elems<span class="token punctuation">[</span><span class="token number">41</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>tag<span class="token punctuation">,</span> elems<span class="token punctuation">)</span>
key_csv_data <span class="token operator">=</span> raw_data<span class="token punctuation">.</span>map<span class="token punctuation">(</span>parse_interaction<span class="token punctuation">)</span>

all_raw_data <span class="token operator">=</span> raw_data<span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#get all the elements in the RDD into memory for us to work with them.</span></code></pre>
<h4 id="1-1-2-TransformOp"><a href="#1-1-2-TransformOp" class="headerlink" title="1.1.2.  TransformOp"></a>1.1.2.  TransformOp</h4><blockquote>
<p>皆产生新的 RDD,且直保存运算逻辑，依赖原始 rdd</p>
</blockquote>
<h5 id="1-map-amp-mapValues"><a href="#1-map-amp-mapValues" class="headerlink" title="1. map &amp; mapValues"></a>1. map &amp; mapValues</h5><p><code>对于每个元素</code>都应用这个func</p>
<ul>
<li>入参：<ul>
<li>func表示需要应用到每个元素的方法</li>
<li>preservesPartitioning是否保持当前分区方式，默认重新分区</li>
</ul>
</li>
<li>返回：<ul>
<li><code>返回的结果是一个RDD</code></li>
</ul>
</li>
</ul>
<pre class=" language-python"><code class="language-python">rdd <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
sorted<span class="token punctuation">(</span>rdd<span class="token punctuation">.</span>map<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#[('a', 1), ('b', 1), ('c', 1)]</span></code></pre>
<p><code>对键值对中每个value都应用这个func</code>，并保持key不变</p>
<ul>
<li>入参：<ul>
<li>func表示需要应用到每个元素值上的方法</li>
</ul>
</li>
<li>返回：<ul>
<li>返回的结果是一个RDD</li>
</ul>
</li>
</ul>
<pre class=" language-python"><code class="language-python">x <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"apple"</span><span class="token punctuation">,</span> <span class="token string">"banana"</span><span class="token punctuation">,</span> <span class="token string">"lemon"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"grapes"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">return</span> len<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
x<span class="token punctuation">.</span>mapValues<span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># [('a', 3), ('b', 1)]</span></code></pre>
<h5 id="2-flatmap"><a href="#2-flatmap" class="headerlink" title="2. flatmap"></a>2. flatmap</h5><p>遍历全部元素，将传入方法应用到每个元素上，并将<code>最后结果展平（压成一个List）</code></p>
<ul>
<li>入参：<ul>
<li>func表示需要应用到每个元素的方法</li>
<li>preservesPartitioning是否保持当前分区方式，默认重新分区</li>
</ul>
</li>
<li>返回：<ul>
<li>返回的结果是一个RDD</li>
</ul>
</li>
</ul>
<pre class=" language-python"><code class="language-python">rdd <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
sorted<span class="token punctuation">(</span>rdd<span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#[1, 1, 1, 2, 2, 3]</span>
sorted<span class="token punctuation">(</span>rdd<span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#[(2, 2), (2, 2), (3, 3), (3, 3), (4, 4), (4, 4)]</span></code></pre>
<p>遍历某个元素的元素值，将传入方法应用到每个元素值上，并将最后结果展平（压成一个List）</p>
<ul>
<li>入参：<ul>
<li>func表示需要应用到每个元素值的方法</li>
</ul>
</li>
<li>返回：<ul>
<li>返回的结果是一个RDD</li>
</ul>
</li>
</ul>
<pre class=" language-python"><code class="language-python">x <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"x"</span><span class="token punctuation">,</span> <span class="token string">"y"</span><span class="token punctuation">,</span> <span class="token string">"z"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"p"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
x<span class="token punctuation">.</span>flatMapValues<span class="token punctuation">(</span><span class="token keyword">lambda</span> val<span class="token punctuation">:</span> val<span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># [('a', 'x'), ('a', 'y'), ('a', 'z'), ('b', 'p'), ('b', 'r')]</span></code></pre>
<h5 id="3-filter"><a href="#3-filter" class="headerlink" title="3. filter"></a>3. filter</h5><p>遍历全部元素，筛选符合传入方法的元素</p>
<ul>
<li>入参：<ul>
<li>func表示需要应用到每个元素的筛选方法</li>
</ul>
</li>
<li>返回：<ul>
<li>返回的结果是一个RDD</li>
</ul>
</li>
</ul>
<pre class=" language-python"><code class="language-python">rdd <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
rdd<span class="token punctuation">.</span>filter<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>rdd<span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># [2, 4]</span>
kvRDD1<span class="token punctuation">.</span>fiter<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token number">5</span><span class="token punctuation">)</span> 根据 key过滤
kvRDD1<span class="token punctuation">.</span>filter<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span>x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token number">5</span><span class="token punctuation">)</span> 根据值过滤</code></pre>
<h5 id="4-distinct"><a href="#4-distinct" class="headerlink" title="4. distinct"></a>4. distinct</h5><p>遍历全部元素，<code>并返回包含的不同元素的总数</code></p>
<ul>
<li>入参：<ul>
<li>numPartitions表示需要将此操作分割成多少个分区</li>
</ul>
</li>
<li>返回：<ul>
<li>返回的结果是一个Int</li>
</ul>
</li>
</ul>
<pre class=" language-python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>rddInt<span class="token punctuation">.</span>distinct<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<h5 id="5-cartesian"><a href="#5-cartesian" class="headerlink" title="5. cartesian"></a>5. cartesian</h5><p>返回自己与传入rdd的笛卡尔积</p>
<ul>
<li>入参：<ul>
<li>rdd表示一个rdd对象，可以存储不同数据类型 RDD</li>
</ul>
</li>
<li>返回：<ul>
<li>返回的结果是一个RDD</li>
</ul>
</li>
</ul>
<pre class=" language-python"><code class="language-python">num_rdd <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
str_rdd <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
result <span class="token operator">=</span> num_rdd<span class="token punctuation">.</span>cartesian<span class="token punctuation">(</span>str_rdd<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># [(1, 'a'), (1, 'y'), (2, 'a'), (2, 'y')]</span></code></pre>
<h4 id="1-1-3-ActionOp"><a href="#1-1-3-ActionOp" class="headerlink" title="1.1.3. ActionOp"></a>1.1.3. ActionOp</h4><h5 id="1-collect"><a href="#1-collect" class="headerlink" title="1. collect"></a>1. collect</h5><p>将数据以List取回本地<br><a href="https://spark.apache.org/docs/latest/api/python/pyspark.html" target="_blank" rel="noopener">官网</a>提示，建议只在任务结束时在调用collect方法.</p>
<ul>
<li>返回：<ul>
<li>返回的结果是一个List</li>
</ul>
</li>
</ul>
<h5 id="2-count-amp-amp-take-num"><a href="#2-count-amp-amp-take-num" class="headerlink" title="2. count&amp;&amp;take(num)"></a>2. count&amp;&amp;take(num)</h5><h5 id="3-countByValue-amp-countByKey"><a href="#3-countByValue-amp-countByKey" class="headerlink" title="3.  countByValue&amp; countByKey"></a>3.  countByValue&amp; countByKey</h5><p>返回<code>每个key对应的元素数量</code></p>
<ul>
<li>返回：<ul>
<li>返回的结果是一个Dict</li>
</ul>
</li>
</ul>
<pre class=" language-python"><code class="language-python">rdd <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>rdd<span class="token punctuation">.</span>countByKey<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># defaultdict(&lt;class 'int'>, {'a': 2, 'b': 1})</span></code></pre>
<p>返回<code>每个value出现的次数</code></p>
<ul>
<li>返回：<ul>
<li>返回的结果是一个Dict</li>
</ul>
</li>
</ul>
<pre class=" language-python"><code class="language-python">rdd2 <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>rdd2<span class="token punctuation">.</span>countByValue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># defaultdict(&lt;class 'int'>, {1: 2, 2: 3})</span></code></pre>
<h5 id="4-reduce"><a href="#4-reduce" class="headerlink" title="4. reduce"></a>4. reduce</h5><p>对于每个元素值都应用这个func</p>
<ul>
<li>入参：<ul>
<li>func表示需要应用到每个元素的方法</li>
</ul>
</li>
<li>返回：<ul>
<li>返回的结果是一个Python obj, 与元素值得数据类型一致</li>
</ul>
</li>
</ul>
<pre class=" language-python"><code class="language-python">x <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
y <span class="token operator">=</span> x<span class="token punctuation">.</span>reduce<span class="token punctuation">(</span><span class="token keyword">lambda</span> a<span class="token punctuation">,</span> b <span class="token punctuation">:</span> a <span class="token operator">+</span> b <span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># [1, 2, 3]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 6</span></code></pre>
<h5 id="5-fold"><a href="#5-fold" class="headerlink" title="5. fold"></a>5. fold</h5><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 和reduce() 一样， 但是需要提供初始值</span>
<span class="token operator">>></span><span class="token operator">></span> rdd <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> rdd<span class="token punctuation">.</span>fold<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> x <span class="token operator">+</span> y<span class="token punctuation">)</span>
<span class="token number">21</span></code></pre>
<h5 id="6-aggregate"><a href="#6-aggregate" class="headerlink" title="6. aggregate"></a>6. aggregate</h5><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 和reduce() 相似， 但是通常返回不同类型的函数</span>
<span class="token operator">>></span><span class="token operator">></span> seqOp <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> y<span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> combOp <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> y<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> y<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>aggregate<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> seqOp<span class="token punctuation">,</span> combOp<span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span></code></pre>
<h5 id="7-foreach"><a href="#7-foreach" class="headerlink" title="7. foreach"></a>7. foreach</h5><p>用于遍历RDD中的元素,将函数func应用于每一个元素。</p>
<ul>
<li>入参：<ul>
<li>func表示需要应用到每个元素的方法, 但这个方法不会在客户端执行</li>
</ul>
</li>
<li>返回：<ul>
<li>返回的结果是一个RDD</li>
</ul>
</li>
</ul>
<pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>f<span class="token punctuation">)</span></code></pre>
<h3 id="1-2-SQL-amp-DataFrames"><a href="#1-2-SQL-amp-DataFrames" class="headerlink" title="1.2. SQL&amp;DataFrames"></a>1.2. SQL&amp;DataFrames</h3><blockquote>
<ul>
<li><strong>Use of Input Optimization Engine</strong>: DataFrames <code>make use of the input optimization engines</code>, e.g., <strong>Catalyst Optimizer</strong>, to process data efficiently. We can use the same engine for all Python, Java, Scala, and R DataFrame APIs.</li>
<li><strong>Handling of Structured Data</strong>: DataFrames provide a<code>schematic view of data</code>. Here, the data has some meaning to it when it is being stored.</li>
<li><strong>Custom Memory Management</strong>: In <code>RDDs, the data is stored in memory</code>, whereas <code>DataFrames store data off-heap</code> (outside the main Java Heap space, but still inside RAM), which in turn reduces the garbage collection overload.</li>
<li><strong>Flexibility</strong>: <code>DataFrames, like RDDs</code>, can support various formats of data, such as CSV, <a href="https://intellipaat.com/blog/apache-cassandra-a-brief-intro/" target="_blank" rel="noopener">Cassandra</a>, etc.</li>
<li><strong>Scalability</strong>: <code>DataFrames can be integrated with various other [Big Data tools](https://intellipaat.com/blog/big-data-analytics-tools-performance-testing/),</code> and they allow processing megabytes to petabytes of data at once.</li>
</ul>
</blockquote>
<ul>
<li>pyspark.sql.SQLContext： DataFrame和SQL方法的主入口</li>
<li>pyspark.sql.DataFrame： 将分布式数据集分组到指定列名的数据框中</li>
<li>pyspark.sql.Column ：DataFrame中的列<code>Row(name="Alice", age=11).asDict() == {'name': 'Alice', 'age': 11}</code></li>
<li>pyspark.sql.Row： DataFrame数据的行</li>
<li>pyspark.sql.HiveContext： 访问Hive数据的主入口</li>
<li>pyspark.sql.GroupedData： 由DataFrame.groupBy()创建的聚合方法集</li>
<li>pyspark.sql.DataFrameNaFunctions： 处理丢失数据(空数据)的方法</li>
<li>pyspark.sql.DataFrameStatFunctions： 统计功能的方法<br> -pyspark.sql.functions DataFrame：可用的内置函数</li>
<li>pyspark.sql.types： 可用的数据类型列表</li>
<li>pyspark.sql.Window： 用于处理窗口函数</li>
</ul>
<h5 id="1-creation"><a href="#1-creation" class="headerlink" title="1. creation"></a>1. creation</h5><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#--- create from csv</span>
fifa_df <span class="token operator">=</span> spark<span class="token punctuation">.</span>read<span class="token punctuation">.</span>csv<span class="token punctuation">(</span><span class="token string">"path-of-file/fifa_players.csv"</span><span class="token punctuation">,</span> inferSchema <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span> header <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#--- create from json</span>
val jsondata<span class="token operator">=</span>spark<span class="token punctuation">.</span>read<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token string">"file.json"</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#--- create from exitRDD</span>
df<span class="token operator">=</span>spark<span class="token punctuation">.</span>createDataFrame<span class="token punctuation">(</span>rdd<span class="token punctuation">)</span><span class="token punctuation">.</span>toDF<span class="token punctuation">(</span><span class="token string">"key"</span><span class="token punctuation">,</span><span class="token string">"cube"</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#--- create from dict</span>
df <span class="token operator">=</span> spark<span class="token punctuation">.</span>createDataFrame<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'Alice'</span><span class="token punctuation">,</span><span class="token string">'age'</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'Polo'</span><span class="token punctuation">,</span><span class="token string">'age'</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
<span class="token comment" spellcheck="true">#--- create from schema</span>
schema <span class="token operator">=</span> StructType<span class="token punctuation">(</span><span class="token punctuation">[</span>
    StructField<span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span> LongType<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   
    StructField<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> StringType<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    StructField<span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> LongType<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    StructField<span class="token punctuation">(</span><span class="token string">"eyeColor"</span><span class="token punctuation">,</span> StringType<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
df <span class="token operator">=</span> spark<span class="token punctuation">.</span>createDataFrame<span class="token punctuation">(</span>csvRDD<span class="token punctuation">,</span> schema<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#--- create from pandas</span>
colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'white'</span><span class="token punctuation">,</span><span class="token string">'green'</span><span class="token punctuation">,</span><span class="token string">'yellow'</span><span class="token punctuation">,</span><span class="token string">'red'</span><span class="token punctuation">,</span><span class="token string">'brown'</span><span class="token punctuation">,</span><span class="token string">'pink'</span><span class="token punctuation">]</span>
color_df<span class="token operator">=</span>pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>colors<span class="token punctuation">,</span>columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'color'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
color_df<span class="token punctuation">[</span><span class="token string">'length'</span><span class="token punctuation">]</span><span class="token operator">=</span>color_df<span class="token punctuation">[</span><span class="token string">'color'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>apply<span class="token punctuation">(</span>len<span class="token punctuation">)</span>

color_df<span class="token operator">=</span>spark<span class="token punctuation">.</span>createDataFrame<span class="token punctuation">(</span>color_df<span class="token punctuation">)</span>
color_df<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<h5 id="2-show"><a href="#2-show" class="headerlink" title="2. show"></a>2. show</h5><pre class=" language-python"><code class="language-python">df<span class="token punctuation">.</span>printSchema<span class="token punctuation">(</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>columns<span class="token punctuation">(</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token string">'column name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># look at the summary of particular column</span>
df<span class="token punctuation">.</span>dtypes <span class="token comment" spellcheck="true">#将所有列名称及其数据类型作为列表返回。</span>
<span class="token comment" spellcheck="true"># 查找每列出现次数占总的30%以上频繁项目</span>
df<span class="token punctuation">.</span>stat<span class="token punctuation">.</span>freqItems<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">,</span> <span class="token string">"gender"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># ----  缺失值</span>
<span class="token comment" spellcheck="true"># 计算每列空值数目</span>
<span class="token keyword">for</span> col <span class="token keyword">in</span> df<span class="token punctuation">.</span>columns<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>col<span class="token punctuation">,</span> <span class="token string">"\t"</span><span class="token punctuation">,</span> <span class="token string">"with null values: "</span><span class="token punctuation">,</span> 
          df<span class="token punctuation">.</span>filter<span class="token punctuation">(</span>df<span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>isNull<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<h5 id="3-column-select"><a href="#3-column-select" class="headerlink" title="3. column select"></a>3. column select</h5><pre class=" language-python"><code class="language-python">df<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">'column name'</span><span class="token punctuation">,</span><span class="token string">'name2'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
color_df<span class="token punctuation">.</span>filter<span class="token punctuation">(</span>color_df<span class="token punctuation">[</span><span class="token string">'length'</span><span class="token punctuation">]</span><span class="token operator">>=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># filter方法</span>
<span class="token comment" spellcheck="true"># 返回具有新指定列名的DataFrame</span>
df<span class="token punctuation">.</span>toDF<span class="token punctuation">(</span><span class="token string">'f1'</span><span class="token punctuation">,</span> <span class="token string">'f2'</span><span class="token punctuation">)</span>

first_row <span class="token operator">=</span> df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># Row(address=Row(city='Nanjing', country='China'), age=12, name='Li')</span>

<span class="token comment" spellcheck="true"># 读取行内某一列的属性值</span>
first_row<span class="token punctuation">[</span><span class="token string">'age'</span><span class="token punctuation">]</span>           <span class="token comment" spellcheck="true"># 12</span>
first_row<span class="token punctuation">.</span>age              <span class="token comment" spellcheck="true"># 12</span>
getattr<span class="token punctuation">(</span>first_row<span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 12</span>
first_row<span class="token punctuation">.</span>address
<span class="token comment" spellcheck="true"># Row(city='Nanjing', country='China')</span>

<span class="token comment" spellcheck="true"># -------------- column -----------------------</span>

first_col <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
first_col <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'adress'</span><span class="token punctuation">]</span>
<span class="token comment" spellcheck="true"># Column&lt;b'address'></span>

<span class="token comment" spellcheck="true"># copy column[s]</span>
address_copy <span class="token operator">=</span> first_col<span class="token punctuation">.</span>alias<span class="token punctuation">(</span><span class="token string">'address_copy'</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># rename column / create new column</span>
df<span class="token punctuation">.</span>withColumnRenamed<span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">,</span> <span class="token string">'birth_age'</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>withColumn<span class="token punctuation">(</span><span class="token string">'age_copy'</span><span class="token punctuation">,</span> df<span class="token punctuation">[</span><span class="token string">'age'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
+----------------+---+----+--------+
|         address|age|name|age_copy|
+----------------+---+----+--------+
|[Nanjing, China]| 12|  Li|      12|
+----------------+---+----+--------+
only showing top 1 row
"""</span>

df<span class="token punctuation">.</span>withColumn<span class="token punctuation">(</span><span class="token string">'age_over_18'</span><span class="token punctuation">,</span>df<span class="token punctuation">[</span><span class="token string">'age'</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
+----------------+---+----+-----------+
|         address|age|name|age_over_18|
+----------------+---+----+-----------+
|[Nanjing, China]| 12|  Li|      false|
+----------------+---+----+-----------+
only showing top 1 row
"""</span></code></pre>
<h5 id="4-filter"><a href="#4-filter" class="headerlink" title="4.  filter"></a>4.  filter</h5><pre class=" language-python"><code class="language-python">df<span class="token punctuation">.</span>filter<span class="token punctuation">(</span>df<span class="token punctuation">.</span>MathchID<span class="token operator">==</span><span class="token string">'1111'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<h5 id="5-sort"><a href="#5-sort" class="headerlink" title="5. sort"></a>5. sort</h5><pre class=" language-python"><code class="language-python">df<span class="token punctuation">.</span>orderBy<span class="token punctuation">(</span>df<span class="token punctuation">.</span>column<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># default ascending</span>
color_df<span class="token punctuation">.</span>sort<span class="token punctuation">(</span><span class="token string">'column'</span><span class="token punctuation">,</span>ascending<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<h5 id="6-group"><a href="#6-group" class="headerlink" title="6. group"></a>6. group</h5><pre class=" language-python"><code class="language-python">df<span class="token punctuation">.</span>goupby<span class="token punctuation">(</span><span class="token string">'columnname'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p><img src="https://gitee.com/github-25970295/blogpictureV2/raw/master/image-20201119164459904.png" alt=""></p>
<h5 id="7-SQL"><a href="#7-SQL" class="headerlink" title="7. SQL"></a>7. SQL</h5><pre class=" language-python"><code class="language-python">df<span class="token punctuation">.</span>registerTempTable<span class="token punctuation">(</span><span class="token string">'tablename'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 注册表</span>
sqlContext<span class="token punctuation">.</span>sql<span class="token punctuation">(</span><span class="token string">'select * from tablename'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#  方式二：</span>
df<span class="token punctuation">.</span>createOrReplaceTempView<span class="token punctuation">(</span>tablename<span class="token punctuation">)</span>
result<span class="token operator">=</span>spark<span class="token punctuation">.</span>sql<span class="token punctuation">(</span><span class="token string">"sql sentences"</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#方式三 sql function</span>
<span class="token keyword">from</span> pyspark<span class="token punctuation">.</span>sql <span class="token keyword">import</span> functions <span class="token keyword">as</span> F
<span class="token keyword">import</span> datetime <span class="token keyword">as</span> dt

<span class="token comment" spellcheck="true"># 装饰器使用</span>
@F<span class="token punctuation">.</span>udf<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">calculate_birth_year</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">:</span>
    this_year <span class="token operator">=</span> dt<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>today<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>year
    birth_year <span class="token operator">=</span> this_year <span class="token operator">-</span> age
    <span class="token keyword">return</span> birth_year 

calculated_df <span class="token operator">=</span> df<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">,</span> calculate_birth_year<span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>alias<span class="token punctuation">(</span><span class="token string">'birth_year'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
calculated_df <span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
+------------------+---+-------+----------+
|           address|age|   name|birth_year|
+------------------+---+-------+----------+
|  [Nanjing, China]| 12|     Li|      2008|
|[Los Angeles, USA]| 14|Richard|      2006|
+------------------+---+-------+----------+
only showing top 2 rows
"""</span></code></pre>
<h5 id="8-drop"><a href="#8-drop" class="headerlink" title="8. drop"></a>8. drop</h5><pre class=" language-python"><code class="language-python">df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token string">'column name'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#：cols - 要删除的列的字符串名称，要删除的列或要删除的列的字符串名称的列表。</span>
<span class="token comment" spellcheck="true">#新增一列</span>
df<span class="token punctuation">.</span>withColumn<span class="token punctuation">(</span>colName<span class="token punctuation">,</span> col<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#通过为原数据框添加一个新列或替换已存在的同名列而返回一个新数据框。colName —— 是一个字符串, 为新列的名字。必须是已存在的列的名字</span>
<span class="token comment" spellcheck="true">#col —— 为这个新列的 Column 表达式。必须是含有列的表达式。如果不是它会报错 AssertionError: col should be Column</span>

<span class="token comment" spellcheck="true"># 重新命名聚合后结果的列名(需要修改多个列名就跟多个：withColumnRenamed)</span>
<span class="token comment" spellcheck="true"># 聚合之后不修改列名则会显示：count(member_name)</span>
df_res<span class="token punctuation">.</span>agg<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'member_name'</span><span class="token punctuation">:</span> <span class="token string">'count'</span><span class="token punctuation">,</span> <span class="token string">'income'</span><span class="token punctuation">:</span> <span class="token string">'sum'</span><span class="token punctuation">,</span> <span class="token string">'num'</span><span class="token punctuation">:</span> <span class="token string">'sum'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>withColumnRenamed<span class="token punctuation">(</span><span class="token string">"count(member_name)"</span><span class="token punctuation">,</span> <span class="token string">"member_num"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#修改数据类型</span>
df <span class="token operator">=</span> df<span class="token punctuation">.</span>withColumn<span class="token punctuation">(</span><span class="token string">"height"</span><span class="token punctuation">,</span> df<span class="token punctuation">[</span><span class="token string">"height"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>cast<span class="token punctuation">(</span>IntegerType<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<h5 id="9-collect"><a href="#9-collect" class="headerlink" title="9. collect"></a>9. collect</h5><p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/image-20201119220742676.png" alt=""></p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>data1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"words"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

df<span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#Row列表形式返回所有记录。</span>
<span class="token comment" spellcheck="true"># 在只有一列的情况下可以用 [0] 来获取值</span>
<span class="token comment" spellcheck="true"># 获取一列的所有值，或者多列的所有值</span>
<span class="token comment" spellcheck="true"># collect()函数将分布式的dataframe转成local类型的 list-row格式</span>
rows<span class="token operator">=</span> df<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">'col_1'</span><span class="token punctuation">,</span> <span class="token string">'col_2'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span>
value <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> row<span class="token punctuation">.</span>col_1<span class="token punctuation">,</span> row<span class="token punctuation">.</span>col_2 <span class="token punctuation">]</span> <span class="token keyword">for</span> row <span class="token keyword">in</span> rows <span class="token punctuation">]</span>
<span class="token comment" spellcheck="true">#获取第一行的多个值，返回普通python变量</span>
<span class="token comment" spellcheck="true"># first() 返回的是 Row 类型，可以看做是dict类型，用 row.col_name 来获取值</span>
row <span class="token operator">=</span> df<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">'col_1'</span><span class="token punctuation">,</span> <span class="token string">'col_2'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
col_1_value <span class="token operator">=</span> row<span class="token punctuation">.</span>col_1
col_2_value <span class="token operator">=</span> row<span class="token punctuation">.</span>col_2</code></pre>
<h5 id="10-RDD-amp-DF-amp-Pandas"><a href="#10-RDD-amp-DF-amp-Pandas" class="headerlink" title="10. RDD &amp;DF&amp;Pandas"></a>10. RDD &amp;DF&amp;Pandas</h5><pre class=" language-python"><code class="language-python">rdd_df <span class="token operator">=</span> df<span class="token punctuation">.</span>rdd      <span class="token comment" spellcheck="true"># DF转RDD</span>
df <span class="token operator">=</span> rdd_df<span class="token punctuation">.</span>toDF<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># RDD转DF</span>
pandas_df <span class="token operator">=</span> spark_df<span class="token punctuation">.</span>toPandas<span class="token punctuation">(</span><span class="token punctuation">)</span>    
spark_df <span class="token operator">=</span> sqlContext<span class="token punctuation">.</span>createDataFrame<span class="token punctuation">(</span>pandas_df<span class="token punctuation">)</span></code></pre>
<h5 id="11-UDF"><a href="#11-UDF" class="headerlink" title="11. UDF"></a>11. UDF</h5><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#udf(f=None, returnType=StringType)</span>
<span class="token comment" spellcheck="true">#Parameters：</span>
<span class="token comment" spellcheck="true">#  f – python函数（如果用作独立函数）</span>
<span class="token comment" spellcheck="true">#  returnType – 用户定义函数的返回类型。</span>
<span class="token keyword">from</span> pyspark<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>functions <span class="token keyword">import</span> udf
<span class="token keyword">from</span> pyspark<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>types <span class="token keyword">import</span> StructType<span class="token punctuation">,</span> StructField<span class="token punctuation">,</span> IntegerType<span class="token punctuation">,</span> FloatType<span class="token punctuation">,</span> StringType<span class="token punctuation">,</span> ArrayType
stopwords <span class="token operator">=</span> <span class="token punctuation">[</span>k<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> k <span class="token keyword">in</span> open<span class="token punctuation">(</span><span class="token string">'./data/stopwords.txt'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">if</span> k<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">''</span><span class="token punctuation">]</span>
<span class="token keyword">def</span> <span class="token function">clearTxt</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> line <span class="token operator">!=</span> <span class="token string">''</span><span class="token punctuation">:</span>
        line <span class="token operator">=</span> line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true">#去除文本中的英文和数字</span>
        line <span class="token operator">=</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">"[a-zA-Z0-9]"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">,</span>line<span class="token punctuation">)</span>

        <span class="token comment" spellcheck="true">#去除文本中的中文符号和英文符号</span>
        line <span class="token operator">=</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">"[\s+\.\!\/_,$%^*(+\"\'；：“”．]+|[+——！，。？?、~@#￥%……&amp;*（）]+"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> line<span class="token punctuation">)</span>
        <span class="token keyword">return</span> line
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">'Empyt Line'</span>
cutWords_list<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">def</span> <span class="token function">cutwordshandle</span><span class="token punctuation">(</span>jobinfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    jobinfo<span class="token operator">=</span>clearTxt<span class="token punctuation">(</span>jobinfo<span class="token punctuation">)</span>
    cutWords <span class="token operator">=</span> <span class="token punctuation">[</span>k <span class="token keyword">for</span> k <span class="token keyword">in</span> jieba<span class="token punctuation">.</span>cut<span class="token punctuation">(</span>jobinfo<span class="token punctuation">,</span>cut_all<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token keyword">if</span> k <span class="token operator">not</span> <span class="token keyword">in</span> stopwords<span class="token punctuation">]</span>
    <span class="token comment" spellcheck="true">#print(len(cutWords_list))</span>
    cutWords_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>cutWords<span class="token punctuation">)</span>
    <span class="token keyword">return</span> cutWords

cutwords <span class="token operator">=</span> udf<span class="token punctuation">(</span><span class="token keyword">lambda</span> z<span class="token punctuation">:</span> cutwordshandle<span class="token punctuation">(</span>z<span class="token punctuation">)</span><span class="token punctuation">,</span> ArrayType<span class="token punctuation">(</span>StringType<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
sqlcontext<span class="token punctuation">.</span>udf<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token string">"label"</span><span class="token punctuation">,</span> cutwords<span class="token punctuation">)</span>
df3 <span class="token operator">=</span> df2<span class="token punctuation">.</span>withColumn<span class="token punctuation">(</span> <span class="token string">'words'</span><span class="token punctuation">,</span>cutwords<span class="token punctuation">(</span><span class="token string">'待遇'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> pyspark<span class="token punctuation">.</span>sql <span class="token keyword">import</span> SQLContext
sqlContext <span class="token operator">=</span> SQLContext<span class="token punctuation">(</span>sc<span class="token punctuation">)</span>
<span class="token keyword">from</span> pyspark<span class="token punctuation">.</span>sql <span class="token keyword">import</span> Row
csv_data <span class="token operator">=</span> raw_data<span class="token punctuation">.</span>map<span class="token punctuation">(</span><span class="token keyword">lambda</span> l<span class="token punctuation">:</span> l<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
row_data <span class="token operator">=</span> csv_data<span class="token punctuation">.</span>map<span class="token punctuation">(</span><span class="token keyword">lambda</span> p<span class="token punctuation">:</span> Row<span class="token punctuation">(</span>
    duration<span class="token operator">=</span>int<span class="token punctuation">(</span>p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
    protocol_type<span class="token operator">=</span>p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    service<span class="token operator">=</span>p<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    flag<span class="token operator">=</span>p<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    src_bytes<span class="token operator">=</span>int<span class="token punctuation">(</span>p<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    dst_bytes<span class="token operator">=</span>int<span class="token punctuation">(</span>p<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">)</span>

interactions_df <span class="token operator">=</span> sqlContext<span class="token punctuation">.</span>createDataFrame<span class="token punctuation">(</span>row_data<span class="token punctuation">)</span>
interactions_df<span class="token punctuation">.</span>registerTempTable<span class="token punctuation">(</span><span class="token string">"interactions"</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># Select tcp network interactions with more than 1 second duration and no transfer from destination</span>
tcp_interactions <span class="token operator">=</span> sqlContext<span class="token punctuation">.</span>sql<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""
    SELECT duration, dst_bytes FROM interactions WHERE protocol_type = 'tcp' AND duration > 1000 AND dst_bytes = 0
"""</span><span class="token punctuation">)</span>
tcp_interactions<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># Output duration together with dst_bytes</span>
tcp_interactions_out <span class="token operator">=</span> tcp_interactions<span class="token punctuation">.</span>map<span class="token punctuation">(</span><span class="token keyword">lambda</span> p<span class="token punctuation">:</span> <span class="token string">"Duration: {}, Dest. bytes: {}"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>p<span class="token punctuation">.</span>duration<span class="token punctuation">,</span> p<span class="token punctuation">.</span>dst_bytes<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> ti_out <span class="token keyword">in</span> tcp_interactions_out<span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">print</span> ti_out
interactions_df<span class="token punctuation">.</span>printSchema<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># printdata schema</span>
<span class="token comment" spellcheck="true">#---   dataframe query</span>
interactions_df<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">"protocol_type"</span><span class="token punctuation">,</span> <span class="token string">"duration"</span><span class="token punctuation">,</span> <span class="token string">"dst_bytes"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>filter<span class="token punctuation">(</span>interactions_df<span class="token punctuation">.</span>duration<span class="token operator">></span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">.</span>filter<span class="token punctuation">(</span>interactions_df<span class="token punctuation">.</span>dst_bytes<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>groupBy<span class="token punctuation">(</span><span class="token string">"protocol_type"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<h5 id="11-1-Pandas-UDF"><a href="#11-1-Pandas-UDF" class="headerlink" title="11.1. Pandas UDF"></a>11.1. Pandas UDF</h5><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> pyspark<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>functions <span class="token keyword">import</span> udf
<span class="token comment" spellcheck="true"># 使用 udf 定义一个 row-at-a-time 的 udf</span>
@udf<span class="token punctuation">(</span><span class="token string">'double'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 输入/输出都是单个 double 类型的值</span>
<span class="token keyword">def</span> <span class="token function">plus_one</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> v <span class="token operator">+</span> <span class="token number">1</span>
df<span class="token punctuation">.</span>withColumn<span class="token punctuation">(</span><span class="token string">'v2'</span><span class="token punctuation">,</span> plus_one<span class="token punctuation">(</span>df<span class="token punctuation">.</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">from</span> pyspark<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>functions <span class="token keyword">import</span> pandas_udf<span class="token punctuation">,</span> PandasUDFType
<span class="token comment" spellcheck="true"># 使用 pandas_udf 定义一个 Pandas UDF</span>
@pandas_udf<span class="token punctuation">(</span><span class="token string">'double'</span><span class="token punctuation">,</span> PandasUDFType<span class="token punctuation">.</span>SCALAR<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 输入/输出都是 double 类型的 pandas.Series</span>
<span class="token keyword">def</span> <span class="token function">pandas_plus_one</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> v <span class="token operator">+</span> <span class="token number">1</span>
df<span class="token punctuation">.</span>withColumn<span class="token punctuation">(</span><span class="token string">'v2'</span><span class="token punctuation">,</span> pandas_plus_one<span class="token punctuation">(</span>df<span class="token punctuation">.</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#最小二乘法举例</span>
<span class="token keyword">import</span> statsmodels<span class="token punctuation">.</span>api <span class="token keyword">as</span> sm
<span class="token comment" spellcheck="true"># df has four columns: id, y, x1, x2</span>
group_column <span class="token operator">=</span> <span class="token string">'id'</span>
y_column <span class="token operator">=</span> <span class="token string">'y'</span>
x_columns <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'x1'</span><span class="token punctuation">,</span> <span class="token string">'x2'</span><span class="token punctuation">]</span>
schema <span class="token operator">=</span> df<span class="token punctuation">.</span>select<span class="token punctuation">(</span>group_column<span class="token punctuation">,</span> <span class="token operator">*</span>x_columns<span class="token punctuation">)</span><span class="token punctuation">.</span>schema
@pandas_udf<span class="token punctuation">(</span>schema<span class="token punctuation">,</span> PandasUDFType<span class="token punctuation">.</span>GROUPED_MAP<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># Input/output are both a pandas.DataFrame</span>
<span class="token keyword">def</span> <span class="token function">ols</span><span class="token punctuation">(</span>pdf<span class="token punctuation">)</span><span class="token punctuation">:</span>
    group_key <span class="token operator">=</span> pdf<span class="token punctuation">[</span>group_column<span class="token punctuation">]</span><span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    y <span class="token operator">=</span> pdf<span class="token punctuation">[</span>y_column<span class="token punctuation">]</span>
    X <span class="token operator">=</span> pdf<span class="token punctuation">[</span>x_columns<span class="token punctuation">]</span>
      X <span class="token operator">=</span> sm<span class="token punctuation">.</span>add_constant<span class="token punctuation">(</span>X<span class="token punctuation">)</span>
    model <span class="token operator">=</span> sm<span class="token punctuation">.</span>OLS<span class="token punctuation">(</span>y<span class="token punctuation">,</span> X<span class="token punctuation">)</span><span class="token punctuation">.</span>fit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span>group_key<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">[</span>model<span class="token punctuation">.</span>params<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span>   x_columns<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token punctuation">[</span>group_column<span class="token punctuation">]</span> <span class="token operator">+</span> x_columns<span class="token punctuation">)</span>
beta <span class="token operator">=</span> df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span>group_column<span class="token punctuation">)</span><span class="token punctuation">.</span>apply<span class="token punctuation">(</span>ols<span class="token punctuation">)</span></code></pre>
<h5 id="12-schema"><a href="#12-schema" class="headerlink" title="12. schema"></a>12. schema</h5><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> pyspark<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>types <span class="token keyword">import</span> StructField<span class="token punctuation">,</span> MapType<span class="token punctuation">,</span> StringType<span class="token punctuation">,</span> IntegerType<span class="token punctuation">,</span> StructType
<span class="token comment" spellcheck="true"># 常用的还包括 DateType 等</span>

people_schema<span class="token operator">=</span> StructType<span class="token punctuation">(</span><span class="token punctuation">[</span>
    StructField<span class="token punctuation">(</span><span class="token string">'address'</span><span class="token punctuation">,</span> MapType<span class="token punctuation">(</span>StringType<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> StringType<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    StructField<span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">,</span> LongType<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    StructField<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> StringType<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

df <span class="token operator">=</span> spark<span class="token punctuation">.</span>read<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token string">'people.json'</span><span class="token punctuation">,</span> schema<span class="token operator">=</span>people_schema<span class="token punctuation">)</span>

df<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
+--------------------+---+----+
|             address|age|name|
+--------------------+---+----+
|[country -> China...| 12|  Li|
+--------------------+---+----+
only showing top 1 row
"""</span>

df<span class="token punctuation">.</span>dtypes
<span class="token comment" spellcheck="true"># [('address', 'map&lt;string,string>'), ('age', 'bigint'), ('name', 'string')]</span></code></pre>
<h3 id="1-3-RDD-amp-DataFrame-amp-Dataset"><a href="#1-3-RDD-amp-DataFrame-amp-Dataset" class="headerlink" title="1.3.  RDD&amp;DataFrame&amp;Dataset"></a>1.3.  RDD&amp;DataFrame&amp;Dataset</h3><table>
<thead>
<tr>
<th><strong>Basis of Difference</strong></th>
<th><strong>Spark RDD</strong></th>
<th><strong>Spark DataFrame</strong></th>
<th><strong>Spark Dataset</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>What is it?</strong></td>
<td>A low-level API</td>
<td>A high-level abstraction</td>
<td>A <code>combination</code> of both RDDs and DataFrames</td>
</tr>
<tr>
<td><strong>Input Optimization Engine</strong></td>
<td><code>Cannot make use of input optimization engines</code></td>
<td>Uses input optimization engines to generate logical queries</td>
<td>Uses Catalyst Optimizer for input optimization, as DataFrames do</td>
</tr>
<tr>
<td><strong>Data Representation</strong></td>
<td><code>Distributed across multiple nodes of a cluster</code></td>
<td><code>A collection of rows and named columns</code></td>
<td>An extension of DataFrames, providing the functionalities of both RDDs and DataFrames</td>
</tr>
<tr>
<td><strong>Benefit</strong></td>
<td>A simple API</td>
<td>Gives a schema for the distributed data</td>
<td><code>Improves memory usage</code></td>
</tr>
<tr>
<td><strong>Immutability and Interoperability</strong></td>
<td>Tracks data lineage information to recover the lost data</td>
<td>Once transformed into a DataFrame, not possible to get the domain object</td>
<td>Can regenerate RDDs</td>
</tr>
<tr>
<td><strong>Performance Limitation</strong></td>
<td>Java Serialization and Garbage Collection overheads</td>
<td>Offers huge performance improvement over RDDs</td>
<td>Operations are performed on serialized data to improve performance</td>
</tr>
</tbody></table>
<h3 id="1-4-Summary-statistics"><a href="#1-4-Summary-statistics" class="headerlink" title="1.4. Summary statistics"></a>1.4. Summary statistics</h3><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> pyspark<span class="token punctuation">.</span>mllib<span class="token punctuation">.</span>stat <span class="token keyword">import</span> Statistics 
<span class="token keyword">from</span> math <span class="token keyword">import</span> sqrt 

<span class="token comment" spellcheck="true"># Compute column summary statistics.</span>
summary <span class="token operator">=</span> Statistics<span class="token punctuation">.</span>colStats<span class="token punctuation">(</span>vector_data<span class="token punctuation">)</span>

<span class="token keyword">print</span> <span class="token string">"Duration Statistics:"</span>
<span class="token keyword">print</span> <span class="token string">" Mean: {}"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>round<span class="token punctuation">(</span>summary<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token string">" St. deviation: {}"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>round<span class="token punctuation">(</span>sqrt<span class="token punctuation">(</span>summary<span class="token punctuation">.</span>variance<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token string">" Max value: {}"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>round<span class="token punctuation">(</span>summary<span class="token punctuation">.</span>max<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token string">" Min value: {}"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>round<span class="token punctuation">(</span>summary<span class="token punctuation">.</span>min<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token string">" Total value count: {}"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>summary<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token string">" Number of non-zero values: {}"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>summary<span class="token punctuation">.</span>numNonzeros<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre>
<h3 id="1-4-ML"><a href="#1-4-ML" class="headerlink" title="1. 4. ML"></a>1. 4. ML</h3><ul>
<li><strong>mllib.classification</strong>: The spark.mllib package offers support for various methods to perform binary classification, regression analysis, and multiclass classification. Some of the most used algorithms in classifications are Naive Bayes, decision trees, etc.</li>
<li><strong>mllib.clustering</strong>: In clustering, you can perform the grouping of subsets of entities on the basis of some similarities in the elements or entities.</li>
<li><strong>mllib.linalg</strong>: This algorithm offers MLlib utilities to support linear algebra.</li>
<li><strong>mllib.recommendation</strong>: This algorithm is used for recommender systems to fill in the missing entries in any dataset.</li>
<li><strong>spark.mllib</strong>: This supports collaborative filtering, where Spark uses ALS (Alternating Least Squares) to predict the missing entries in the sets of descriptions of users and products.</li>
</ul>
<p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/image-20201119215234237.png" alt=""></p>
<ul>
<li><input disabled="" type="checkbox"> <a href="https://spark.apache.org/docs/latest/ml-features" target="_blank" rel="noopener">https://spark.apache.org/docs/latest/ml-features</a>  后期学习使用这里面的api，但是ML基本算法必须熟练掌握；</li>
<li><input disabled="" type="checkbox"> 后面遇到比较好的代码，案例可以多多积累；</li>
</ul>
<pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> urllib
f <span class="token operator">=</span> urllib<span class="token punctuation">.</span>urlretrieve <span class="token punctuation">(</span><span class="token string">"http://kdd.ics.uci.edu/databases/kddcup99/kddcup.data.gz"</span><span class="token punctuation">,</span> <span class="token string">"kddcup.data.gz"</span><span class="token punctuation">)</span>
data_file <span class="token operator">=</span> <span class="token string">"./kddcup.data.gz"</span>
raw_data <span class="token operator">=</span> sc<span class="token punctuation">.</span>textFile<span class="token punctuation">(</span>data_file<span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token string">"Train data size is {}"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>raw_data<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ft <span class="token operator">=</span> urllib<span class="token punctuation">.</span>urlretrieve<span class="token punctuation">(</span><span class="token string">"http://kdd.ics.uci.edu/databases/kddcup99/corrected.gz"</span><span class="token punctuation">,</span> <span class="token string">"corrected.gz"</span><span class="token punctuation">)</span>
test_data_file <span class="token operator">=</span> <span class="token string">"./corrected.gz"</span>
test_raw_data <span class="token operator">=</span> sc<span class="token punctuation">.</span>textFile<span class="token punctuation">(</span>test_data_file<span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token string">"Test data size is {}"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>test_raw_data<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">from</span> pyspark<span class="token punctuation">.</span>mllib<span class="token punctuation">.</span>regression <span class="token keyword">import</span> LabeledPoint
<span class="token keyword">from</span> numpy <span class="token keyword">import</span> array
csv_data <span class="token operator">=</span> raw_data<span class="token punctuation">.</span>map<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
test_csv_data <span class="token operator">=</span> test_raw_data<span class="token punctuation">.</span>map<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
protocols <span class="token operator">=</span> csv_data<span class="token punctuation">.</span>map<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>distinct<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span>
services <span class="token operator">=</span> csv_data<span class="token punctuation">.</span>map<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>distinct<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span>
flags <span class="token operator">=</span> csv_data<span class="token punctuation">.</span>map<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>distinct<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">create_labeled_point</span><span class="token punctuation">(</span>line_split<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># leave_out = [41]</span>
    clean_line_split <span class="token operator">=</span> line_split<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">41</span><span class="token punctuation">]</span>
    <span class="token comment" spellcheck="true"># convert protocol to numeric categorical variable</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span> 
        clean_line_split<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> protocols<span class="token punctuation">.</span>index<span class="token punctuation">(</span>clean_line_split<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        clean_line_split<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> len<span class="token punctuation">(</span>protocols<span class="token punctuation">)</span>  
    <span class="token comment" spellcheck="true"># convert service to numeric categorical variable</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        clean_line_split<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> services<span class="token punctuation">.</span>index<span class="token punctuation">(</span>clean_line_split<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        clean_line_split<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> len<span class="token punctuation">(</span>services<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># convert flag to numeric categorical variable</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        clean_line_split<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> flags<span class="token punctuation">.</span>index<span class="token punctuation">(</span>clean_line_split<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        clean_line_split<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> len<span class="token punctuation">(</span>flags<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># convert label to binary label</span>
    attack <span class="token operator">=</span> <span class="token number">1.0</span>
    <span class="token keyword">if</span> line_split<span class="token punctuation">[</span><span class="token number">41</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'normal.'</span><span class="token punctuation">:</span>
        attack <span class="token operator">=</span> <span class="token number">0.0</span>
    <span class="token keyword">return</span> LabeledPoint<span class="token punctuation">(</span>attack<span class="token punctuation">,</span> array<span class="token punctuation">(</span><span class="token punctuation">[</span>float<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
training_data <span class="token operator">=</span> csv_data<span class="token punctuation">.</span>map<span class="token punctuation">(</span>create_labeled_point<span class="token punctuation">)</span>
test_data <span class="token operator">=</span> test_csv_data<span class="token punctuation">.</span>map<span class="token punctuation">(</span>create_labeled_point<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#--- training the classifier</span>
<span class="token keyword">from</span> pyspark<span class="token punctuation">.</span>mllib<span class="token punctuation">.</span>tree <span class="token keyword">import</span> DecisionTree<span class="token punctuation">,</span> DecisionTreeModel
<span class="token keyword">from</span> time <span class="token keyword">import</span> time

<span class="token comment" spellcheck="true"># Build the model</span>
t0 <span class="token operator">=</span> time<span class="token punctuation">(</span><span class="token punctuation">)</span>
tree_model <span class="token operator">=</span> DecisionTree<span class="token punctuation">.</span>trainClassifier<span class="token punctuation">(</span>training_data<span class="token punctuation">,</span> numClasses<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> 
                                          categoricalFeaturesInfo<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">:</span> len<span class="token punctuation">(</span>protocols<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span> len<span class="token punctuation">(</span>services<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">:</span> len<span class="token punctuation">(</span>flags<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> impurity<span class="token operator">=</span><span class="token string">'gini'</span><span class="token punctuation">,</span> maxDepth<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> maxBins<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>
tt <span class="token operator">=</span> time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> t0
<span class="token keyword">print</span> <span class="token string">"Classifier trained in {} seconds"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>round<span class="token punctuation">(</span>tt<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#--- predict</span>
predictions <span class="token operator">=</span> tree_model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_data<span class="token punctuation">.</span>map<span class="token punctuation">(</span><span class="token keyword">lambda</span> p<span class="token punctuation">:</span> p<span class="token punctuation">.</span>features<span class="token punctuation">)</span><span class="token punctuation">)</span>
labels_and_preds <span class="token operator">=</span> test_data<span class="token punctuation">.</span>map<span class="token punctuation">(</span><span class="token keyword">lambda</span> p<span class="token punctuation">:</span> p<span class="token punctuation">.</span>label<span class="token punctuation">)</span><span class="token punctuation">.</span>zip<span class="token punctuation">(</span>predictions<span class="token punctuation">)</span>

t0 <span class="token operator">=</span> time<span class="token punctuation">(</span><span class="token punctuation">)</span>
test_accuracy <span class="token operator">=</span> labels_and_preds<span class="token punctuation">.</span>filter<span class="token punctuation">(</span><span class="token keyword">lambda</span> <span class="token punctuation">(</span>v<span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">:</span> v <span class="token operator">==</span> p<span class="token punctuation">)</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> float<span class="token punctuation">(</span>test_data<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
tt <span class="token operator">=</span> time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> t0
<span class="token keyword">print</span> <span class="token string">"Prediction made in {} seconds. Test accuracy is {}"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>round<span class="token punctuation">(</span>tt<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> round<span class="token punctuation">(</span>test_accuracy<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span> <span class="token string">"Learned classification tree model:"</span>
<span class="token keyword">print</span> tree_model<span class="token punctuation">.</span>toDebugString<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p><img src="https://intellipaat.com/mediaFiles/2019/03/spark-and-rdd-cheat-sheet-1.png" alt=""></p>
<p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/image-20201119212743127.png" alt=""></p>
<ul>
<li><a href="https://github.com/jadianes/spark-py-notebooks" target="_blank" rel="noopener">https://github.com/jadianes/spark-py-notebooks</a></li>
<li><a href="https://www.cnblogs.com/sight-tech/p/12990579.html" target="_blank" rel="noopener">https://www.cnblogs.com/sight-tech/p/12990579.html</a></li>
<li><a href="https://spark.apache.org/docs/latest/api/python/pyspark.sql.html#pyspark.sql.DataFrame" target="_blank" rel="noopener">https://spark.apache.org/docs/latest/api/python/pyspark.sql.html#pyspark.sql.DataFrame</a></li>
<li><a href="https://intellipaat.com/mediaFiles/2019/03/PySpark-SQL-cheat-sheet.pdf" target="_blank" rel="noopener">https://intellipaat.com/mediaFiles/2019/03/PySpark-SQL-cheat-sheet.pdf</a></li>
<li><a href="https://www.cnblogs.com/liaowuhen1314/p/12792202.html" target="_blank" rel="noopener">https://www.cnblogs.com/liaowuhen1314/p/12792202.html</a></li>
<li><a href="https://spark.apache.org/docs/2.2.0/sql-programming-guide.html" target="_blank" rel="noopener">https://spark.apache.org/docs/2.2.0/sql-programming-guide.html</a></li>
</ul>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        Author:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://liudongdong1.github.io" rel="external nofollow noreferrer">liudongdong1</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        Link:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://liudongdong1.github.io/2020/07/13/yu-yan-kuang-jia/sparkhadoop/pyspark/">https://liudongdong1.github.io/2020/07/13/yu-yan-kuang-jia/sparkhadoop/pyspark/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        Reprint policy:
                    </i>
                </span>
                <span class="reprint-info">
                    All articles in this blog are used except for special statements
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    reprint polocy. If reproduced, please indicate source
                    <a href="https://liudongdong1.github.io" target="_blank">liudongdong1</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>Copied successfully, please follow the reprint policy of this article</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">more</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/spark/">
                                    <span class="chip bg-color">spark</span>
                                </a>
                            
                                <a href="/tags/stream/">
                                    <span class="chip bg-color">stream</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="qq,qzone,wechat,weibo,douban" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;Previous</div>
            <div class="card">
                <a href="/2020/07/13/nlp/framework/nlp-pyspark/">
                    <div class="card-image">
                        
                        <img src="https://gitee.com/github-25970295/blogImage/raw/master/img/traffic-lights-in-city-at-night.jpg" class="responsive-img" alt="NLP_pyspark">
                        
                        <span class="card-title">NLP_pyspark</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            

1. Concept1.1. Estimators
The Estimators have a method called fit() which secures and trains a piece of data to such a
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2020-07-13
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/NLP/" class="post-category">
                                    NLP
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/pyspark/">
                        <span class="chip bg-color">pyspark</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                Next&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2020/07/13/shi-jue-ai/dataset-record/">
                    <div class="card-image">
                        
                        <img src="https://gitee.com/github-25970295/blogImage/raw/master/img/33.jpeg" class="responsive-img" alt="DataSet_Record">
                        
                        <span class="card-title">DataSet_Record</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
在以数据驱动的人工智能时代，本文用于平时学习或者阅读论文中所涉及到的开源数据集积累。dataset知识图谱

More:https://www.codetd.com/article/7219369

Dataset: https://ww
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2020-07-13
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E8%A7%86%E8%A7%89AI/" class="post-category">
                                    视觉AI
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Dataset/">
                        <span class="chip bg-color">Dataset</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;TOC</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <!-- <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="463294659"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            <span id="year">2019</span>
            <a href="https://liudongdong1.github.io" target="_blank">liudongdong</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">1349.4k</span>&nbsp;字
            
            
            
            
            
            
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/liudongdong1/" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:3463264078@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>














    <a href="https://blog.csdn.net/liudongdong19/" class="tooltipped" target="_blank" data-tooltip="关注我的CSDN: https://blog.csdn.net/liudongdong19/" data-position="top" data-delay="50">
        <i class="fab fa-csdn">C</i>
    </a>





</div>
    </div>
</footer>

<div class="progress-bar"></div>
 -->

    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;Search</span>
            <input type="search" id="searchInput" name="s" placeholder="Please enter a search keyword"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/search.xml", 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script type="text/javascript" src="/js/CFS.Snow.min.js"></script>
    <!-- 点击爆灯效果 -->
    <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" ></canvas> 
    <script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script> 
    <script type="text/javascript" src="/js/fireworks.js"></script>
    <!--动态线条背景-->
    <script type="text/javascript"
        color="122 103 238" opacity='0.7' zIndex="-2" count="200" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js">
    </script>
    <!-- 天气 -->
    <!-- weather -->
    <!-- weather -->
    <script type="text/javascript">
         WIDGET = {FID: 'knAMQaFanP'}
    </script>
    <script type="text/javascript" src="https://apip.weatherdt.com/float/static/js/r.js?v=1111"></script>
    <script type="text/javascript" src="https://apip.weatherdt.com/float/static/js/r.js?v=1111"></script>
    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    

    
    
    <script type="text/javascript" size="150" alpha='0.6'
        zIndex="-1" src="/libs/background/ribbon-refresh.min.js" async="async"></script>
    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    
    <!-- {% include '_custom/custom.swig' %} -->

</body>

</html>
