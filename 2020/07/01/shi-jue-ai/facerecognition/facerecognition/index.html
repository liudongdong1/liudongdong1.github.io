<!DOCTYPE HTML>
<html lang="en">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="FaceRecognition, AIOT,Space&amp;Temporal Sequence Analysis,SpringBoot,liudongdong1,cloud">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>FaceRecognition | DaybyDay</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="DaybyDay" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">DaybyDay</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>Index</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>Tags</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>Categories</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>Archives</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">

      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>About</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
    </a>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="/about">
          
          <i class="fas fa-user-circle" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>about</span>
        </a>
      </li>
      
      <li>
        <a href="/resume">
          
          <i class="fa fa-user-secret" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>resume</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>Friends</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/gallery" class="waves-effect waves-light">
      
      <i class="fas fa-camera" style="zoom: 0.6;"></i>
      
      <span>Galleries</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="Search" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">DaybyDay</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			Index
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			Tags
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			Categories
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			Archives
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-user-circle"></i>
			
			About
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>

                  <a href="/about " style="margin-left:75px">
				  
				   <i class="fa fas fa-user-circle" style="position: absolute;left:50px" ></i>
			      
		          <span>about</span>
                  </a>
                </li>
              
                <li>

                  <a href="/resume " style="margin-left:75px">
				  
				   <i class="fa fa fa-user-secret" style="position: absolute;left:50px" ></i>
			      
		          <span>resume</span>
                  </a>
                </li>
              
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			Friends
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/gallery" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-camera"></i>
			
			Galleries
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/liudongdong1" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/liudongdong1" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('https://gitee.com/github-25970295/blogImage/raw/master/img/laptop-notebook-working-outside.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">FaceRecognition</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    .toc-fixed .toc-link::before{
        position: fixed!important;/*当toc的位置改为fixed时，.toc-link::before也要改为fixed*/
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/FaceRecognition/">
                                <span class="chip bg-color">FaceRecognition</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E8%A7%86%E8%A7%89AI/" class="post-category">
                                视觉AI
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>Publish Date:&nbsp;&nbsp;
                    2020-07-01
                </div>
                

                <!-- 
                    <i class="fa fa-pencil"></i> Author: liudongdong1
                  -->

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>Update Date:&nbsp;&nbsp;
                    2021-07-28
                </div>
                

                <!-- 
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>Word Count:&nbsp;&nbsp;
                    7.1k
                </div>
                 -->

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>Read Times:&nbsp;&nbsp;
                    32 Min
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>Read Count:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/image-20200716092214886.png" alt=""></p>
<h2 id="1-人脸检测问题"><a href="#1-人脸检测问题" class="headerlink" title="1. 人脸检测问题"></a>1. 人脸检测问题</h2><p>在实际工程应用中，常常会面临非常复杂的工况。一方面算法准确度会受到很多因素影响，例如目标遮挡、光线变化、小尺寸人脸等等。另一方面算法的推理时间也会受到很多因素的影响，例如硬件性能，目标数量，图片尺寸等等。下面是几种工程中常见的问题。</p>
<ul>
<li><strong>人脸遮挡</strong>，或者人脸角度较大，都会直接导致目标不完整，对于检测算法召回率有很大影响</li>
<li><strong>暗光</strong>，光线不充足条件下，导致成像质量不高，会影响检测算法召回率</li>
<li><strong>低分辨率</strong>，低分辨率导致人脸尺寸过小</li>
<li><strong>人脸数量过多</strong>，图片中人脸数量多，对检测算法要求较高。例如多目标靠的太近，对于NMS算法会是一种考验，另外数量过多会影响某些算法(图像金字塔类型)的时间复杂度，例如MTCNN</li>
</ul>
<p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/image-20200716092748448.png" alt=""></p>
<blockquote>
<p><strong>基于特征的算法</strong>就是通过提取图像中的特征和人脸特征进行匹配，如果匹配上了就说明是人脸，反之则不是。提取的特征是人为设计的特征，例如Haar，FHOG，特征提取完之后，再利用分类器去进行判断。通俗的说就是采用模板匹配，就是用人脸的模板图像与待检测的图像中的各个位置进行匹配，匹配的内容就是提取的特征，然后再利用分类器进行判断是否有人脸</p>
</blockquote>
<blockquote>
<p><strong>基于图像的算法</strong>，将图像分为很多小窗口，然后分别判断每个小窗是否有人脸。通常基于图像的方法依赖于统计分析和机器学习，通过统计分析或者学习的过程来找到人脸和非人脸之间的统计关系来进行人脸检测。最具代表性的就是CNN，CNN用来做人脸检测也是目前效果最好，速度最快的。后面着重介绍CNN相关人脸检测算法。</p>
</blockquote>
<p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/image-20201219112426981.png" alt=""></p>
<h2 id="2-工业界常用算法"><a href="#2-工业界常用算法" class="headerlink" title="2. 工业界常用算法"></a>2. 工业界常用算法</h2><h3 id="2-1-MTCNN"><a href="#2-1-MTCNN" class="headerlink" title="2.1. MTCNN"></a>2.1. MTCNN</h3><blockquote>
<p>MTCNN是kaipeng Zhang在本科阶段研究出来的，它是一个3级联的CNN网络，分为PNet，RNet，ONet，层层递进。PNet的输入是原图经过图像金字塔之后不同尺寸的图片，最后结果由ONet输出。</p>
</blockquote>
<img src="https://gitee.com/github-25970295/blogImage/raw/master/img/image-20200716093313218.png" style="zoom: 67%;">

<h3 id="2-2-FaceBoxes、RetinaFace-mnet、LFFD"><a href="#2-2-FaceBoxes、RetinaFace-mnet、LFFD" class="headerlink" title="2.2. FaceBoxes、RetinaFace mnet、LFFD"></a>2.2. <strong>FaceBoxes、RetinaFace mnet、LFFD</strong></h3><blockquote>
<p>属于One Stage 算法，FaceBoxes类似于SSD算法框架，采用多尺度特征层融合方式，采用anchor proposal，在不同尺度特征层上进行检测，这样就顾及到多尺度的人脸检测，FaceBoxes的文章旨在CPU上实现实时检测。</p>
</blockquote>
<h3 id="2-3-CenterFace"><a href="#2-3-CenterFace" class="headerlink" title="2.3. CenterFace"></a>2.3. CenterFace</h3><blockquote>
<p>最新开源的一个人脸检测算法，github上同名项目。目前从数据来看，效果最好。</p>
<p>在实际工程应用中，要根据部署环境来选择人脸检测算法。例如在多人脸抓拍的场景，就不能选择MTCNN这类级联的算法，因为级联网络的推理速度与人脸数成反比，受人脸数量影响较大，MTCNN适用于人脸考勤或者人证对比的场景，只可能出现固定数量人脸的场景。</p>
</blockquote>
<h3 id="2-4-dlib"><a href="#2-4-dlib" class="headerlink" title="2.4. dlib"></a>2.4. <a href="https://www.lfd.uci.edu/~gohlke/pythonlibs/#ta-lib" target="_blank" rel="noopener">dlib</a></h3><blockquote>
<p>dlib 安装失败问题： </p>
</blockquote>
<pre class=" language-shell"><code class="language-shell">pip install cmake
pip install dlib

#方法二
pip install dlib==19.6.1 
#方法三： 离线安装
pip install dlib-19.21.0.tar.gz</code></pre>
<blockquote>
<p>一个人脸算法库，并且开源。不管你是用c++还是python，都可以直接使用dlib来做检测.</p>
</blockquote>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#opencv-python, dlib</span>
<span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> dlib
<span class="token comment" spellcheck="true"># Load the detector</span>
detector <span class="token operator">=</span> dlib<span class="token punctuation">.</span>get_frontal_face_detector<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># Load the predictor</span>
predictor <span class="token operator">=</span> dlib<span class="token punctuation">.</span>shape_predictor<span class="token punctuation">(</span><span class="token string">"shape_predictor_68_face_landmarks.dat"</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># read the image</span>
img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">"face.jpg"</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># Convert image into grayscale</span>
gray <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>src<span class="token operator">=</span>img<span class="token punctuation">,</span> code<span class="token operator">=</span>cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># Use detector to find landmarks</span>
faces <span class="token operator">=</span> detector<span class="token punctuation">(</span>gray<span class="token punctuation">)</span>
<span class="token keyword">for</span> face <span class="token keyword">in</span> faces<span class="token punctuation">:</span>
    x1 <span class="token operator">=</span> face<span class="token punctuation">.</span>left<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># left point</span>
    y1 <span class="token operator">=</span> face<span class="token punctuation">.</span>top<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># top point</span>
    x2 <span class="token operator">=</span> face<span class="token punctuation">.</span>right<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># right point</span>
    y2 <span class="token operator">=</span> face<span class="token punctuation">.</span>bottom<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># bottom point</span>
    <span class="token comment" spellcheck="true"># Create landmark object</span>
    landmarks <span class="token operator">=</span> predictor<span class="token punctuation">(</span>image<span class="token operator">=</span>gray<span class="token punctuation">,</span> box<span class="token operator">=</span>face<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># Loop through all the points</span>
    <span class="token keyword">for</span> n <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">68</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> landmarks<span class="token punctuation">.</span>part<span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">.</span>x
        y <span class="token operator">=</span> landmarks<span class="token punctuation">.</span>part<span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">.</span>y
        <span class="token comment" spellcheck="true"># Draw a circle</span>
        cv2<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>img<span class="token operator">=</span>img<span class="token punctuation">,</span> center<span class="token operator">=</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> radius<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> thickness<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># show the image</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>winname<span class="token operator">=</span><span class="token string">"Face"</span><span class="token punctuation">,</span> mat<span class="token operator">=</span>img<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># Delay between every fram</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span>delay<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># Close all windows</span>
cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/20200826082312.png" alt=""></p>
<h2 id="3-论文阅读"><a href="#3-论文阅读" class="headerlink" title="3. 论文阅读"></a>3. 论文阅读</h2><p><strong>level</strong>: CVPR<br><strong>author</strong>: Valentin Bazarevsky  (GoogleResearch)<br><strong>date</strong>: 2019<br><strong>keyword</strong>:</p>
<ul>
<li>face detect</li>
</ul>
<hr>
<h3 id="Paper-BlazeFace"><a href="#Paper-BlazeFace" class="headerlink" title="Paper: BlazeFace"></a>Paper: BlazeFace</h3><div align="center">
<br>
<b>BlazeFace: Sub-millisecond Neural FaceDetectionon Mobile GPUs
</b>
</div>

<h4 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h4><ol>
<li>present a lightweight and well-performing face detector tailored for mobile GPU inference, run 200-1000+on flagshship devices.</li>
<li>supporting to any augmented reality pipeline that requires an accurate facial region of interest as an input for task-specific models, such as 2D/3D facial keypoint or geometry estimation, facial features or expression classification, and face region segmentation.</li>
<li><strong>Relative to speed:</strong><ul>
<li>a very compact feature extractor convolutional neural network related in structure to MobleNetV1.</li>
<li>a novel GPU-friendly anchor scheme modified from SSD, aimed at effective GPU utilization.</li>
</ul>
</li>
<li><strong>Related to prediction quality:</strong> a tie resolution strategy alternative to non-maximum suppression that achieves stabler,smoother tie resolution between overlapping predictions.</li>
</ol>
<h4 id="System-Overview"><a href="#System-Overview" class="headerlink" title="System Overview"></a>System Overview</h4><blockquote>
<p>BlazeFace model produces 6 facial keypoint coordinates (for eye centers, ear tragions, mouth center, and nose tip) that allow us to estimate <strong>face rotation</strong>, alleviating the requirement of significant translation and rotation invariance in subsequent processing steps;</p>
</blockquote>
<p>【<strong>Model architecture design</strong>】</p>
<ul>
<li><strong>Enlarging the receptive field sizes:</strong>  <ul>
<li>increasing the kernel size of the depthwise part is relatively cheap, and employ 5*5 kernels in model architecture bottlenecks, trading the kernel size increase for the decrease in the total amount of such bottlenecks required to reach a particular receptive field size.  <font color="red">这块看不懂</font></li>
</ul>
</li>
</ul>
<p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/20200831120241.png" alt=""></p>
<ul>
<li><strong>Feature extractor:</strong> the extractor takes an RGB input of 128*128 pixels and consists of a 2D convolution followed by 5 single BlazeBlocks and 6 double BlazeBlocks.</li>
<li><strong>Anchor scheme:</strong> SSD-like object detection models rely on pre-defined fixed-size base bounding boxes called priors, or anchors in Faster-R-CNN terminology.<ul>
<li>adopt an alternative anchor scheme that stops at the 8*8 feature map dimensions without further downsampling,</li>
<li>replace 2 anchors per pixel in each of the 8*8, 4*4 and 2<em>2 resolutions by 6 anchors at  8\</em>8;</li>
<li>due to limited variance in human face aspect ratios, limiting the anchors to the 1:1 aspect ratio was found sufficient for accurate face detection;</li>
</ul>
</li>
<li><strong>Post-processing:</strong> replacing the suppression algorithm wiht a blending strategy that estimates the regression parameters of a bounding box as a weighted mean between the overlapping predictions;</li>
</ul>
<p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/20200831121558.png" alt=""></p>
<p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/20200831121622.png" alt=""></p>
<p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/20200831121809.png" alt=""></p>
<h4 id="Notes-去加强了解"><a href="#Notes-去加强了解" class="headerlink" title="Notes 去加强了解"></a>Notes <font color="orange">去加强了解</font></h4><ul>
<li><input disabled="" type="checkbox"> 几种常见模型里面的计算</li>
</ul>
<p><strong>level</strong>:   CCF_A   CVPR<br><strong>author</strong>:  FlorianSchroff <a href="mailto:fschroff@google.com">fschroff@google.com</a> GoogleInc<br><strong>date</strong>: 2015<br><strong>keyword</strong>:</p>
<ul>
<li>AI, FaceRecognition</li>
</ul>
<hr>
<h3 id="Paper-FaceNet"><a href="#Paper-FaceNet" class="headerlink" title="Paper: FaceNet"></a>Paper: FaceNet</h3><div align="center">
<br>
<b>FaceNet: A Uniﬁed Embedding for FaceRecognition and Clustering
</b>
</div>
#### Summary

<ol>
<li>present a system, FaceNet that directly learns  a mapping from face images to a compact Euclidean space where distances directly correspond to a measure of face similarity, further used by face recognition, verification, and clustering.</li>
<li>FaceNet directly trains its output to be a compact 128-D embedding using a triplet based loss function based on LMNN, the triplets consist of two matching face thumbnails and a non-matching face thumbnail and the loss aims  to separate the positive pair form the negative by a distance margin. The thumbnails are tight crops of the face area, no 2D or 3D alignment, other than scale and translation is performed.</li>
</ol>
<h4 id="Research-Objective"><a href="#Research-Objective" class="headerlink" title="Research Objective"></a>Research Objective</h4><p><strong>previous work:</strong></p>
<ul>
<li><font color="red">Zeiler&amp;Fergus[22] model </font>: multiple interleaved layers of convolutions, non-linear activations, local response normalizations, and max pooling layers.</li>
<li><font color="red">Inception model of Szegedy et al.</font> : use  mixed layers that run several different convolutional and pooling layers in parallel and concatenate their responses</li>
<li>using a complex system of multiple stages combining the output of a deep convolutional network with PCA for dimensionality reduction and SVM for classification</li>
<li>ZHanyao et al.  : employ deep network to warp faces into a canonical frontal view and then learn CNN that classifies each face as belonging to a known identity, PCA on the network output in conjunction with an ensemble of SVM is used</li>
<li>Taigman et al. : multi-stage approach that aligns faces to a general 3D shape model.</li>
<li>sun et al. : propose a compact and therefore relatively cheap to compute network.</li>
</ul>
<h4 id="Methods"><a href="#Methods" class="headerlink" title="Methods"></a>Methods</h4><ul>
<li><p><strong>Problem Formulation</strong>:</p>
<p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/image-20200301104544427.png" alt=""></p>
<p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/image-20200301104603166.png" alt=""></p>
<p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/image-20200301104625390.png" alt=""></p>
</li>
<li><p><strong>system overview</strong>:</p>
</li>
</ul>
<p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/image-20200301104451015.png" alt=""></p>
<p><strong>[FaceNet Model1]</strong></p>
<p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/image-20200301104704084.png" alt=""></p>
<p><strong>[FaceNet Model2]</strong>based on GoogLeNet styleInceptionmodels[16]</p>
<p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/image-20200301104856005.png" alt=""></p>
<h4 id="Notes"><a href="#Notes" class="headerlink" title="Notes"></a>Notes</h4><ul>
<li>curriculum learning : describes a type of learning in which you first start out with only easy examples of a task and then gradually increase the task difficulty.<ul>
<li>code available: <a href="https://github.com/vkakerbeck/Progressively-Growing-Networks" target="_blank" rel="noopener">https://github.com/vkakerbeck/Progressively-Growing-Networks</a></li>
</ul>
</li>
<li>Progressively Growing Neural Networks:grow networks during training and to learn new image categories</li>
<li>LMNN</li>
</ul>
<img src="https://gitee.com/github-25970295/blogImage/raw/master/img/image-20200716091352035.png" alt="image-20200716091352035" style="zoom:50%;">

<p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/image-20200305173050782.png" alt=""></p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Triplet_loss" target="_blank" rel="noopener">triplet based loss</a></li>
</ul>
<p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/image-20200305175940694.png" alt=""></p>
<p><strong>level</strong>:   CVPR   CCF_A<br><strong>author</strong>: XinLiu (CAS)<br><strong>date</strong>: 2016<br><strong>keyword</strong>:</p>
<ul>
<li>FaceRecognition</li>
</ul>
<hr>
<h3 id="Paper-VIPLFaceNet"><a href="#Paper-VIPLFaceNet" class="headerlink" title="Paper: VIPLFaceNet"></a>Paper: VIPLFaceNet</h3><div align="center">
<br>
<b>VIPLFaceNet: AnOpenSourceDeepFaceRecognitionSDK</b>
</div>


<h4 id="Research-Objective-1"><a href="#Research-Objective-1" class="headerlink" title="Research Objective"></a>Research Objective</h4><ul>
<li><strong>Application Area</strong>: Face recognition</li>
</ul>
<h4 id="Proble-Statement"><a href="#Proble-Statement" class="headerlink" title="Proble Statement"></a>Proble Statement</h4><ul>
<li>a conventional face recognition system consists of four modules,face detection,face alignment, face representation, and identity classification.</li>
<li>main challenges of face representation:<ul>
<li>small inter-person appearance difference caused by similar facial configurations</li>
<li>large intra-person appearance variations due to large intrinsic variations and diverse extrinsic imaging factors, such as head pose, expression, aging, and illumination.</li>
</ul>
</li>
</ul>
<p>previous work:</p>
<ul>
<li><p>Face Representation before DL</p>
</li>
<li><p>Hand Craft features: Gabor wavelets, local Binary Pattern, SIFT, Historgram of Oriented Gradients</p>
</li>
<li><p>Deep learning Methods:</p>
<ul>
<li>DeepFace : 1. 3D model based face alignment to frontalize facial images with large pose. 2.large scale training set with 4 million face images of 4000 identities. 3.Deep convolutional neural network with the local connected layer that learns separate kernel for each spatial position. 4.A siamese network architecture to learn deep metric based on the features of the deep convolutional network</li>
<li>DeepID, DeepID2, DeepID2+ </li>
<li>Learning face representation from scratch.</li>
<li>FaceNet</li>
</ul>
<p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/image-20200304122129244.png" alt=""></p>
</li>
</ul>
<h4 id="Methods-1"><a href="#Methods-1" class="headerlink" title="Methods"></a>Methods</h4><ul>
<li><strong>system overview</strong>:</li>
</ul>
<p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/image-20200304122158473.png" alt=""></p>
<p>【Optimation 1】Fast Normalization Layer</p>
<p>Data normalization can speed up convergence, which is recently extended as the batch normalization algorithms.</p>
<p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/image-20200304152727485.png" alt=""></p>
<p><strong>Face Detection:</strong>  using face detection toolkit by VIPL lab of CAS,</p>
<p>*<em>Facial Landmark Location: *</em>coarse to fine auto-encoder networks(CFAN) to detect five facial landmarks in the face.</p>
<p><strong>Face Normalization:</strong> the face image is normalized to 256*256 pixels using five facial landmarks.</p>
<h4 id="Evaluation"><a href="#Evaluation" class="headerlink" title="Evaluation"></a>Evaluation</h4><p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/image-20200304153238679.png" alt=""></p>
<h4 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h4><ul>
<li>propose and release an open source deep face recognition model, VIPFaceNet, with high-accuracy and low computational cost.</li>
<li>reduces 40% computation cost and cuts down 40% error rate on LFW compared with AlexNet</li>
<li>pure C++ code</li>
</ul>
<h4 id="Notes-去加强了解-1"><a href="#Notes-去加强了解-1" class="headerlink" title="Notes 去加强了解"></a>Notes <font color="orange">去加强了解</font></h4><ul>
<li><input disabled="" type="checkbox"> 学习使用AlexNet模型  simplest with 5 convolutional layer and 3 fully-connected layers</li>
<li><input disabled="" type="checkbox"> 学习使用LFW模型</li>
<li><input disabled="" type="checkbox"> Learning face representation from scratch. arXivpreprintarXiv:1411.7923,2014 </li>
<li><input disabled="" type="checkbox"> GoogleNet 模型</li>
<li><input disabled="" type="checkbox"> VGGNet模型</li>
</ul>
<h2 id="4-开源项目"><a href="#4-开源项目" class="headerlink" title="4. 开源项目"></a>4. 开源项目</h2><h3 id="4-1-DBFace"><a href="#4-1-DBFace" class="headerlink" title="4.1. DBFace"></a><a href="https://github.com/dlunion/DBFace" target="_blank" rel="noopener">4.1. DBFace</a></h3><ul>
<li>DBFace 是一个轻量级的实时人脸识别方法，其有着更快的识别速度与更高的精度。下图展示了多种人脸检测方法在 WiderFace 数据集上的测试效果。可以看到不仅 DBFace 模型的大小最小，其在 Easy、medium、Hard 三个测试任务中均取得了最高的识别精度。</li>
<li>WiderFace 是一个关于人脸检测的基准跑分数据集，其中包含 32,203 张图片以及在各方面剧烈的 393,703 张人脸，数据集具有从简单到困难等不同难度的任务。</li>
</ul>
<p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/image-20200716091843597.png" alt=""></p>
<p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/image-20200716091856713.png" alt="image-20200716091856713"></p>
<h3 id="4-2-Rotation-Invariant-FaceDetection"><a href="#4-2-Rotation-Invariant-FaceDetection" class="headerlink" title="4.2. Rotation-Invariant FaceDetection"></a>4.2. Rotation-Invariant FaceDetection</h3><p>Real-Time Rotation-Invariant Face Detection with Progressive Calibration Networks</p>
<p>PCN 会抽选识别候选面部图像块，并将朝下的图像块翻转至正向，这样就会减半 RIP 的角度范围，即从 [−180° , 180° ] 到 [−90° , 90° ]。然后旋转过的面部图像块会进一步区分朝向并校准到垂直向的 [−45° , 45° ] 范围，这样又会减半 RIP 的角度范围。最后，PCN 会分辨到底这些候选图像块是不是人脸，并预测出精确的 RIP 角度。</p>
<p>通过将校准过程分割为几个渐进的步骤，且在早期校准步骤只预测粗略的朝向，PCN 最后能实现精确的校准。此外，每一个校准步骤可以简单地旋转-90°、90°和 180°，因此额外的计算量非常低，这也就是为什么该检测项目能在 CPU 上实时运行的重要原因。通过在逐渐降低的 RIP 范围内执行二元分类（是人脸或不是人脸），PCN 能在 360° RIP 旋转角度内准确地检测到人脸，而本项目重点就是实现这样旋转不变的人脸检测器。</p>
<p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/image-20200716091914764.png" alt=""></p>
<p>论文图 3：uepeng Shi 等研究者提出的 PCN 概览，它会逐渐降低旋转的角度范围，并最终预测人脸及其旋转的角度。这种能处理不同旋转方向的人脸检测器有非常高的准确率，因为它会先将候选人脸旋转至正向再预测。此外，这种方法同样有非常小的计算量，该 GitHub 项目表示它甚至可以在 CPU 上实时检测人脸。</p>
<h3 id="4-3-OpenCV-OpenVINO实现人脸"><a href="#4-3-OpenCV-OpenVINO实现人脸" class="headerlink" title="4.3. OpenCV+OpenVINO实现人脸"></a><a href="https://software.intel.com/en-us/openvino-toolkit/choose-download?innovator=CONT-0026250" target="_blank" rel="noopener">4.3. OpenCV+OpenVINO实现人脸</a></h3><ul>
<li>支持35点分布表示出左眼、右眼、鼻子、嘴巴、左侧眉毛、右侧眉毛、人脸轮廓</li>
</ul>
<pre class=" language-python"><code class="language-python"><span class="token operator">/</span> 加载LANDMARK
Net mkNet <span class="token operator">=</span> readNetFromModelOptimizer<span class="token punctuation">(</span>landmark_xml<span class="token punctuation">,</span> landmark_bin<span class="token punctuation">)</span><span class="token punctuation">;</span>
mkNet<span class="token punctuation">.</span>setPreferableBackend<span class="token punctuation">(</span>DNN_BACKEND_INFERENCE_ENGINE<span class="token punctuation">)</span><span class="token punctuation">;</span>
mkNet<span class="token punctuation">.</span>setPreferableTarget<span class="token punctuation">(</span>DNN_TARGET_CPU<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">//</span> 加载网络
Net net <span class="token operator">=</span> cv<span class="token punctuation">:</span><span class="token punctuation">:</span>dnn<span class="token punctuation">:</span><span class="token punctuation">:</span>readNetFromTensorflow<span class="token punctuation">(</span>tensorflowWeightFile<span class="token punctuation">,</span> tensorflowConfigFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
net<span class="token punctuation">.</span>setPreferableBackend<span class="token punctuation">(</span>DNN_BACKEND_INFERENCE_ENGINE<span class="token punctuation">)</span><span class="token punctuation">;</span>
net<span class="token punctuation">.</span>setPreferableTarget<span class="token punctuation">(</span>DNN_TARGET_CPU<span class="token punctuation">)</span><span class="token punctuation">;</span>
Mat frame<span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>true<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    bool ret <span class="token operator">=</span> cap<span class="token punctuation">.</span>read<span class="token punctuation">(</span>frame<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>!ret<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token operator">//</span> flip<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> frame<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cv<span class="token punctuation">:</span><span class="token punctuation">:</span>Mat inputBlob <span class="token operator">=</span> cv<span class="token punctuation">:</span><span class="token punctuation">:</span>dnn<span class="token punctuation">:</span><span class="token punctuation">:</span>blobFromImage<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> cv<span class="token punctuation">:</span><span class="token punctuation">:</span>Size<span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        Scalar<span class="token punctuation">(</span><span class="token number">104.0</span><span class="token punctuation">,</span> <span class="token number">177.0</span><span class="token punctuation">,</span> <span class="token number">123.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> false<span class="token punctuation">,</span> false<span class="token punctuation">)</span><span class="token punctuation">;</span>
    net<span class="token punctuation">.</span>setInput<span class="token punctuation">(</span>inputBlob<span class="token punctuation">,</span> <span class="token string">"data"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cv<span class="token punctuation">:</span><span class="token punctuation">:</span>Mat detection <span class="token operator">=</span> net<span class="token punctuation">.</span>forward<span class="token punctuation">(</span><span class="token string">"detection_out"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cv<span class="token punctuation">:</span><span class="token punctuation">:</span>Mat detectionMat<span class="token punctuation">(</span>detection<span class="token punctuation">.</span>size<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> detection<span class="token punctuation">.</span>size<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> CV_32F<span class="token punctuation">,</span> detection<span class="token punctuation">.</span>ptr<span class="token operator">&lt;</span>float<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>int i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> detectionMat<span class="token punctuation">.</span>rows<span class="token punctuation">;</span> i<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        float confidence <span class="token operator">=</span> detectionMat<span class="token punctuation">.</span>at<span class="token operator">&lt;</span>float<span class="token operator">></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>confidence <span class="token operator">></span> <span class="token number">0.5</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            int x1 <span class="token operator">=</span> static_cast<span class="token operator">&lt;</span>int<span class="token operator">></span><span class="token punctuation">(</span>detectionMat<span class="token punctuation">.</span>at<span class="token operator">&lt;</span>float<span class="token operator">></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">*</span> w<span class="token punctuation">)</span><span class="token punctuation">;</span>
            int y1 <span class="token operator">=</span> static_cast<span class="token operator">&lt;</span>int<span class="token operator">></span><span class="token punctuation">(</span>detectionMat<span class="token punctuation">.</span>at<span class="token operator">&lt;</span>float<span class="token operator">></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">*</span> h<span class="token punctuation">)</span><span class="token punctuation">;</span>
            int x2 <span class="token operator">=</span> static_cast<span class="token operator">&lt;</span>int<span class="token operator">></span><span class="token punctuation">(</span>detectionMat<span class="token punctuation">.</span>at<span class="token operator">&lt;</span>float<span class="token operator">></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">*</span> w<span class="token punctuation">)</span><span class="token punctuation">;</span>
            int y2 <span class="token operator">=</span> static_cast<span class="token operator">&lt;</span>int<span class="token operator">></span><span class="token punctuation">(</span>detectionMat<span class="token punctuation">.</span>at<span class="token operator">&lt;</span>float<span class="token operator">></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">*</span> h<span class="token punctuation">)</span><span class="token punctuation">;</span>
            Mat roi <span class="token operator">=</span> frame<span class="token punctuation">(</span>Range<span class="token punctuation">(</span>y1<span class="token punctuation">,</span> y2<span class="token punctuation">)</span><span class="token punctuation">,</span> Range<span class="token punctuation">(</span>x1<span class="token punctuation">,</span> x2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Mat blob <span class="token operator">=</span> blobFromImage<span class="token punctuation">(</span>roi<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> Size<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Scalar<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> false<span class="token punctuation">,</span> false<span class="token punctuation">)</span><span class="token punctuation">;</span>
            mkNet<span class="token punctuation">.</span>setInput<span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
            Mat landmark_data <span class="token operator">=</span> mkNet<span class="token punctuation">.</span>forward<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token operator">//</span> printf<span class="token punctuation">(</span><span class="token string">"rows: %d \n, cols : %d \n"</span><span class="token punctuation">,</span> landmark_data<span class="token punctuation">.</span>rows<span class="token punctuation">,</span> landmark_data<span class="token punctuation">.</span>cols<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>int i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> landmark_data<span class="token punctuation">.</span>cols<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                float x <span class="token operator">=</span> landmark_data<span class="token punctuation">.</span>at<span class="token operator">&lt;</span>float<span class="token operator">></span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token operator">*</span>roi<span class="token punctuation">.</span>cols<span class="token operator">+</span>x1<span class="token punctuation">;</span>
                float y <span class="token operator">=</span> landmark_data<span class="token punctuation">.</span>at<span class="token operator">&lt;</span>float<span class="token operator">></span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>roi<span class="token punctuation">.</span>rows<span class="token operator">+</span>y1<span class="token punctuation">;</span>
                <span class="token operator">//</span> mkList<span class="token punctuation">.</span>push_back<span class="token punctuation">(</span>Point<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                circle<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> Point<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> Scalar<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            cv<span class="token punctuation">:</span><span class="token punctuation">:</span>rectangle<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> cv<span class="token punctuation">:</span><span class="token punctuation">:</span>Point<span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">)</span><span class="token punctuation">,</span> cv<span class="token punctuation">:</span><span class="token punctuation">:</span>Point<span class="token punctuation">(</span>x2<span class="token punctuation">,</span> y2<span class="token punctuation">)</span><span class="token punctuation">,</span> cv<span class="token punctuation">:</span><span class="token punctuation">:</span>Scalar<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    imshow<span class="token punctuation">(</span><span class="token string">"Face-Detection Demo"</span><span class="token punctuation">,</span> frame<span class="token punctuation">)</span><span class="token punctuation">;</span>
    char c <span class="token operator">=</span> waitKey<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token number">27</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="4-4-Face-Recognition-库使用"><a href="#4-4-Face-Recognition-库使用" class="headerlink" title="4.4. Face_Recognition 库使用"></a>4.4. <a href="https://github.com/ageitgey/face_recognition" target="_blank" rel="noopener">Face_Recognition 库使用</a></h3><pre class=" language-shell"><code class="language-shell">pip install face_recognition</code></pre>
<blockquote>
<p>Face Recognition 是一个基于 Python 的人脸识别库，它还提供了一个命令行工具，让你通过命令行对任意文件夹中的图像进行人脸识别操作。 该库使用 dlib 顶尖的深度学习人脸识别技术构建，在户外脸部检测数据库基准(Labeled Faces in the Wild benchmark)上的准确率高达 99.38%。</p>
</blockquote>
<blockquote>
<p>batch_face_locations(images, number_of_times_to_upsample=1, batch_size=128)： </p>
<p>使用cnn面部检测器返回图像中二维人脸的边界框数组，如果您正在使用<a href="https://cloud.tencent.com/product/gpu?from=10680" target="_blank" rel="noopener">GPU</a>，这可以更快的给您结果，因为GPU可以一次处理批次的图像。如果您不使用GPU，则不需要此功能。</p>
<h5 id="参数："><a href="#参数：" class="headerlink" title="参数："></a>参数：</h5><ul>
<li>images - 图像列表（每个作为numpy数组）</li>
<li>number_of_times_to_upsample - 用于对图像进行采样的次数。较高的数字找到较小的脸。</li>
<li>batch_size - 每个GPU处理批次中包含的图像数量。</li>
</ul>
<h5 id="返回："><a href="#返回：" class="headerlink" title="返回："></a>返回：</h5><p>一个可以在css（上，右，下，左）顺序中找到的人脸位置的元组列表</p>
</blockquote>
<blockquote>
<p>compare_faces(known_face_encodings, face_encoding_to_check, tolerance=0.6)： 将候选编码的面部编码列表进行比较，以查看它们是否匹配。</p>
<h5 id="参数：-1"><a href="#参数：-1" class="headerlink" title="参数："></a>参数：</h5><ul>
<li>known_face_encodings - 已知面部编码的列表</li>
<li>face_encoding_to_check - 与已知面部编码的列表进行比较的单面编码</li>
<li>tolerance - 面孔之间的距离要考虑多少。越小越严格， 0.6是典型的最佳性能。</li>
</ul>
<h5 id="返回：-1"><a href="#返回：-1" class="headerlink" title="返回："></a>返回：</h5><p>一个True / False值的列表，指出哪个known_face_encodings匹配要检查的面部编码</p>
</blockquote>
<blockquote>
<p>face_distance(face_encodings, face_to_compare)： 给出面部编码列表，将其与已知的面部编码进行比较，并为每个比较的人脸获得欧几里得距离。距离告诉你面孔是如何相似的。</p>
<h5 id="参数：-2"><a href="#参数：-2" class="headerlink" title="参数："></a>参数：</h5><ul>
<li>face_encodings - 要比较的面部编码列表</li>
<li>face_to_compare - 要比较的面部编码</li>
</ul>
<h5 id="返回：-2"><a href="#返回：-2" class="headerlink" title="返回："></a>返回：</h5><p>一个numpy ndarray，每个面的距离与“faces”数组的顺序相同</p>
</blockquote>
<blockquote>
<p>face_encodings(face_image, known_face_locations=None, num_jitters=1)： </p>
<p>给定图像，返回图像中每个面部的128维面部编码。</p>
<h5 id="参数：-3"><a href="#参数：-3" class="headerlink" title="参数："></a>参数：</h5><ul>
<li>face_image - 包含一个或多个面的图像</li>
<li>known_face_locations - 可选 - 如果您已经知道它们，每个面的边框。</li>
<li>num_jitters - 计算编码时重新采样多少次。更高更准确，但更慢（即100是100倍慢）</li>
</ul>
<h5 id="返回：-3"><a href="#返回：-3" class="headerlink" title="返回："></a>返回：</h5><p>128个面部编码的列表（图像中的每个脸部一个）</p>
</blockquote>
<blockquote>
<p>face_landmarks(face_image, face_locations=None)：给定图像，返回图像中每个脸部的脸部特征位置（眼睛，鼻子等）的指令</p>
<h5 id="参数：-4"><a href="#参数：-4" class="headerlink" title="参数："></a>参数：</h5><ul>
<li>face_image - 要搜索的图像</li>
<li>face_locations - 可选地提供要检查的面部位置的列表。</li>
</ul>
<h5 id="返回：-4"><a href="#返回：-4" class="headerlink" title="返回："></a>返回：</h5><p>面部特征位置（眼睛，鼻子等）的列表</p>
</blockquote>
<blockquote>
<p>face_locations(img, number_of_times_to_upsample=1, model=’hog’)：</p>
<p>返回图像中人脸的边框数组</p>
<h5 id="参数：-5"><a href="#参数：-5" class="headerlink" title="参数："></a>参数：</h5><ul>
<li>img - 一个图像（作为一个numpy数组）</li>
<li>number_of_times_to_upsample - 用于对图像进行上采样的次数多少次。较高的数字找到较小的脸。</li>
<li>model - 要使用的面部检测模型。“hog”在CPU上不太准确，但速度更快。“cnn”是一个更准确的深入学习模式，GPU / CUDA加速（如果可用）。默认为“hog”。</li>
</ul>
<h5 id="返回：-5"><a href="#返回：-5" class="headerlink" title="返回："></a>返回：</h5><p>一个可以在css（上，右，下，左）顺序中找到的表面位置的元组列表</p>
</blockquote>
<blockquote>
<p>load_image_file(file, mode=’RGB’)：</p>
<p>将图像文件（.jpg，.png等）加载到numpy数组中</p>
<h5 id="参数：-6"><a href="#参数：-6" class="headerlink" title="参数："></a>参数：</h5><ul>
<li>file - 要加载的图像文件名或文件对象</li>
<li>mode - 将图像转换为格式。只支持“RGB”（8位RGB，3声道）和“L”（黑白）。</li>
</ul>
<h5 id="返回：-6"><a href="#返回：-6" class="headerlink" title="返回："></a>返回：</h5><p>图像内容为numpy数组</p>
</blockquote>
<ul>
<li>人脸识别并检测绘制关键点</li>
</ul>
<pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> face_recognition
<span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> os
<span class="token keyword">import</span> time
<span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtCore <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image<span class="token punctuation">,</span> ImageDraw<span class="token punctuation">,</span> ImageFont



<span class="token keyword">class</span> <span class="token class-name">Face_Recognizer</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> camera_id <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>basefolder<span class="token operator">=</span><span class="token string">"../../data/face"</span>
        self<span class="token punctuation">.</span>faces<span class="token punctuation">,</span>self<span class="token punctuation">.</span>faceNames<span class="token operator">=</span>self<span class="token punctuation">.</span>initFaceData<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token triple-quoted-string string">'''
    @function: 初始化人脸数据，从已经存储的文件加载name和对应的人脸 encoding
    '''</span>
    <span class="token keyword">def</span> <span class="token function">initFaceData</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        known_faces<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
        known_faceNames<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> file <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>self<span class="token punctuation">.</span>basefolder<span class="token punctuation">)</span><span class="token punctuation">:</span>
            filepath<span class="token operator">=</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>self<span class="token punctuation">.</span>basefolder<span class="token punctuation">,</span>file<span class="token punctuation">)</span>
            <span class="token comment" spellcheck="true">#print(filepath)</span>
            image<span class="token operator">=</span>face_recognition<span class="token punctuation">.</span>load_image_file<span class="token punctuation">(</span>filepath<span class="token punctuation">)</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                imageEncoding<span class="token operator">=</span>face_recognition<span class="token punctuation">.</span>face_encodings<span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                known_faceNames<span class="token punctuation">.</span>append<span class="token punctuation">(</span>file<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                known_faces<span class="token punctuation">.</span>append<span class="token punctuation">(</span>imageEncoding<span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>known_faceNames<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">except</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"file don't detect face"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> known_faces<span class="token punctuation">,</span>known_faceNames

    <span class="token comment" spellcheck="true">#This function will take a sample frame</span>
    <span class="token comment" spellcheck="true">#save the picture of the given user in a folder</span>
    <span class="token comment" spellcheck="true">#returns the path of the saved image</span>
    <span class="token keyword">def</span> <span class="token function">saveFaceImage</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>imgdata<span class="token punctuation">,</span> face_name<span class="token operator">=</span><span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        face_name <span class="token operator">=</span> <span class="token string">'{}.png'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>face_name<span class="token punctuation">)</span>
        facesavepath<span class="token operator">=</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>self<span class="token punctuation">.</span>basefolder<span class="token punctuation">,</span> face_name<span class="token punctuation">)</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span>facesavepath<span class="token punctuation">,</span> imgdata<span class="token punctuation">)</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Can't Save File"</span><span class="token punctuation">)</span>

    <span class="token triple-quoted-string string">'''
    @function: 如果图片数据中包含人脸，则添加人脸的编码和name信息
    @parameters：
        imgdata: 人脸数据
        face_names: 名称数据
    @return
        true: 录入人脸信息成功
        false: 录入人脸信息失败
    '''</span>
    <span class="token keyword">def</span> <span class="token function">faceRegister</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>originimage<span class="token punctuation">,</span>face_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true">#imgdata = face_recognition.load_image_file(self.face_image_path)</span>
        <span class="token comment" spellcheck="true"># if face_name not in self.faceNames:</span>
        <span class="token comment" spellcheck="true">#     imgdata = cv2.resize(originimage, (0, 0), fx=0.25, fy=0.25)</span>
        <span class="token comment" spellcheck="true">#     face_encoding = face_recognition.face_encodings(imgdata)[0]</span>
        <span class="token comment" spellcheck="true">#     self.faces.append(face_encoding)</span>
        <span class="token comment" spellcheck="true">#     self.faceNames.append(face_name)</span>
        <span class="token comment" spellcheck="true">#     print("faceRegister: add facecoding ok")</span>
        <span class="token comment" spellcheck="true"># self.saveFaceImage(originimage,face_name)</span>
        <span class="token comment" spellcheck="true"># print("faceRegister: save face ok")</span>
        <span class="token comment" spellcheck="true"># return True</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> face_name <span class="token operator">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>faceNames<span class="token punctuation">:</span>
                imgdata <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>originimage<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fx<span class="token operator">=</span><span class="token number">0.25</span><span class="token punctuation">,</span> fy<span class="token operator">=</span><span class="token number">0.25</span><span class="token punctuation">)</span>
                face_encoding <span class="token operator">=</span> face_recognition<span class="token punctuation">.</span>face_encodings<span class="token punctuation">(</span>imgdata<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                self<span class="token punctuation">.</span>faces<span class="token punctuation">.</span>append<span class="token punctuation">(</span>face_encoding<span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>faceNames<span class="token punctuation">.</span>append<span class="token punctuation">(</span>face_name<span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"faceRegister: add facecoding ok"</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>saveFaceImage<span class="token punctuation">(</span>originimage<span class="token punctuation">,</span>face_name<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"faceRegister: save face ok"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> err<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"No face found in the image"</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>



    <span class="token triple-quoted-string string">'''
        @parameter: face_name: 用户名称
        @return: 如果列表包含用户名称，则返回 true； 否则返回false；
    '''</span>
    <span class="token keyword">def</span> <span class="token function">nameContain</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> face_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        registered <span class="token operator">=</span> <span class="token boolean">False</span>
        namelist<span class="token operator">=</span>os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>self<span class="token punctuation">.</span>basefolder<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token string">'{}.png'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>face_name<span class="token punctuation">)</span> <span class="token keyword">in</span> namelist<span class="token punctuation">:</span>
            registered<span class="token operator">=</span><span class="token boolean">True</span>
        <span class="token keyword">return</span> registered

    <span class="token triple-quoted-string string">'''
    @function: 从一张图片中识别人脸信息
    @parameters: 
        targetPath: 待识别的图片路径
    @returns: 识别用户的姓名信息
    '''</span>
    <span class="token keyword">def</span> <span class="token function">getFaceNameFromFile</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>targetPath<span class="token punctuation">)</span><span class="token punctuation">:</span>
        name<span class="token operator">=</span><span class="token string">"None"</span>
        image<span class="token operator">=</span>face_recognition<span class="token punctuation">.</span>load_image_file<span class="token punctuation">(</span>targetPath<span class="token punctuation">)</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            face_encoding<span class="token operator">=</span>face_recognition<span class="token punctuation">.</span>face_encodings<span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            matches <span class="token operator">=</span> face_recognition<span class="token punctuation">.</span>compare_faces<span class="token punctuation">(</span>self<span class="token punctuation">.</span>faces<span class="token punctuation">,</span> face_encoding<span class="token punctuation">)</span>
            face_distances <span class="token operator">=</span> face_recognition<span class="token punctuation">.</span>face_distance<span class="token punctuation">(</span>self<span class="token punctuation">.</span>faces<span class="token punctuation">,</span> face_encoding<span class="token punctuation">)</span>
            best_match_index <span class="token operator">=</span> np<span class="token punctuation">.</span>argmin<span class="token punctuation">(</span>face_distances<span class="token punctuation">)</span>
            <span class="token comment" spellcheck="true">#print("最小距离： ",face_distances[best_match_index])</span>
            <span class="token comment" spellcheck="true">#print(face_distances)</span>
            <span class="token keyword">if</span> matches<span class="token punctuation">[</span>best_match_index<span class="token punctuation">]</span><span class="token punctuation">:</span>
                name <span class="token operator">=</span> self<span class="token punctuation">.</span>faceNames<span class="token punctuation">[</span>best_match_index<span class="token punctuation">]</span>
            <span class="token keyword">return</span> name
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"file don't detect face"</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span>
            <span class="token keyword">return</span> name   

    <span class="token triple-quoted-string string">'''
    @function: 从一张图片编码中识别人脸信息
    @parameters: 
        targetEncoding: 待识别的图片 特征编码
    @returns: 识别用户的姓名信息
    '''</span>
    <span class="token keyword">def</span> <span class="token function">getFaceNameFromEncoding</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>targetEncoding<span class="token punctuation">)</span><span class="token punctuation">:</span>
        name<span class="token operator">=</span><span class="token string">"None"</span>
        matches <span class="token operator">=</span> face_recognition<span class="token punctuation">.</span>compare_faces<span class="token punctuation">(</span>self<span class="token punctuation">.</span>faces<span class="token punctuation">,</span> targetEncoding<span class="token punctuation">)</span>
        face_distances <span class="token operator">=</span> face_recognition<span class="token punctuation">.</span>face_distance<span class="token punctuation">(</span>self<span class="token punctuation">.</span>faces<span class="token punctuation">,</span> targetEncoding<span class="token punctuation">)</span>
        best_match_index <span class="token operator">=</span> np<span class="token punctuation">.</span>argmin<span class="token punctuation">(</span>face_distances<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"最小距离： "</span><span class="token punctuation">,</span>face_distances<span class="token punctuation">[</span>best_match_index<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>face_distances<span class="token punctuation">)</span>
        <span class="token keyword">if</span> matches<span class="token punctuation">[</span>best_match_index<span class="token punctuation">]</span><span class="token punctuation">:</span>
            name <span class="token operator">=</span> self<span class="token punctuation">.</span>faceNames<span class="token punctuation">[</span>best_match_index<span class="token punctuation">]</span>
        <span class="token keyword">return</span> name

    <span class="token keyword">def</span> <span class="token function">compareToDatabase</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> unknown_face_encoding<span class="token operator">=</span>None<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token operator">not</span> self<span class="token punctuation">.</span>is_running<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>is_running <span class="token operator">=</span> <span class="token boolean">True</span>
            self<span class="token punctuation">.</span>m_thread <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span> self<span class="token punctuation">.</span>_compareToDatabase <span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>m_thread<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">_compareToDatabase</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>originimage<span class="token punctuation">)</span><span class="token punctuation">:</span>
        authenticated <span class="token operator">=</span> <span class="token boolean">False</span>
        <span class="token comment" spellcheck="true">#imgdata = cv2.resize(originimage, (0, 0), fx=0.25, fy=0.25)</span>
        <span class="token comment" spellcheck="true">#imgdata=originimage</span>
        small_frame <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>originimage<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fx<span class="token operator">=</span><span class="token number">0.25</span><span class="token punctuation">,</span> fy<span class="token operator">=</span><span class="token number">0.25</span><span class="token punctuation">)</span>
        rgb_small_frame <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>small_frame<span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span>

        face_landmarks_list <span class="token operator">=</span> face_recognition<span class="token punctuation">.</span>face_landmarks<span class="token punctuation">(</span>rgb_small_frame<span class="token punctuation">)</span>

        face_locations <span class="token operator">=</span> face_recognition<span class="token punctuation">.</span>face_locations<span class="token punctuation">(</span>rgb_small_frame<span class="token punctuation">,</span> model<span class="token operator">=</span><span class="token string">"cnn"</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>len<span class="token punctuation">(</span>face_locations<span class="token punctuation">)</span><span class="token operator">></span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">"Unknown"</span>
        face_encoding <span class="token operator">=</span> face_recognition<span class="token punctuation">.</span>face_encodings<span class="token punctuation">(</span>rgb_small_frame<span class="token punctuation">,</span> face_locations<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

        <span class="token keyword">print</span><span class="token punctuation">(</span>type<span class="token punctuation">(</span>self<span class="token punctuation">.</span>faces<span class="token punctuation">)</span><span class="token punctuation">,</span>type<span class="token punctuation">(</span>face_encoding<span class="token punctuation">)</span><span class="token punctuation">)</span>
        matches <span class="token operator">=</span> face_recognition<span class="token punctuation">.</span>compare_faces<span class="token punctuation">(</span>self<span class="token punctuation">.</span>faces<span class="token punctuation">,</span> face_encoding<span class="token punctuation">)</span>
        face_distances <span class="token operator">=</span> face_recognition<span class="token punctuation">.</span>face_distance<span class="token punctuation">(</span>self<span class="token punctuation">.</span>faces<span class="token punctuation">,</span> face_encoding<span class="token punctuation">)</span>
        best_match_index <span class="token operator">=</span> np<span class="token punctuation">.</span>argmin<span class="token punctuation">(</span>face_distances<span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true">#print("最小距离： ",face_distances[best_match_index])</span>
        <span class="token comment" spellcheck="true">#print(face_distances)</span>
        <span class="token keyword">if</span> matches<span class="token punctuation">[</span>best_match_index<span class="token punctuation">]</span><span class="token punctuation">:</span>
            name <span class="token operator">=</span> self<span class="token punctuation">.</span>faceNames<span class="token punctuation">[</span>best_match_index<span class="token punctuation">]</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"_compareToDataset"</span><span class="token punctuation">,</span>name<span class="token punctuation">,</span>face_locations<span class="token punctuation">)</span>

        <span class="token keyword">for</span> face_landmarks <span class="token keyword">in</span> face_landmarks_list<span class="token punctuation">:</span>
            <span class="token keyword">for</span> facial_feature <span class="token keyword">in</span> face_landmarks<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">for</span> pt_pos <span class="token keyword">in</span> face_landmarks<span class="token punctuation">[</span>facial_feature<span class="token punctuation">]</span><span class="token punctuation">:</span>
                        cv2<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>originimage<span class="token punctuation">,</span> <span class="token punctuation">(</span>pt_pos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">,</span>pt_pos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
                        cv2<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>originimage<span class="token punctuation">,</span> <span class="token punctuation">(</span>pt_pos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">,</span>pt_pos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token comment" spellcheck="true">#process_this_frame = not process_this_frame</span>
        top<span class="token punctuation">,</span> right<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> left<span class="token operator">=</span>face_locations<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        top<span class="token operator">=</span>top<span class="token operator">*</span><span class="token number">4</span>
        right<span class="token operator">=</span>right<span class="token operator">*</span><span class="token number">4</span>
        bottom<span class="token operator">=</span>bottom<span class="token operator">*</span><span class="token number">4</span>
        left<span class="token operator">=</span>left<span class="token operator">*</span><span class="token number">4</span>
        <span class="token comment" spellcheck="true"># Draw a box around the face</span>
        cv2<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span>originimage<span class="token punctuation">,</span> <span class="token punctuation">(</span>left<span class="token punctuation">,</span> top<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>right<span class="token punctuation">,</span> bottom<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># Draw a label with a name below the face</span>
        <span class="token comment" spellcheck="true">#cv2.rectangle(originimage, (left-20, bottom - 60), (right+20, bottom+20), (0, 0, 255), cv2.FILLED)</span>
        font <span class="token operator">=</span> cv2<span class="token punctuation">.</span>FONT_HERSHEY_DUPLEX
        img_PIL <span class="token operator">=</span> Image<span class="token punctuation">.</span>fromarray<span class="token punctuation">(</span>originimage<span class="token punctuation">)</span>
        font <span class="token operator">=</span> ImageFont<span class="token punctuation">.</span>truetype<span class="token punctuation">(</span><span class="token string">'../icons/方正康体简体.TTF'</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># 字体颜色</span>
        fillColor <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># 文字输出位置</span>
        position <span class="token operator">=</span> <span class="token punctuation">(</span>left <span class="token operator">-</span> <span class="token number">100</span><span class="token punctuation">,</span> bottom <span class="token operator">-</span> <span class="token number">30</span><span class="token punctuation">)</span>
        textinfo <span class="token operator">=</span> <span class="token string">"欢迎{}登录"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>name<span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># 需要先把输出的中文字符转换成Unicode编码形式</span>
        <span class="token keyword">if</span> <span class="token operator">not</span> isinstance<span class="token punctuation">(</span>textinfo<span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">:</span>
            textinfo <span class="token operator">=</span> textinfo<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>

        draw <span class="token operator">=</span> ImageDraw<span class="token punctuation">.</span>Draw<span class="token punctuation">(</span>img_PIL<span class="token punctuation">)</span>
        draw<span class="token punctuation">.</span>text<span class="token punctuation">(</span>position<span class="token punctuation">,</span> textinfo<span class="token punctuation">,</span> font<span class="token operator">=</span>font<span class="token punctuation">,</span> fill<span class="token operator">=</span>fillColor<span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># 使用PIL中的save方法保存图片到本地</span>
        <span class="token comment" spellcheck="true"># img_PIL.save('02.jpg', 'jpeg')</span>
        <span class="token comment" spellcheck="true"># 转换回OpenCV格式</span>
        originimage <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>np<span class="token punctuation">.</span>asarray<span class="token punctuation">(</span>img_PIL<span class="token punctuation">)</span><span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>COLOR_RGB2BGR<span class="token punctuation">)</span>

       <span class="token comment" spellcheck="true"># cv2.putText(originimage,"欢迎{}登录".format(name), (left + 6, bottom - 6), font, 1.0, (255, 255, 255), 1)</span>
        cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span><span class="token string">"tmp.png"</span> <span class="token punctuation">,</span> originimage<span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true">#self.im_s.new_image.emit(".tmp.png")</span>
            <span class="token comment" spellcheck="true"># Display the resulting image</span>
        <span class="token comment" spellcheck="true">#cv2.imshow('Video', imgdata)</span>
        <span class="token keyword">return</span> originimage<span class="token punctuation">,</span>name 


    <span class="token keyword">def</span> <span class="token function">removeFaceData</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> face_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>

    <span class="token keyword">def</span> <span class="token function">paint_chinese_opencv</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>im<span class="token punctuation">,</span>chinese<span class="token punctuation">,</span>pos<span class="token punctuation">,</span>color<span class="token punctuation">)</span><span class="token punctuation">:</span>
        img_PIL <span class="token operator">=</span> Image<span class="token punctuation">.</span>fromarray<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>im<span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span><span class="token punctuation">)</span>
        font <span class="token operator">=</span> ImageFont<span class="token punctuation">.</span>truetype<span class="token punctuation">(</span><span class="token string">'NotoSansCJK-Bold.ttc'</span><span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">)</span>
        fillColor <span class="token operator">=</span> color <span class="token comment" spellcheck="true">#(255,0,0)</span>
        position <span class="token operator">=</span> pos <span class="token comment" spellcheck="true">#(100,100)</span>
        <span class="token keyword">if</span> <span class="token operator">not</span> isinstance<span class="token punctuation">(</span>chinese<span class="token punctuation">,</span>str<span class="token punctuation">)</span><span class="token punctuation">:</span>
            chinese <span class="token operator">=</span> chinese<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
        draw <span class="token operator">=</span> ImageDraw<span class="token punctuation">.</span>Draw<span class="token punctuation">(</span>img_PIL<span class="token punctuation">)</span>
        draw<span class="token punctuation">.</span>text<span class="token punctuation">(</span>position<span class="token punctuation">,</span>chinese<span class="token punctuation">,</span>font<span class="token operator">=</span>font<span class="token punctuation">,</span>fill<span class="token operator">=</span>fillColor<span class="token punctuation">)</span>

        img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>np<span class="token punctuation">.</span>asarray<span class="token punctuation">(</span>img_PIL<span class="token punctuation">)</span><span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>COLOR_RGB2BGR<span class="token punctuation">)</span>
        <span class="token keyword">return</span> img
<span class="token comment" spellcheck="true">#编写一个测试</span>
<span class="token keyword">def</span> <span class="token function">functionTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    capture <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    faceServer<span class="token operator">=</span>Face_Recognizer<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    i<span class="token operator">=</span><span class="token number">0</span>
    name<span class="token operator">=</span><span class="token string">"liudongdong"</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        ret<span class="token punctuation">,</span> frame <span class="token operator">=</span> capture<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
        frame <span class="token operator">=</span> cv2<span class="token punctuation">.</span>flip<span class="token punctuation">(</span>frame<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>   <span class="token comment" spellcheck="true">#镜像操作</span>

        key <span class="token operator">=</span> cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true">#print(key)</span>
        <span class="token keyword">if</span> key  <span class="token operator">==</span> ord<span class="token punctuation">(</span><span class="token string">'q'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment" spellcheck="true">#判断是哪一个键按下</span>
            <span class="token keyword">if</span> faceServer<span class="token punctuation">.</span>faceRegister<span class="token punctuation">(</span>frame<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"人脸信息录入成功"</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"人脸信息录入失败"</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> key <span class="token operator">==</span> ord<span class="token punctuation">(</span><span class="token string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            frame<span class="token punctuation">,</span>name<span class="token operator">=</span>faceServer<span class="token punctuation">.</span>_compareToDatabase<span class="token punctuation">(</span>frame<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"识别名称，"</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span>
        cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">"video"</span><span class="token punctuation">,</span> frame<span class="token punctuation">)</span>

        <span class="token comment" spellcheck="true">#cv2.imshow('Video', imgdata)</span>
        <span class="token keyword">if</span> key<span class="token operator">==</span> ord<span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">break</span>

    cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    functionTest<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true"># while i&lt;50:</span>
    <span class="token comment" spellcheck="true">#     i=i+1</span>
    <span class="token comment" spellcheck="true">#     ret, frame = video_capture.read()</span>
    <span class="token comment" spellcheck="true">#     cv2.imshow('Video', frame)</span>
    <span class="token comment" spellcheck="true">#     if i&lt;10:</span>
    <span class="token comment" spellcheck="true">#         if faceServer.faceRegister(frame,name):</span>
    <span class="token comment" spellcheck="true">#             print("人脸信息录入成功")</span>
    <span class="token comment" spellcheck="true">#         else: print("人脸信息录入失败")</span>
    <span class="token comment" spellcheck="true">#     else:</span>
    <span class="token comment" spellcheck="true">#         imgdata,name=faceServer._compareToDatabase(frame)</span>
    <span class="token comment" spellcheck="true">#         cv2.imshow('Video', imgdata)</span>
    <span class="token comment" spellcheck="true">#         print("识别姓名： name=",name)</span>
<span class="token triple-quoted-string string">'''
recognizer = Face_Recognizer()
recognizer.registerFace()
recognizer.saveFaceImage('Kareem')
'''</span></code></pre>
<p><img src="https://gitee.com/github-25970295/blogpictureV2/raw/master/image-20210723155206990.png" alt=""></p>
<ul>
<li>检测图像中所有人脸</li>
</ul>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token comment" spellcheck="true"># 检测人脸</span>
<span class="token keyword">import</span> face_recognition
<span class="token keyword">import</span> cv2
<span class="token comment" spellcheck="true"># 读取图片并识别人脸</span>
img <span class="token operator">=</span> face_recognition<span class="token punctuation">.</span>load_image_file<span class="token punctuation">(</span><span class="token string">"1.png"</span><span class="token punctuation">)</span>
face_locations <span class="token operator">=</span> face_recognition<span class="token punctuation">.</span>face_locations<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span>face_locations<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 调用opencv函数显示图片</span>
img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">"1.png"</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>namedWindow<span class="token punctuation">(</span><span class="token string">"原图"</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">"原图"</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 遍历每个人脸，并标注</span>
faceNum <span class="token operator">=</span> len<span class="token punctuation">(</span>face_locations<span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> faceNum<span class="token punctuation">)</span><span class="token punctuation">:</span>
    top <span class="token operator">=</span>  face_locations<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    right <span class="token operator">=</span>  face_locations<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    bottom <span class="token operator">=</span> face_locations<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
    left <span class="token operator">=</span> face_locations<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
    start <span class="token operator">=</span> <span class="token punctuation">(</span>left<span class="token punctuation">,</span> top<span class="token punctuation">)</span>
    end <span class="token operator">=</span> <span class="token punctuation">(</span>right<span class="token punctuation">,</span> bottom<span class="token punctuation">)</span>
    color <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">55</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">155</span><span class="token punctuation">)</span>
    thickness <span class="token operator">=</span> <span class="token number">3</span>
    cv2<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span>img<span class="token punctuation">,</span> start<span class="token punctuation">,</span> end<span class="token punctuation">,</span> color<span class="token punctuation">,</span> thickness<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 显示识别结果</span>
cv2<span class="token punctuation">.</span>namedWindow<span class="token punctuation">(</span><span class="token string">"识别"</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">"识别"</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<ul>
<li>人脸匹配</li>
</ul>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 导入库</span>
<span class="token keyword">import</span> os
<span class="token keyword">import</span> face_recognition
<span class="token comment" spellcheck="true"># 制作所有可用图像的列表</span>
images <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span><span class="token string">'images'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 加载图像</span>
image_to_be_matched <span class="token operator">=</span> face_recognition<span class="token punctuation">.</span>load_image_file<span class="token punctuation">(</span><span class="token string">'my_image.jpg'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 将加载图像编码为特征向量</span>
image_to_be_matched_encoded <span class="token operator">=</span> face_recognition<span class="token punctuation">.</span>face_encodings<span class="token punctuation">(</span>
   image_to_be_matched<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token comment" spellcheck="true"># 遍历每张图像</span>
<span class="token keyword">for</span> image <span class="token keyword">in</span> images<span class="token punctuation">:</span>
   <span class="token comment" spellcheck="true"># 加载图像</span>
   current_image <span class="token operator">=</span> face_recognition<span class="token punctuation">.</span>load_image_file<span class="token punctuation">(</span><span class="token string">"images/"</span> <span class="token operator">+</span> image<span class="token punctuation">)</span>
   <span class="token comment" spellcheck="true"># 将加载图像编码为特征向量</span>
   current_image_encoded <span class="token operator">=</span> face_recognition<span class="token punctuation">.</span>face_encodings<span class="token punctuation">(</span>current_image<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
   <span class="token comment" spellcheck="true"># 将你的图像和图像对比，看是否为同一人</span>
   result <span class="token operator">=</span> face_recognition<span class="token punctuation">.</span>compare_faces<span class="token punctuation">(</span>
       <span class="token punctuation">[</span>image_to_be_matched_encoded<span class="token punctuation">]</span><span class="token punctuation">,</span> current_image_encoded<span class="token punctuation">)</span>
   <span class="token comment" spellcheck="true"># 检查是否一致</span>
   <span class="token keyword">if</span> result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
       <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"Matched: "</span> <span class="token operator">+</span> image<span class="token punctuation">)</span>
   <span class="token keyword">else</span><span class="token punctuation">:</span>
       <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"Not matched: "</span> <span class="token operator">+</span> image<span class="token punctuation">)</span></code></pre>
<ul>
<li>检测标记人脸特征</li>
</ul>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token comment" spellcheck="true"># 自动识别人脸特征</span>
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image<span class="token punctuation">,</span> ImageDraw
<span class="token keyword">import</span> face_recognition
<span class="token comment" spellcheck="true"># 将jpg文件加载到numpy 数组中</span>
image <span class="token operator">=</span> face_recognition<span class="token punctuation">.</span>load_image_file<span class="token punctuation">(</span><span class="token string">"my_image.jpg"</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#查找图像中所有面部的所有面部特征</span>
face_landmarks_list <span class="token operator">=</span> face_recognition<span class="token punctuation">.</span>face_landmarks<span class="token punctuation">(</span>image<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#打印发现的脸张数</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"I found {} face(s) in this photograph."</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>len<span class="token punctuation">(</span>face_landmarks_list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> face_landmarks <span class="token keyword">in</span> face_landmarks_list<span class="token punctuation">:</span>
   <span class="token comment" spellcheck="true">#打印此图像中每个面部特征的位置</span>
    facial_features <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string">'chin'</span><span class="token punctuation">,</span>
        <span class="token string">'left_eyebrow'</span><span class="token punctuation">,</span>
        <span class="token string">'right_eyebrow'</span><span class="token punctuation">,</span>
        <span class="token string">'nose_bridge'</span><span class="token punctuation">,</span>
        <span class="token string">'nose_tip'</span><span class="token punctuation">,</span>
        <span class="token string">'left_eye'</span><span class="token punctuation">,</span>
        <span class="token string">'right_eye'</span><span class="token punctuation">,</span>
        <span class="token string">'top_lip'</span><span class="token punctuation">,</span>
        <span class="token string">'bottom_lip'</span>
    <span class="token punctuation">]</span>
    <span class="token keyword">for</span> facial_feature <span class="token keyword">in</span> facial_features<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"The {} in this face has the following points: {}"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>facial_feature<span class="token punctuation">,</span> face_landmarks<span class="token punctuation">[</span>facial_feature<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token comment" spellcheck="true">#让我们在图像中描绘出每个人脸特征！</span>
    pil_image <span class="token operator">=</span> Image<span class="token punctuation">.</span>fromarray<span class="token punctuation">(</span>image<span class="token punctuation">)</span>
    d <span class="token operator">=</span> ImageDraw<span class="token punctuation">.</span>Draw<span class="token punctuation">(</span>pil_image<span class="token punctuation">)</span>
    <span class="token keyword">for</span> facial_feature <span class="token keyword">in</span> facial_features<span class="token punctuation">:</span>
        d<span class="token punctuation">.</span>line<span class="token punctuation">(</span>face_landmarks<span class="token punctuation">[</span>facial_feature<span class="token punctuation">]</span><span class="token punctuation">,</span> width<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
    pil_image<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<h3 id="4-5-InsightFace"><a href="#4-5-InsightFace" class="headerlink" title="4.5. InsightFace"></a>4.5. <a href="https://github.com/deepinsight/insightface" target="_blank" rel="noopener">InsightFace</a></h3><blockquote>
<p>InsightFace is an open source 2D&amp;3D deep face analysis toolbox, mainly based on MXNet. This module can help researcher/engineer to <code>develop deep face recognition algorithms quickly by only two steps</code>: <code>download the binary dataset and run the training script</code>.</p>
</blockquote>
<ul>
<li>Face Detection</li>
</ul>
<p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/image-20201219111717005.png" alt=""></p>
<h3 id="4-6-SeetaFace6"><a href="#4-6-SeetaFace6" class="headerlink" title="4.6. SeetaFace6"></a>4.6. <a href="https://github.com/tensorflower/seetaFace6Python" target="_blank" rel="noopener">SeetaFace6</a></h3><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#类似face_recognition 库，可以快捷使用</span>
<span class="token comment" spellcheck="true">#人脸检测</span>
FACE_DETECT <span class="token operator">=</span> <span class="token number">0x00000001</span>
<span class="token comment" spellcheck="true">#人脸跟踪</span>
FACE_TRACK <span class="token operator">=</span> <span class="token number">0x00000002</span>
<span class="token comment" spellcheck="true">#人脸识别（特征提取）</span>
FACERECOGNITION <span class="token operator">=</span> <span class="token number">0x00000004</span>
<span class="token comment" spellcheck="true">#rgb活体检测</span>
LIVENESS <span class="token operator">=</span> <span class="token number">0x00000008</span>
<span class="token comment" spellcheck="true">#人脸5点关键点检测</span>
LANDMARKER5 <span class="token operator">=</span> <span class="token number">0x00000010</span>
<span class="token comment" spellcheck="true">#人脸68点关键点检测</span>
LANDMARKER68 <span class="token operator">=</span> <span class="token number">0x00000020</span>
<span class="token comment" spellcheck="true">#带遮挡识别的人脸5点关键点检测</span>
LANDMARKER_MASK <span class="token operator">=</span> <span class="token number">0x00000040</span>
<span class="token comment" spellcheck="true">#人脸姿态角度方向评估</span>
FACE_POSE_EX <span class="token operator">=</span> <span class="token number">0x00000080</span>
<span class="token comment" spellcheck="true">#性别识别</span>
FACE_GENDER <span class="token operator">=</span> <span class="token number">0x00000100</span>
<span class="token comment" spellcheck="true">#年龄识别</span>
FACE_AGE <span class="token operator">=</span> <span class="token number">0x00000200</span>
<span class="token keyword">def</span> <span class="token function">Predict</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> frame<span class="token punctuation">:</span> np<span class="token punctuation">.</span>array<span class="token punctuation">,</span> face<span class="token punctuation">:</span> SeetaRect<span class="token punctuation">,</span>
                   points<span class="token punctuation">:</span> List<span class="token punctuation">[</span>SeetaPointF<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> int<span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        单帧rgb活体检测
        :param frame: 原始图像
        :param face: 人脸区域
        :param points:  人脸关键点位置
        :return:  活体检测结果
        0:真实人脸
        1:攻击人脸（假人脸）
        2:无法判断（人脸成像质量不好）
        """</span>
        self<span class="token punctuation">.</span>check_init<span class="token punctuation">(</span>LIVENESS<span class="token punctuation">)</span>
        seetaImageData <span class="token operator">=</span> get_seetaImageData_by_numpy<span class="token punctuation">(</span>frame<span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_Predict<span class="token punctuation">(</span>seetaImageData<span class="token punctuation">,</span> face<span class="token punctuation">,</span> points<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">compare_feature_np</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> feature1<span class="token punctuation">:</span> np<span class="token punctuation">.</span>array<span class="token punctuation">,</span> feature2<span class="token punctuation">:</span> np<span class="token punctuation">.</span>array<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> float<span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        使用numpy 计算，比较人脸特征值相似度
       :param feature1: 人脸特征值1
        :param feature2: 人脸特征值2
        :return: 人脸相似度
        """</span>
        dot <span class="token operator">=</span> np<span class="token punctuation">.</span>sum<span class="token punctuation">(</span>np<span class="token punctuation">.</span>multiply<span class="token punctuation">(</span>feature1<span class="token punctuation">,</span> feature2<span class="token punctuation">)</span><span class="token punctuation">)</span>
        norm <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>feature1<span class="token punctuation">)</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>feature2<span class="token punctuation">)</span>
        dist <span class="token operator">=</span> dot <span class="token operator">/</span> norm
        <span class="token keyword">return</span> float<span class="token punctuation">(</span>dist<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">PredictAge</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>frame<span class="token punctuation">:</span> np<span class="token punctuation">.</span>array<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> int<span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        检测一张只有人脸的图片,识别出年龄
        :param frame: 原图
        :param face: 人脸检测框
        :param points: 人脸关键点
        :return: 年龄大小
        """</span>
        self<span class="token punctuation">.</span>check_init<span class="token punctuation">(</span>FACE_AGE<span class="token punctuation">)</span>
        <span class="token keyword">if</span> frame<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token number">256</span> <span class="token operator">or</span> frame<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token number">256</span><span class="token punctuation">:</span>
            seetaImageData <span class="token operator">=</span> get_seetaImageData_by_numpy<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>frame<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            seetaImageData <span class="token operator">=</span> get_seetaImageData_by_numpy<span class="token punctuation">(</span>frame<span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_PredictAge<span class="token punctuation">(</span>seetaImageData<span class="token punctuation">)</span></code></pre>
<h3 id="4-7-Ultra-Light-Generic-Face-Detector"><a href="#4-7-Ultra-Light-Generic-Face-Detector" class="headerlink" title="4.7. Ultra-Light-Generic-Face-Detector"></a>4.7. <a href="https://github.com/Linzaer/Ultra-Light-Fast-Generic-Face-Detector-1MB" target="_blank" rel="noopener">Ultra-Light-Generic-Face-Detector</a></h3><blockquote>
<ul>
<li><input disabled="" type="checkbox"> <a href="https://github.com/Linzaer/Ultra-Light-Fast-Generic-Face-Detector-1MB/tree/master/widerface_evaluate" target="_blank" rel="noopener">Widerface test code</a></li>
<li><input disabled="" type="checkbox"> <a href="https://github.com/Linzaer/Ultra-Light-Fast-Generic-Face-Detector-1MB/tree/master/ncnn" target="_blank" rel="noopener">NCNN C++ inference code</a> (<a href="https://github.com/vealocia" target="_blank" rel="noopener">vealocia</a>)</li>
<li><input disabled="" type="checkbox"> <a href="https://github.com/Linzaer/Ultra-Light-Fast-Generic-Face-Detector-1MB/tree/master/MNN" target="_blank" rel="noopener">MNN C++ inference code</a>, <a href="https://github.com/Linzaer/Ultra-Light-Fast-Generic-Face-Detector-1MB/tree/master/MNN/python" target="_blank" rel="noopener">MNN Python inference code</a></li>
<li><input disabled="" type="checkbox"> <a href="https://github.com/Linzaer/Ultra-Light-Fast-Generic-Face-Detector-1MB/tree/master/caffe/model" target="_blank" rel="noopener">Caffe model</a> and <a href="https://github.com/Linzaer/Ultra-Light-Fast-Generic-Face-Detector-1MB/tree/master/caffe" target="_blank" rel="noopener">onnx2caffe conversion code</a></li>
<li><input disabled="" type="checkbox"> <a href="https://github.com/Linzaer/Ultra-Light-Fast-Generic-Face-Detector-1MB/blob/master/caffe/ultra_face_caffe_inference.py" target="_blank" rel="noopener">Caffe python inference code</a> and <a href="https://github.com/Linzaer/Ultra-Light-Fast-Generic-Face-Detector-1MB/blob/master/caffe/ultra_face_opencvdnn_inference.py" target="_blank" rel="noopener">OpencvDNN inference code</a></li>
<li><input disabled="" type="checkbox"> 如果要使用的话，可以学习这个项目源代码</li>
</ul>
</blockquote>
<p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/20210324090933.png" alt=""></p>
<h3 id="4-8-CompreFace"><a href="#4-8-CompreFace" class="headerlink" title="4.8. CompreFace"></a>4.8. <a href="https://github.com/exadel-inc/CompreFace" target="_blank" rel="noopener">CompreFace</a></h3><blockquote>
<p>CompreFace provides <code>REST API</code> for <code>face recognition</code>, <code>face verification</code>, <code>face detection</code>, <code>landmark detection</code>, <code>age</code>, and <code>gender recognition</code>. The solution also features a <code>role management system</code> that allows you to easily control who has access to your Face Recognition Services.</p>
</blockquote>
<p><img src="https://gitee.com/github-25970295/blogpictureV2/raw/master/image-20210611170456149.png" alt=""></p>
<h3 id="4-9-TFace"><a href="#4-9-TFace" class="headerlink" title="4.9. TFace"></a>4.9. <a href="https://github.com/Tencent/TFace" target="_blank" rel="noopener">TFace</a></h3><blockquote>
<p>基于可信人脸识别的理念，TFace重点关注人脸识别领域的四个研究方向：精准、公平、可解释以及隐私。</p>
</blockquote>
<p><img src="https://gitee.com/github-25970295/blogpictureV2/raw/master/image-20210625104637590.png" alt=""></p>
<p><img src="https://gitee.com/github-25970295/blogpictureV2/raw/master/image-20210625104702814.png" alt=""></p>
<p><img src="https://gitee.com/github-25970295/blogpictureV2/raw/master/image-20210625104719037.png" alt=""></p>
<ul>
<li><strong><a href="https://arxiv.org/abs/2004.00288" target="_blank" rel="noopener">CurricularFace</a></strong> 一种用于人脸识别基础模型训练的损失函数，发表于CVPR2020， 主要的思路是将课程学习的思想结合到常用的人脸识别损失函数，训练过程中自动挖掘困难样本，先易后难渐进学习，提升识别模型训练鲁棒性及难样本识别性能。</li>
<li><strong><a href="https://arxiv.org/abs/2002.03662" target="_blank" rel="noopener">DDL</a></strong> 一种用于提升特定场景下人脸识别性能的方法，发表于ECCV2020，主要的思路是针对某一特定场景的难样本，为其寻找一个合适的教师场景，通过拉近两种场景下的人脸相似度分布，从而提升该场景下困难样本的识别性能。</li>
<li><strong><a href="https://arxiv.org/abs/2106.05519" target="_blank" rel="noopener">CIFP</a></strong> 一种提升个体识别公平性的方法，发表于CVPR2021, 提出了基于误报率惩罚的损失函数，即通过增加实例误报率（FPR）的一致性来减轻人脸识别偏差。</li>
<li><strong><a href="https://arxiv.org/abs/2103.05977" target="_blank" rel="noopener">SDD-FIQA</a></strong> 一种基于人脸识别相似度分布的无监督人脸质量评估方法，发表于CVPR2021, 通过计算同人和非同人相似度分布的韦氏距离作为目标图像的质量分伪标签， 最终通过图像+质量伪标签训练得到质量分模型。</li>
<li><strong><a href="https://openaccess.thecvf.com/content/CVPR2021/papers/Li_Spherical_Confidence_Learning_for_Face_Recognition_CVPR_2021_paper.pdf" target="_blank" rel="noopener">SCF</a></strong> 一种基于人脸特征置信度的人脸识别方法，发表于CVPR2021, 核心思想包含两点：a. 将人脸样本特征从确定向量升级为概率分布，从而获得额外刻画样本识别置信度的能力；b. 提出适配于超球流形r-radius von Mises Fisher分布建模特征，理论可解释性与方法收敛性较PFE更佳。</li>
</ul>
<h2 id="5-FaceSearching"><a href="#5-FaceSearching" class="headerlink" title="5. FaceSearching"></a>5. FaceSearching</h2><p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/image-20201219124037238.png" alt=""></p>
<p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/image-20201219112540276.png" alt=""></p>
<ol>
<li>单机由于内存和CPU性能限制，能够支持的人脸检索数始终都有上限，所以必须进行集群设计来提高容量。</li>
<li>10亿级别的人脸库存储是一个问题，按每张图片50K的大小都会是TB级别了。</li>
<li>10亿级别人脸库建模需要很长时间。</li>
<li>10亿级别人脸库检索响应时间能否做到秒级。</li>
<li>10亿级别人脸库检索TPS能到多少。</li>
</ol>
<h3 id="5-0-基于GPU优化的检索方案"><a href="#5-0-基于GPU优化的检索方案" class="headerlink" title="5.0. 基于GPU优化的检索方案"></a>5.0. 基于GPU优化的检索方案</h3><blockquote>
<p><strong>数据并行+模型并行</strong>： 首先是数据并行，每个GPU上去预测它自己的数据batch，得到人脸特征，然后对特征进行一个多机汇总，得到完整的F。同时，我们把参数矩阵W均匀拆分到多机不同的显卡上，比如第一个GPU负责计算每张图属于第1-10万类的概率，下一GPU负责第10万到20万类，这样依次进行。可考虑使用浮点运算能力更高的GPU来实现.</p>
</blockquote>
<h3 id="5-1-分布式人脸检索系统框图"><a href="#5-1-分布式人脸检索系统框图" class="headerlink" title="5.1. 分布式人脸检索系统框图"></a>5.1. <strong>分布式人脸检索系统框图</strong></h3><p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/image-20201219113002358.png" alt=""></p>
<p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/image-20201219123840814.png" alt=""></p>
<h3 id="5-2-人脸动态库方案"><a href="#5-2-人脸动态库方案" class="headerlink" title="5.2. 人脸动态库方案"></a>5.2. <strong>人脸动态库方案</strong></h3><blockquote>
<p>在内部验证阶段，使用单机存储固定特征个数（可能是一千万个）的特征库，每个特征对应记录ID、时间戳、摄像机编号等信息。每天新增的特征形成一个单独的小特征库，每天定时把小特征库合并到大特征库，并把大特征库中最旧的同量特征删除，保持特征库的大小。在检索时先对全库进行1:N，根据阈值过滤出部分记录后，再抽取对应记录的额外信息，与页面检索条件进行匹配，返回结果。</p>
</blockquote>
<p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/image-20201219124313646.png" alt=""></p>
<h3 id="5-3-ES分布式人脸检索方案"><a href="#5-3-ES分布式人脸检索方案" class="headerlink" title="5.3.  ES分布式人脸检索方案"></a>5.3.  ES分布式人脸检索方案</h3><p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/image-20201219124437959.png" alt=""></p>
<h3 id="5-4-基于RocksDB的分布式特征索引方案"><a href="#5-4-基于RocksDB的分布式特征索引方案" class="headerlink" title="5.4. 基于RocksDB的分布式特征索引方案"></a>5.4. 基于RocksDB的分布式特征索引方案</h3><p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/image-20201219124854164.png" alt=""></p>
<h3 id="5-5-基于小特征加速比对的检索方案"><a href="#5-5-基于小特征加速比对的检索方案" class="headerlink" title="5.5.  基于小特征加速比对的检索方案"></a>5.5.  基于小特征加速比对的检索方案</h3><p><img src="https://gitee.com/github-25970295/blogImage/raw/master/img/image-20201219125047175.png" alt=""></p>
<h2 id="6-数据集-amp-学习链接"><a href="#6-数据集-amp-学习链接" class="headerlink" title="6. 数据集&amp;学习链接"></a>6. 数据集&amp;学习链接</h2><ul>
<li><p><a href="https://dataware.cc/tag/%E4%BA%BA%E8%84%B8%E6%95%B0%E6%8D%AE%E9%9B%86/" target="_blank" rel="noopener">人脸数据集</a></p>
</li>
<li><p><a href="https://blog.csdn.net/yimin_tank/article/details/82703121" target="_blank" rel="noopener">分布式检索</a></p>
</li>
<li><p><a href="https://mp.weixin.qq.com/s/vugfNwlH8a7uOIpmhg2Nig" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/vugfNwlH8a7uOIpmhg2Nig</a></p>
</li>
<li><p><a href="https://zhuanlan.zhihu.com/p/35968767" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/35968767</a></p>
</li>
<li><p><a href="https://segmentfault.com/a/1190000019224111" target="_blank" rel="noopener">人脸检索方案</a></p>
</li>
</ul>
<blockquote>
<p>cv2.imread() 读取图片数据为空的问题： </p>
<p>im = cv2.imdecode(np.fromfile(file,dtype=np.uint8),-1)   使用该函数代替即可解决问题。</p>
</blockquote>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        Author:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://liudongdong1.github.io" rel="external nofollow noreferrer">liudongdong1</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        Link:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://liudongdong1.github.io/2020/07/01/shi-jue-ai/facerecognition/facerecognition/">https://liudongdong1.github.io/2020/07/01/shi-jue-ai/facerecognition/facerecognition/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        Reprint policy:
                    </i>
                </span>
                <span class="reprint-info">
                    All articles in this blog are used except for special statements
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    reprint polocy. If reproduced, please indicate source
                    <a href="https://liudongdong1.github.io" target="_blank">liudongdong1</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>Copied successfully, please follow the reprint policy of this article</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">more</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/FaceRecognition/">
                                    <span class="chip bg-color">FaceRecognition</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="qq,qzone,wechat,weibo,douban" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;Previous</div>
            <div class="card">
                <a href="/2020/07/01/aiot/smarthome/">
                    <div class="card-image">
                        
                        <img src="https://gitee.com/github-25970295/blogImage/raw/master/img/20210501110455.png" class="responsive-img" alt="SmartHome">
                        
                        <span class="card-title">SmartHome</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            keyword:

Human-centered computing , LoRa


Paper: WIDESEE

WIDESEE: Towards Wide-Area Contactless Wireless Sensing

###
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2020-07-01
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/AIOT/" class="post-category">
                                    AIOT
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/IOT/">
                        <span class="chip bg-color">IOT</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                Next&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2020/07/01/shi-jue-ai/facerecognition/comprefacelearning/">
                    <div class="card-image">
                        
                        <img src="https://cdn.pixabay.com/photo/2018/07/09/21/03/integration-3527268__340.jpg" class="responsive-img" alt="CompreFaceLearning">
                        
                        <span class="card-title">CompreFaceLearning</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            1. Configuration
registry - this is the docker hub registry. For release and pre-build images, it should be set to exade
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2020-07-01
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E8%A7%86%E8%A7%89AI/" class="post-category">
                                    视觉AI
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/FaceRecognition/">
                        <span class="chip bg-color">FaceRecognition</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;TOC</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <!-- <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="463294659"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            <span id="year">2019</span>
            <a href="https://liudongdong1.github.io" target="_blank">liudongdong</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">1195.6k</span>&nbsp;字
            
            
            
            
            
            
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/liudongdong1/" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:3463264078@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>














    <a href="https://blog.csdn.net/liudongdong19/" class="tooltipped" target="_blank" data-tooltip="关注我的CSDN: https://blog.csdn.net/liudongdong19/" data-position="top" data-delay="50">
        <i class="fab fa-csdn">C</i>
    </a>





</div>
    </div>
</footer>

<div class="progress-bar"></div>
 -->

    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;Search</span>
            <input type="search" id="searchInput" name="s" placeholder="Please enter a search keyword"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/search.xml", 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script type="text/javascript" src="/js/CFS.Snow.min.js"></script>
    <!-- 点击爆灯效果 -->
    <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" ></canvas> 
    <script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script> 
    <script type="text/javascript" src="/js/fireworks.js"></script>
    <!--动态线条背景-->
    <script type="text/javascript"
        color="122 103 238" opacity='0.7' zIndex="-2" count="200" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js">
    </script>
    <!-- 天气 -->
    <!-- weather -->
    <!-- weather -->
    <script type="text/javascript">
         WIDGET = {FID: 'knAMQaFanP'}
    </script>
    <script type="text/javascript" src="https://apip.weatherdt.com/float/static/js/r.js?v=1111"></script>
    <script type="text/javascript" src="https://apip.weatherdt.com/float/static/js/r.js?v=1111"></script>
    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    

    
    
    <script type="text/javascript" size="150" alpha='0.6'
        zIndex="-1" src="/libs/background/ribbon-refresh.min.js" async="async"></script>
    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    
    <!-- {% include '_custom/custom.swig' %} -->

</body>

</html>
